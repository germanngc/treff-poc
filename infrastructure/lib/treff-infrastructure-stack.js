"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.TreffInfrastructureStack = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const ec2 = __importStar(require("aws-cdk-lib/aws-ec2"));
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const cloudfront = __importStar(require("aws-cdk-lib/aws-cloudfront"));
const origins = __importStar(require("aws-cdk-lib/aws-cloudfront-origins"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
class TreffInfrastructureStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        // ========================================
        // VPC and Networking
        // ========================================
        const vpc = new ec2.Vpc(this, 'TreffVPC', {
            maxAzs: 2,
            natGateways: 0, // Save costs - use public subnet only
            subnetConfiguration: [
                {
                    cidrMask: 24,
                    name: 'Public',
                    subnetType: ec2.SubnetType.PUBLIC,
                },
            ],
        });
        // Security Group for EC2
        const ec2SecurityGroup = new ec2.SecurityGroup(this, 'TreffEC2SecurityGroup', {
            vpc,
            description: 'Security group for Treff EC2 instance',
            allowAllOutbound: true,
        });
        // Allow HTTP/HTTPS from anywhere
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(80), 'Allow HTTP traffic');
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(443), 'Allow HTTPS traffic');
        // Allow SSH (optional - for debugging)
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(22), 'Allow SSH access');
        // Allow MySQL port (for external access if needed)
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(3306), 'Allow MySQL access (optional - can be removed for production)');
        // ========================================
        // EC2 Instance for Backend + MySQL
        // ========================================
        // IAM Role for EC2
        const ec2Role = new iam.Role(this, 'TreffEC2Role', {
            assumedBy: new iam.ServicePrincipal('ec2.amazonaws.com'),
            managedPolicies: [
                iam.ManagedPolicy.fromAwsManagedPolicyName('AmazonSSMManagedInstanceCore'),
                iam.ManagedPolicy.fromAwsManagedPolicyName('CloudWatchAgentServerPolicy'),
            ],
        });
        // Grant S3 access for deployments (if deployment bucket exists)
        if (props.assetsBucketName) {
            const deploymentBucket = s3.Bucket.fromBucketName(this, 'DeploymentBucket', 'treff-deployments-prod');
            deploymentBucket.grantRead(ec2Role);
        }
        // User data script
        const userDataScript = ec2.UserData.forLinux();
        userDataScript.addCommands('#!/bin/bash', 'set -e', '', '# Update system', 'apt-get update -y', 'apt-get upgrade -y', '', '# Install dependencies', 'apt-get install -y wget curl git nginx mysql-server mysql-client unzip', '', '# ========================================', '# MySQL Setup', '# ========================================', 'systemctl start mysql', 'systemctl enable mysql', '', `# Set MySQL root password`, `mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '${props.mysqlRootPassword}';"`, `mysql -e "FLUSH PRIVILEGES;"`, '', `# Create database and user`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "CREATE DATABASE IF NOT EXISTS ${props.mysqlDatabase};"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "CREATE USER IF NOT EXISTS '${props.mysqlUser}'@'localhost' IDENTIFIED BY '${props.mysqlPassword}';"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "GRANT ALL PRIVILEGES ON ${props.mysqlDatabase}.* TO '${props.mysqlUser}'@'localhost';"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "FLUSH PRIVILEGES;"`, '', '# Configure MySQL to listen on all interfaces (optional)', `sed -i 's/bind-address.*/bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf`, 'systemctl restart mysql', '', '# ========================================', '# .NET 8 Runtime Installation', '# ========================================', 'wget https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh', 'chmod +x dotnet-install.sh', './dotnet-install.sh --channel 8.0 --runtime aspnetcore', './dotnet-install.sh --channel 8.0 --runtime dotnet', '', '# Add .NET to PATH', 'echo "export DOTNET_ROOT=$HOME/.dotnet" >> /root/.bashrc', 'echo "export PATH=$PATH:$DOTNET_ROOT:$DOTNET_ROOT/tools" >> /root/.bashrc', 'export DOTNET_ROOT=$HOME/.dotnet', 'export PATH=$PATH:$DOTNET_ROOT:$DOTNET_ROOT/tools', '', '# ========================================', '# Application Setup Directory', '# ========================================', 'mkdir -p /var/www/treff-backend', 'chown -R www-data:www-data /var/www/treff-backend', '', '# ========================================', '# Nginx Configuration', '# ========================================', 'cat > /etc/nginx/sites-available/treff <<EOF', 'server {', '    listen 80;', '    server_name _;', '', '    location / {', '        proxy_pass http://127.0.0.1:5000;', '        proxy_http_version 1.1;', '        proxy_set_header Upgrade \\$http_upgrade;', '        proxy_set_header Connection "upgrade";', '        proxy_set_header Host \\$host;', '        proxy_cache_bypass \\$http_upgrade;', '        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;', '        proxy_set_header X-Forwarded-Proto \\$scheme;', '    }', '', '    # SignalR WebSocket support', '    location /hubs/ {', '        proxy_pass http://127.0.0.1:5000;', '        proxy_http_version 1.1;', '        proxy_set_header Upgrade \\$http_upgrade;', '        proxy_set_header Connection "upgrade";', '        proxy_set_header Host \\$host;', '        proxy_cache_bypass \\$http_upgrade;', '        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;', '        proxy_set_header X-Forwarded-Proto \\$scheme;', '    }', '}', 'EOF', '', 'ln -sf /etc/nginx/sites-available/treff /etc/nginx/sites-enabled/', 'rm -f /etc/nginx/sites-enabled/default', 'nginx -t', 'systemctl restart nginx', 'systemctl enable nginx', '', '# ========================================', '# Create systemd service for .NET app', '# ========================================', 'cat > /etc/systemd/system/treff-backend.service <<EOF', '[Unit]', 'Description=Treff .NET Backend', 'After=network.target mysql.service', '', '[Service]', 'Type=notify', 'WorkingDirectory=/var/www/treff-backend', 'ExecStart=/root/.dotnet/dotnet /var/www/treff-backend/WebApi.dll', 'Restart=always', 'RestartSec=10', 'KillSignal=SIGINT', 'SyslogIdentifier=treff-backend', 'User=www-data', 'Environment=ASPNETCORE_ENVIRONMENT=Production', 'Environment=DOTNET_ROOT=/root/.dotnet', 'Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/root/.dotnet:/root/.dotnet/tools', ...(props.twilioAccountSid ? [`Environment=TwilioConfig__AccountSid=${props.twilioAccountSid}`] : []), ...(props.twilioAuthToken ? [`Environment=TwilioConfig__AuthToken=${props.twilioAuthToken}`] : []), ...(props.twilioPhone ? [`Environment=TwilioConfig__Phone=${props.twilioPhone}`] : []), '', '[Install]', 'WantedBy=multi-user.target', 'EOF', '', 'systemctl daemon-reload', '# Note: Service will fail until you deploy the application', '# systemctl enable treff-backend', '', '# ========================================', '# Create deployment script', '# ========================================', 'cat > /root/deploy-backend.sh <<EOF', '#!/bin/bash', 'echo "Stopping backend service..."', 'systemctl stop treff-backend', '', 'echo "Deploying new version..."', '# Your deployment commands here', '# Example: copy files, run migrations, etc.', '', 'echo "Starting backend service..."', 'systemctl start treff-backend', 'systemctl status treff-backend', 'EOF', '', 'chmod +x /root/deploy-backend.sh', '', '# ========================================', '# Install CloudWatch agent (optional)', '# ========================================', 'wget https://s3.amazonaws.com/amazoncloudwatch-agent/ubuntu/arm64/latest/amazon-cloudwatch-agent.deb', 'dpkg -i -E ./amazon-cloudwatch-agent.deb', '', 'echo "EC2 setup complete!"', 'echo "MySQL root password: ${props.mysqlRootPassword}"', 'echo "MySQL database: ${props.mysqlDatabase}"', 'echo "MySQL user: ${props.mysqlUser}"', 'echo "MySQL password: ${props.mysqlPassword}"', 'echo ""', 'echo "Next steps:"', 'echo "1. Deploy your .NET application to /var/www/treff-backend/"', 'echo "2. Update connection string in appsettings.Production.json"', 'echo "3. Run: systemctl enable treff-backend"', 'echo "4. Run: systemctl start treff-backend"');
        // EC2 Instance
        const ec2Instance = new ec2.Instance(this, 'TreffEC2Instance', {
            vpc,
            vpcSubnets: {
                subnetType: ec2.SubnetType.PUBLIC,
            },
            instanceType: new ec2.InstanceType(props.instanceType),
            machineImage: ec2.MachineImage.fromSsmParameter('/aws/service/canonical/ubuntu/server/22.04/stable/current/arm64/hvm/ebs-gp2/ami-id', {
                os: ec2.OperatingSystemType.LINUX,
            }),
            securityGroup: ec2SecurityGroup,
            role: ec2Role,
            userData: userDataScript,
            blockDevices: [
                {
                    deviceName: '/dev/sda1',
                    volume: ec2.BlockDeviceVolume.ebs(30, {
                        volumeType: ec2.EbsDeviceVolumeType.GP3,
                        deleteOnTermination: true,
                    }),
                },
            ],
        });
        // Elastic IP for EC2
        const eip = new ec2.CfnEIP(this, 'TreffEC2EIP', {
            instanceId: ec2Instance.instanceId,
        });
        // ========================================
        // S3 Bucket for Frontend (use existing or create new)
        // ========================================
        const frontendBucket = props.frontendBucketName
            ? s3.Bucket.fromBucketName(this, 'TreffFrontendBucket', props.frontendBucketName)
            : new s3.Bucket(this, 'TreffFrontendBucket', {
                bucketName: `treff-frontend-${this.account}`,
                websiteIndexDocument: 'index.html',
                websiteErrorDocument: 'index.html',
                publicReadAccess: false,
                blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
                removalPolicy: cdk.RemovalPolicy.RETAIN,
                autoDeleteObjects: false,
                encryption: s3.BucketEncryption.S3_MANAGED,
            });
        // Origin Access Identity for CloudFront
        const oai = new cloudfront.OriginAccessIdentity(this, 'TreffOAI', {
            comment: 'OAI for Treff frontend',
        });
        // Grant CloudFront read access to the frontend bucket
        // For manually created buckets, we need to add the policy statement directly
        if (props.frontendBucketName) {
            // Imported bucket - add policy manually
            const bucketPolicy = new s3.CfnBucketPolicy(this, 'FrontendBucketPolicy', {
                bucket: props.frontendBucketName,
                policyDocument: {
                    Statement: [
                        {
                            Effect: 'Allow',
                            Principal: {
                                CanonicalUser: oai.cloudFrontOriginAccessIdentityS3CanonicalUserId,
                            },
                            Action: 's3:GetObject',
                            Resource: `arn:aws:s3:::${props.frontendBucketName}/*`,
                        },
                    ],
                },
            });
        }
        else if (frontendBucket instanceof s3.Bucket) {
            // CDK-created bucket - use grantRead helper
            frontendBucket.grantRead(oai);
        }
        // CloudFront Distribution
        const distribution = new cloudfront.Distribution(this, 'TreffDistribution', {
            defaultBehavior: {
                origin: new origins.S3Origin(frontendBucket, {
                    originAccessIdentity: oai,
                }),
                viewerProtocolPolicy: cloudfront.ViewerProtocolPolicy.REDIRECT_TO_HTTPS,
                cachePolicy: cloudfront.CachePolicy.CACHING_OPTIMIZED,
            },
            additionalBehaviors: {
                '/api/*': {
                    origin: new origins.HttpOrigin(ec2Instance.instancePublicDnsName, {
                        protocolPolicy: cloudfront.OriginProtocolPolicy.HTTP_ONLY,
                        httpPort: 80,
                    }),
                    viewerProtocolPolicy: cloudfront.ViewerProtocolPolicy.REDIRECT_TO_HTTPS,
                    cachePolicy: cloudfront.CachePolicy.CACHING_DISABLED,
                    allowedMethods: cloudfront.AllowedMethods.ALLOW_ALL,
                    originRequestPolicy: cloudfront.OriginRequestPolicy.ALL_VIEWER,
                },
            },
            defaultRootObject: 'index.html',
            errorResponses: [
                {
                    httpStatus: 403,
                    responseHttpStatus: 200,
                    responsePagePath: '/index.html',
                    ttl: cdk.Duration.minutes(5),
                },
                {
                    httpStatus: 404,
                    responseHttpStatus: 200,
                    responsePagePath: '/index.html',
                    ttl: cdk.Duration.minutes(5),
                },
            ],
            priceClass: cloudfront.PriceClass.PRICE_CLASS_100, // Cheapest option
        });
        // ========================================
        // Outputs
        // ========================================
        new cdk.CfnOutput(this, 'EC2PublicIP', {
            value: eip.ref,
            description: 'EC2 Instance Public IP',
        });
        new cdk.CfnOutput(this, 'EC2InstanceId', {
            value: ec2Instance.instanceId,
            description: 'EC2 Instance ID',
        });
        new cdk.CfnOutput(this, 'BackendURL', {
            value: `https://${distribution.distributionDomainName}/`,
            description: 'Backend API URL (via CloudFront)',
        });
        new cdk.CfnOutput(this, 'BackendDirectURL', {
            value: `http://${eip.ref}/`,
            description: 'Backend Direct URL (HTTP only - use CloudFront URL instead)',
        });
        new cdk.CfnOutput(this, 'FrontendBucket', {
            value: frontendBucket.bucketName,
            description: 'S3 Bucket for Frontend',
        });
        new cdk.CfnOutput(this, 'CloudFrontURL', {
            value: `https://${distribution.distributionDomainName}`,
            description: 'CloudFront Distribution URL',
        });
        new cdk.CfnOutput(this, 'CloudFrontDistributionId', {
            value: distribution.distributionId,
            description: 'CloudFront Distribution ID',
        });
        new cdk.CfnOutput(this, 'MySQLConnectionString', {
            value: `Server=${eip.ref};Database=${props.mysqlDatabase};Uid=${props.mysqlUser};Pwd=${props.mysqlPassword};`,
            description: 'MySQL Connection String',
        });
        new cdk.CfnOutput(this, 'SSHCommand', {
            value: `ssh -i your-key.pem ubuntu@${eip.ref}`,
            description: 'SSH Command (you need to add a key pair)',
        });
    }
}
exports.TreffInfrastructureStack = TreffInfrastructureStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZmYtaW5mcmFzdHJ1Y3R1cmUtc3RhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0cmVmZi1pbmZyYXN0cnVjdHVyZS1zdGFjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBbUM7QUFDbkMseURBQTJDO0FBQzNDLHVEQUF5QztBQUN6Qyx1RUFBeUQ7QUFDekQsNEVBQThEO0FBQzlELHlEQUEyQztBQW9CM0MsTUFBYSx3QkFBeUIsU0FBUSxHQUFHLENBQUMsS0FBSztJQUNyRCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQW9DO1FBQzVFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRXhCLDJDQUEyQztRQUMzQyxxQkFBcUI7UUFDckIsMkNBQTJDO1FBQzNDLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFO1lBQ3hDLE1BQU0sRUFBRSxDQUFDO1lBQ1QsV0FBVyxFQUFFLENBQUMsRUFBRSxzQ0FBc0M7WUFDdEQsbUJBQW1CLEVBQUU7Z0JBQ25CO29CQUNFLFFBQVEsRUFBRSxFQUFFO29CQUNaLElBQUksRUFBRSxRQUFRO29CQUNkLFVBQVUsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU07aUJBQ2xDO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCx5QkFBeUI7UUFDekIsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLHVCQUF1QixFQUFFO1lBQzVFLEdBQUc7WUFDSCxXQUFXLEVBQUUsdUNBQXVDO1lBQ3BELGdCQUFnQixFQUFFLElBQUk7U0FDdkIsQ0FBQyxDQUFDO1FBRUgsaUNBQWlDO1FBQ2pDLGdCQUFnQixDQUFDLGNBQWMsQ0FDN0IsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFDbEIs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QUFDO1FBRUgsSUFBSSxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSwwQkFBMEIsRUFBRTtZQUNsRCxLQUFLLEVBQUUsWUFBWSxDQUFDLGNBQWM7WUFDbEMsV0FBVyxFQUFFLDRCQUE0QjtTQUMxQyxDQUFDLENBQUM7UUFFSCxJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLHVCQUF1QixFQUFFO1lBQy9DLEtBQUssRUFBRSxVQUFVLEdBQUcsQ0FBQyxHQUFHLGFBQWEsS0FBSyxDQUFDLGFBQWEsUUFBUSxLQUFLLENBQUMsU0FBUyxRQUFRLEtBQUssQ0FBQyxhQUFhLEdBQUc7WUFDN0csV0FBVyxFQUFFLHlCQUF5QjtTQUN2QyxDQUFDLENBQUM7UUFFSCxJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRTtZQUNwQyxLQUFLLEVBQUUsOEJBQThCLEdBQUcsQ0FBQyxHQUFHLEVBQUU7WUFDOUMsV0FBVyxFQUFFLDBDQUEwQztTQUN4RCxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUE3WUQsNERBNllDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGVjMiBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZWMyJztcbmltcG9ydCAqIGFzIHMzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zMyc7XG5pbXBvcnQgKiBhcyBjbG91ZGZyb250IGZyb20gJ2F3cy1jZGstbGliL2F3cy1jbG91ZGZyb250JztcbmltcG9ydCAqIGFzIG9yaWdpbnMgZnJvbSAnYXdzLWNkay1saWIvYXdzLWNsb3VkZnJvbnQtb3JpZ2lucyc7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBzM2RlcGxveSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtczMtZGVwbG95bWVudCc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJlZmZJbmZyYXN0cnVjdHVyZVN0YWNrUHJvcHMgZXh0ZW5kcyBjZGsuU3RhY2tQcm9wcyB7XG4gIGluc3RhbmNlVHlwZTogc3RyaW5nO1xuICBteXNxbFJvb3RQYXNzd29yZDogc3RyaW5nO1xuICBteXNxbERhdGFiYXNlOiBzdHJpbmc7XG4gIG15c3FsVXNlcjogc3RyaW5nO1xuICBteXNxbFBhc3N3b3JkOiBzdHJpbmc7XG4gIGRvbWFpbk5hbWU/OiBzdHJpbmc7XG4gIGZyb250ZW5kQnVja2V0TmFtZT86IHN0cmluZztcbiAgYXNzZXRzQnVja2V0TmFtZT86IHN0cmluZztcbiAgdHdpbGlvQWNjb3VudFNpZD86IHN0cmluZztcbiAgdHdpbGlvQXV0aFRva2VuPzogc3RyaW5nO1xuICB0d2lsaW9QaG9uZT86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIFRyZWZmSW5mcmFzdHJ1Y3R1cmVTdGFjayBleHRlbmRzIGNkay5TdGFjayB7XG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBUcmVmZkluZnJhc3RydWN0dXJlU3RhY2tQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIFZQQyBhbmQgTmV0d29ya2luZ1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyh0aGlzLCAnVHJlZmZWUEMnLCB7XG4gICAgICBtYXhBenM6IDIsXG4gICAgICBuYXRHYXRld2F5czogMCwgLy8gU2F2ZSBjb3N0cyAtIHVzZSBwdWJsaWMgc3VibmV0IG9ubHlcbiAgICAgIHN1Ym5ldENvbmZpZ3VyYXRpb246IFtcbiAgICAgICAge1xuICAgICAgICAgIGNpZHJNYXNrOiAyNCxcbiAgICAgICAgICBuYW1lOiAnUHVibGljJyxcbiAgICAgICAgICBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QVUJMSUMsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgLy8gU2VjdXJpdHkgR3JvdXAgZm9yIEVDMlxuICAgIGNvbnN0IGVjMlNlY3VyaXR5R3JvdXAgPSBuZXcgZWMyLlNlY3VyaXR5R3JvdXAodGhpcywgJ1RyZWZmRUMyU2VjdXJpdHlHcm91cCcsIHtcbiAgICAgIHZwYyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnU2VjdXJpdHkgZ3JvdXAgZm9yIFRyZWZmIEVDMiBpbnN0YW5jZScsXG4gICAgICBhbGxvd0FsbE91dGJvdW5kOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgLy8gQWxsb3cgSFRUUC9IVFRQUyBmcm9tIGFueXdoZXJlXG4gICAgZWMyU2VjdXJpdHlHcm91cC5hZGRJbmdyZXNzUnVsZShcbiAgICAgIGVjMi5QZWVyLmFueUlwdjQoKSxcbiAgICAgIGVjMi5Qb3J0LnRjcCg4MCksXG4gICAgICAnQWxsb3cgSFRUUCB0cmFmZmljJ1xuICAgICk7XG4gICAgZWMyU2VjdXJpdHlHcm91cC5hZGRJbmdyZXNzUnVsZShcbiAgICAgIGVjMi5QZWVyLmFueUlwdjQoKSxcbiAgICAgIGVjMi5Qb3J0LnRjcCg0NDMpLFxuICAgICAgJ0FsbG93IEhUVFBTIHRyYWZmaWMnXG4gICAgKTtcblxuICAgIC8vIEFsbG93IFNTSCAob3B0aW9uYWwgLSBmb3IgZGVidWdnaW5nKVxuICAgIGVjMlNlY3VyaXR5R3JvdXAuYWRkSW5ncmVzc1J1bGUoXG4gICAgICBlYzIuUGVlci5hbnlJcHY0KCksXG4gICAgICBlYzIuUG9ydC50Y3AoMjIpLFxuICAgICAgJ0FsbG93IFNTSCBhY2Nlc3MnXG4gICAgKTtcblxuICAgIC8vIEFsbG93IE15U1FMIHBvcnQgKGZvciBleHRlcm5hbCBhY2Nlc3MgaWYgbmVlZGVkKVxuICAgIGVjMlNlY3VyaXR5R3JvdXAuYWRkSW5ncmVzc1J1bGUoXG4gICAgICBlYzIuUGVlci5hbnlJcHY0KCksXG4gICAgICBlYzIuUG9ydC50Y3AoMzMwNiksXG4gICAgICAnQWxsb3cgTXlTUUwgYWNjZXNzIChvcHRpb25hbCAtIGNhbiBiZSByZW1vdmVkIGZvciBwcm9kdWN0aW9uKSdcbiAgICApO1xuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIEVDMiBJbnN0YW5jZSBmb3IgQmFja2VuZCArIE15U1FMXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIC8vIElBTSBSb2xlIGZvciBFQzJcbiAgICBjb25zdCBlYzJSb2xlID0gbmV3IGlhbS5Sb2xlKHRoaXMsICdUcmVmZkVDMlJvbGUnLCB7XG4gICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnZWMyLmFtYXpvbmF3cy5jb20nKSxcbiAgICAgIG1hbmFnZWRQb2xpY2llczogW1xuICAgICAgICBpYW0uTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoJ0FtYXpvblNTTU1hbmFnZWRJbnN0YW5jZUNvcmUnKSxcbiAgICAgICAgaWFtLk1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCdDbG91ZFdhdGNoQWdlbnRTZXJ2ZXJQb2xpY3knKSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICAvLyBHcmFudCBTMyBhY2Nlc3MgZm9yIGRlcGxveW1lbnRzIChpZiBkZXBsb3ltZW50IGJ1Y2tldCBleGlzdHMpXG4gICAgaWYgKHByb3BzLmFzc2V0c0J1Y2tldE5hbWUpIHtcbiAgICAgIGNvbnN0IGRlcGxveW1lbnRCdWNrZXQgPSBzMy5CdWNrZXQuZnJvbUJ1Y2tldE5hbWUodGhpcywgJ0RlcGxveW1lbnRCdWNrZXQnLCAndHJlZmYtZGVwbG95bWVudHMtcHJvZCcpO1xuICAgICAgZGVwbG95bWVudEJ1Y2tldC5ncmFudFJlYWQoZWMyUm9sZSk7XG4gICAgfVxuXG4gICAgLy8gVXNlciBkYXRhIHNjcmlwdFxuICAgIGNvbnN0IHVzZXJEYXRhU2NyaXB0ID0gZWMyLlVzZXJEYXRhLmZvckxpbnV4KCk7XG4gICAgdXNlckRhdGFTY3JpcHQuYWRkQ29tbWFuZHMoXG4gICAgICAnIyEvYmluL2Jhc2gnLFxuICAgICAgJ3NldCAtZScsXG4gICAgICAnJyxcbiAgICAgICcjIFVwZGF0ZSBzeXN0ZW0nLFxuICAgICAgJ2FwdC1nZXQgdXBkYXRlIC15JyxcbiAgICAgICdhcHQtZ2V0IHVwZ3JhZGUgLXknLFxuICAgICAgJycsXG4gICAgICAnIyBJbnN0YWxsIGRlcGVuZGVuY2llcycsXG4gICAgICAnYXB0LWdldCBpbnN0YWxsIC15IHdnZXQgY3VybCBnaXQgbmdpbnggbXlzcWwtc2VydmVyIG15c3FsLWNsaWVudCB1bnppcCcsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgTXlTUUwgU2V0dXAnLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnc3lzdGVtY3RsIHN0YXJ0IG15c3FsJyxcbiAgICAgICdzeXN0ZW1jdGwgZW5hYmxlIG15c3FsJyxcbiAgICAgICcnLFxuICAgICAgYCMgU2V0IE15U1FMIHJvb3QgcGFzc3dvcmRgLFxuICAgICAgYG15c3FsIC1lIFwiQUxURVIgVVNFUiAncm9vdCdAJ2xvY2FsaG9zdCcgSURFTlRJRklFRCBXSVRIIG15c3FsX25hdGl2ZV9wYXNzd29yZCBCWSAnJHtwcm9wcy5teXNxbFJvb3RQYXNzd29yZH0nO1wiYCxcbiAgICAgIGBteXNxbCAtZSBcIkZMVVNIIFBSSVZJTEVHRVM7XCJgLFxuICAgICAgJycsXG4gICAgICBgIyBDcmVhdGUgZGF0YWJhc2UgYW5kIHVzZXJgLFxuICAgICAgYG15c3FsIC11cm9vdCAtcCcke3Byb3BzLm15c3FsUm9vdFBhc3N3b3JkfScgLWUgXCJDUkVBVEUgREFUQUJBU0UgSUYgTk9UIEVYSVNUUyAke3Byb3BzLm15c3FsRGF0YWJhc2V9O1wiYCxcbiAgICAgIGBteXNxbCAtdXJvb3QgLXAnJHtwcm9wcy5teXNxbFJvb3RQYXNzd29yZH0nIC1lIFwiQ1JFQVRFIFVTRVIgSUYgTk9UIEVYSVNUUyAnJHtwcm9wcy5teXNxbFVzZXJ9J0AnbG9jYWxob3N0JyBJREVOVElGSUVEIEJZICcke3Byb3BzLm15c3FsUGFzc3dvcmR9JztcImAsXG4gICAgICBgbXlzcWwgLXVyb290IC1wJyR7cHJvcHMubXlzcWxSb290UGFzc3dvcmR9JyAtZSBcIkdSQU5UIEFMTCBQUklWSUxFR0VTIE9OICR7cHJvcHMubXlzcWxEYXRhYmFzZX0uKiBUTyAnJHtwcm9wcy5teXNxbFVzZXJ9J0AnbG9jYWxob3N0JztcImAsXG4gICAgICBgbXlzcWwgLXVyb290IC1wJyR7cHJvcHMubXlzcWxSb290UGFzc3dvcmR9JyAtZSBcIkZMVVNIIFBSSVZJTEVHRVM7XCJgLFxuICAgICAgJycsXG4gICAgICAnIyBDb25maWd1cmUgTXlTUUwgdG8gbGlzdGVuIG9uIGFsbCBpbnRlcmZhY2VzIChvcHRpb25hbCknLFxuICAgICAgYHNlZCAtaSAncy9iaW5kLWFkZHJlc3MuKi9iaW5kLWFkZHJlc3MgPSAwLjAuMC4wLycgL2V0Yy9teXNxbC9teXNxbC5jb25mLmQvbXlzcWxkLmNuZmAsXG4gICAgICAnc3lzdGVtY3RsIHJlc3RhcnQgbXlzcWwnLFxuICAgICAgJycsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICcjIC5ORVQgOCBSdW50aW1lIEluc3RhbGxhdGlvbicsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICd3Z2V0IGh0dHBzOi8vZG90Lm5ldC92MS9kb3RuZXQtaW5zdGFsbC5zaCAtTyBkb3RuZXQtaW5zdGFsbC5zaCcsXG4gICAgICAnY2htb2QgK3ggZG90bmV0LWluc3RhbGwuc2gnLFxuICAgICAgJy4vZG90bmV0LWluc3RhbGwuc2ggLS1jaGFubmVsIDguMCAtLXJ1bnRpbWUgYXNwbmV0Y29yZScsXG4gICAgICAnLi9kb3RuZXQtaW5zdGFsbC5zaCAtLWNoYW5uZWwgOC4wIC0tcnVudGltZSBkb3RuZXQnLFxuICAgICAgJycsXG4gICAgICAnIyBBZGQgLk5FVCB0byBQQVRIJyxcbiAgICAgICdlY2hvIFwiZXhwb3J0IERPVE5FVF9ST09UPSRIT01FLy5kb3RuZXRcIiA+PiAvcm9vdC8uYmFzaHJjJyxcbiAgICAgICdlY2hvIFwiZXhwb3J0IFBBVEg9JFBBVEg6JERPVE5FVF9ST09UOiRET1RORVRfUk9PVC90b29sc1wiID4+IC9yb290Ly5iYXNocmMnLFxuICAgICAgJ2V4cG9ydCBET1RORVRfUk9PVD0kSE9NRS8uZG90bmV0JyxcbiAgICAgICdleHBvcnQgUEFUSD0kUEFUSDokRE9UTkVUX1JPT1Q6JERPVE5FVF9ST09UL3Rvb2xzJyxcbiAgICAgICcnLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnIyBBcHBsaWNhdGlvbiBTZXR1cCBEaXJlY3RvcnknLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnbWtkaXIgLXAgL3Zhci93d3cvdHJlZmYtYmFja2VuZCcsXG4gICAgICAnY2hvd24gLVIgd3d3LWRhdGE6d3d3LWRhdGEgL3Zhci93d3cvdHJlZmYtYmFja2VuZCcsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgTmdpbnggQ29uZmlndXJhdGlvbicsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICdjYXQgPiAvZXRjL25naW54L3NpdGVzLWF2YWlsYWJsZS90cmVmZiA8PEVPRicsXG4gICAgICAnc2VydmVyIHsnLFxuICAgICAgJyAgICBsaXN0ZW4gODA7JyxcbiAgICAgICcgICAgc2VydmVyX25hbWUgXzsnLFxuICAgICAgJycsXG4gICAgICAnICAgIGxvY2F0aW9uIC8geycsXG4gICAgICAnICAgICAgICBwcm94eV9wYXNzIGh0dHA6Ly8xMjcuMC4wLjE6NTAwMDsnLFxuICAgICAgJyAgICAgICAgcHJveHlfaHR0cF92ZXJzaW9uIDEuMTsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBVcGdyYWRlIFxcXFwkaHR0cF91cGdyYWRlOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIENvbm5lY3Rpb24gXCJ1cGdyYWRlXCI7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgSG9zdCBcXFxcJGhvc3Q7JyxcbiAgICAgICcgICAgICAgIHByb3h5X2NhY2hlX2J5cGFzcyBcXFxcJGh0dHBfdXBncmFkZTsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Gb3IgXFxcXCRwcm94eV9hZGRfeF9mb3J3YXJkZWRfZm9yOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLVByb3RvIFxcXFwkc2NoZW1lOycsXG4gICAgICAnICAgIH0nLFxuICAgICAgJycsXG4gICAgICAnICAgICMgU2lnbmFsUiBXZWJTb2NrZXQgc3VwcG9ydCcsXG4gICAgICAnICAgIGxvY2F0aW9uIC9odWJzLyB7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3Bhc3MgaHR0cDovLzEyNy4wLjAuMTo1MDAwOycsXG4gICAgICAnICAgICAgICBwcm94eV9odHRwX3ZlcnNpb24gMS4xOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFVwZ3JhZGUgXFxcXCRodHRwX3VwZ3JhZGU7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgQ29ubmVjdGlvbiBcInVwZ3JhZGVcIjsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBIb3N0IFxcXFwkaG9zdDsnLFxuICAgICAgJyAgICAgICAgcHJveHlfY2FjaGVfYnlwYXNzIFxcXFwkaHR0cF91cGdyYWRlOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLUZvciBcXFxcJHByb3h5X2FkZF94X2ZvcndhcmRlZF9mb3I7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgWC1Gb3J3YXJkZWQtUHJvdG8gXFxcXCRzY2hlbWU7JyxcbiAgICAgICcgICAgfScsXG4gICAgICAnfScsXG4gICAgICAnRU9GJyxcbiAgICAgICcnLFxuICAgICAgJ2xuIC1zZiAvZXRjL25naW54L3NpdGVzLWF2YWlsYWJsZS90cmVmZiAvZXRjL25naW54L3NpdGVzLWVuYWJsZWQvJyxcbiAgICAgICdybSAtZiAvZXRjL25naW54L3NpdGVzLWVuYWJsZWQvZGVmYXVsdCcsXG4gICAgICAnbmdpbnggLXQnLFxuICAgICAgJ3N5c3RlbWN0bCByZXN0YXJ0IG5naW54JyxcbiAgICAgICdzeXN0ZW1jdGwgZW5hYmxlIG5naW54JyxcbiAgICAgICcnLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnIyBDcmVhdGUgc3lzdGVtZCBzZXJ2aWNlIGZvciAuTkVUIGFwcCcsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICdjYXQgPiAvZXRjL3N5c3RlbWQvc3lzdGVtL3RyZWZmLWJhY2tlbmQuc2VydmljZSA8PEVPRicsXG4gICAgICAnW1VuaXRdJyxcbiAgICAgICdEZXNjcmlwdGlvbj1UcmVmZiAuTkVUIEJhY2tlbmQnLFxuICAgICAgJ0FmdGVyPW5ldHdvcmsudGFyZ2V0IG15c3FsLnNlcnZpY2UnLFxuICAgICAgJycsXG4gICAgICAnW1NlcnZpY2VdJyxcbiAgICAgICdUeXBlPW5vdGlmeScsXG4gICAgICAnV29ya2luZ0RpcmVjdG9yeT0vdmFyL3d3dy90cmVmZi1iYWNrZW5kJyxcbiAgICAgICdFeGVjU3RhcnQ9L3Jvb3QvLmRvdG5ldC9kb3RuZXQgL3Zhci93d3cvdHJlZmYtYmFja2VuZC9XZWJBcGkuZGxsJyxcbiAgICAgICdSZXN0YXJ0PWFsd2F5cycsXG4gICAgICAnUmVzdGFydFNlYz0xMCcsXG4gICAgICAnS2lsbFNpZ25hbD1TSUdJTlQnLFxuICAgICAgJ1N5c2xvZ0lkZW50aWZpZXI9dHJlZmYtYmFja2VuZCcsXG4gICAgICAnVXNlcj13d3ctZGF0YScsXG4gICAgICAnRW52aXJvbm1lbnQ9QVNQTkVUQ09SRV9FTlZJUk9OTUVOVD1Qcm9kdWN0aW9uJyxcbiAgICAgICdFbnZpcm9ubWVudD1ET1RORVRfUk9PVD0vcm9vdC8uZG90bmV0JyxcbiAgICAgICdFbnZpcm9ubWVudD1QQVRIPS91c3IvbG9jYWwvc2JpbjovdXNyL2xvY2FsL2JpbjovdXNyL3NiaW46L3Vzci9iaW46L3NiaW46L2Jpbjovcm9vdC8uZG90bmV0Oi9yb290Ly5kb3RuZXQvdG9vbHMnLFxuICAgICAgLi4uKHByb3BzLnR3aWxpb0FjY291bnRTaWQgPyBbYEVudmlyb25tZW50PVR3aWxpb0NvbmZpZ19fQWNjb3VudFNpZD0ke3Byb3BzLnR3aWxpb0FjY291bnRTaWR9YF0gOiBbXSksXG4gICAgICAuLi4ocHJvcHMudHdpbGlvQXV0aFRva2VuID8gW2BFbnZpcm9ubWVudD1Ud2lsaW9Db25maWdfX0F1dGhUb2tlbj0ke3Byb3BzLnR3aWxpb0F1dGhUb2tlbn1gXSA6IFtdKSxcbiAgICAgIC4uLihwcm9wcy50d2lsaW9QaG9uZSA/IFtgRW52aXJvbm1lbnQ9VHdpbGlvQ29uZmlnX19QaG9uZT0ke3Byb3BzLnR3aWxpb1Bob25lfWBdIDogW10pLFxuICAgICAgJycsXG4gICAgICAnW0luc3RhbGxdJyxcbiAgICAgICdXYW50ZWRCeT1tdWx0aS11c2VyLnRhcmdldCcsXG4gICAgICAnRU9GJyxcbiAgICAgICcnLFxuICAgICAgJ3N5c3RlbWN0bCBkYWVtb24tcmVsb2FkJyxcbiAgICAgICcjIE5vdGU6IFNlcnZpY2Ugd2lsbCBmYWlsIHVudGlsIHlvdSBkZXBsb3kgdGhlIGFwcGxpY2F0aW9uJyxcbiAgICAgICcjIHN5c3RlbWN0bCBlbmFibGUgdHJlZmYtYmFja2VuZCcsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgQ3JlYXRlIGRlcGxveW1lbnQgc2NyaXB0JyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJ2NhdCA+IC9yb290L2RlcGxveS1iYWNrZW5kLnNoIDw8RU9GJyxcbiAgICAgICcjIS9iaW4vYmFzaCcsXG4gICAgICAnZWNobyBcIlN0b3BwaW5nIGJhY2tlbmQgc2VydmljZS4uLlwiJyxcbiAgICAgICdzeXN0ZW1jdGwgc3RvcCB0cmVmZi1iYWNrZW5kJyxcbiAgICAgICcnLFxuICAgICAgJ2VjaG8gXCJEZXBsb3lpbmcgbmV3IHZlcnNpb24uLi5cIicsXG4gICAgICAnIyBZb3VyIGRlcGxveW1lbnQgY29tbWFuZHMgaGVyZScsXG4gICAgICAnIyBFeGFtcGxlOiBjb3B5IGZpbGVzLCBydW4gbWlncmF0aW9ucywgZXRjLicsXG4gICAgICAnJyxcbiAgICAgICdlY2hvIFwiU3RhcnRpbmcgYmFja2VuZCBzZXJ2aWNlLi4uXCInLFxuICAgICAgJ3N5c3RlbWN0bCBzdGFydCB0cmVmZi1iYWNrZW5kJyxcbiAgICAgICdzeXN0ZW1jdGwgc3RhdHVzIHRyZWZmLWJhY2tlbmQnLFxuICAgICAgJ0VPRicsXG4gICAgICAnJyxcbiAgICAgICdjaG1vZCAreCAvcm9vdC9kZXBsb3ktYmFja2VuZC5zaCcsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgSW5zdGFsbCBDbG91ZFdhdGNoIGFnZW50IChvcHRpb25hbCknLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnd2dldCBodHRwczovL3MzLmFtYXpvbmF3cy5jb20vYW1hem9uY2xvdWR3YXRjaC1hZ2VudC91YnVudHUvYXJtNjQvbGF0ZXN0L2FtYXpvbi1jbG91ZHdhdGNoLWFnZW50LmRlYicsXG4gICAgICAnZHBrZyAtaSAtRSAuL2FtYXpvbi1jbG91ZHdhdGNoLWFnZW50LmRlYicsXG4gICAgICAnJyxcbiAgICAgICdlY2hvIFwiRUMyIHNldHVwIGNvbXBsZXRlIVwiJyxcbiAgICAgICdlY2hvIFwiTXlTUUwgcm9vdCBwYXNzd29yZDogJHtwcm9wcy5teXNxbFJvb3RQYXNzd29yZH1cIicsXG4gICAgICAnZWNobyBcIk15U1FMIGRhdGFiYXNlOiAke3Byb3BzLm15c3FsRGF0YWJhc2V9XCInLFxuICAgICAgJ2VjaG8gXCJNeVNRTCB1c2VyOiAke3Byb3BzLm15c3FsVXNlcn1cIicsXG4gICAgICAnZWNobyBcIk15U1FMIHBhc3N3b3JkOiAke3Byb3BzLm15c3FsUGFzc3dvcmR9XCInLFxuICAgICAgJ2VjaG8gXCJcIicsXG4gICAgICAnZWNobyBcIk5leHQgc3RlcHM6XCInLFxuICAgICAgJ2VjaG8gXCIxLiBEZXBsb3kgeW91ciAuTkVUIGFwcGxpY2F0aW9uIHRvIC92YXIvd3d3L3RyZWZmLWJhY2tlbmQvXCInLFxuICAgICAgJ2VjaG8gXCIyLiBVcGRhdGUgY29ubmVjdGlvbiBzdHJpbmcgaW4gYXBwc2V0dGluZ3MuUHJvZHVjdGlvbi5qc29uXCInLFxuICAgICAgJ2VjaG8gXCIzLiBSdW46IHN5c3RlbWN0bCBlbmFibGUgdHJlZmYtYmFja2VuZFwiJyxcbiAgICAgICdlY2hvIFwiNC4gUnVuOiBzeXN0ZW1jdGwgc3RhcnQgdHJlZmYtYmFja2VuZFwiJyxcbiAgICApO1xuXG4gICAgLy8gRUMyIEluc3RhbmNlXG4gICAgY29uc3QgZWMySW5zdGFuY2UgPSBuZXcgZWMyLkluc3RhbmNlKHRoaXMsICdUcmVmZkVDMkluc3RhbmNlJywge1xuICAgICAgdnBjLFxuICAgICAgdnBjU3VibmV0czoge1xuICAgICAgICBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QVUJMSUMsXG4gICAgICB9LFxuICAgICAgaW5zdGFuY2VUeXBlOiBuZXcgZWMyLkluc3RhbmNlVHlwZShwcm9wcy5pbnN0YW5jZVR5cGUpLFxuICAgICAgbWFjaGluZUltYWdlOiBlYzIuTWFjaGluZUltYWdlLmZyb21Tc21QYXJhbWV0ZXIoXG4gICAgICAgICcvYXdzL3NlcnZpY2UvY2Fub25pY2FsL3VidW50dS9zZXJ2ZXIvMjIuMDQvc3RhYmxlL2N1cnJlbnQvYXJtNjQvaHZtL2Vicy1ncDIvYW1pLWlkJyxcbiAgICAgICAge1xuICAgICAgICAgIG9zOiBlYzIuT3BlcmF0aW5nU3lzdGVtVHlwZS5MSU5VWCxcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHNlY3VyaXR5R3JvdXA6IGVjMlNlY3VyaXR5R3JvdXAsXG4gICAgICByb2xlOiBlYzJSb2xlLFxuICAgICAgdXNlckRhdGE6IHVzZXJEYXRhU2NyaXB0LFxuICAgICAgYmxvY2tEZXZpY2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBkZXZpY2VOYW1lOiAnL2Rldi9zZGExJyxcbiAgICAgICAgICB2b2x1bWU6IGVjMi5CbG9ja0RldmljZVZvbHVtZS5lYnMoMzAsIHtcbiAgICAgICAgICAgIHZvbHVtZVR5cGU6IGVjMi5FYnNEZXZpY2VWb2x1bWVUeXBlLkdQMyxcbiAgICAgICAgICAgIGRlbGV0ZU9uVGVybWluYXRpb246IHRydWUsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgLy8gRWxhc3RpYyBJUCBmb3IgRUMyXG4gICAgY29uc3QgZWlwID0gbmV3IGVjMi5DZm5FSVAodGhpcywgJ1RyZWZmRUMyRUlQJywge1xuICAgICAgaW5zdGFuY2VJZDogZWMySW5zdGFuY2UuaW5zdGFuY2VJZCxcbiAgICB9KTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBTMyBCdWNrZXQgZm9yIEZyb250ZW5kICh1c2UgZXhpc3Rpbmcgb3IgY3JlYXRlIG5ldylcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgY29uc3QgZnJvbnRlbmRCdWNrZXQgPSBwcm9wcy5mcm9udGVuZEJ1Y2tldE5hbWVcbiAgICAgID8gczMuQnVja2V0LmZyb21CdWNrZXROYW1lKHRoaXMsICdUcmVmZkZyb250ZW5kQnVja2V0JywgcHJvcHMuZnJvbnRlbmRCdWNrZXROYW1lKVxuICAgICAgOiBuZXcgczMuQnVja2V0KHRoaXMsICdUcmVmZkZyb250ZW5kQnVja2V0Jywge1xuICAgICAgICAgIGJ1Y2tldE5hbWU6IGB0cmVmZi1mcm9udGVuZC0ke3RoaXMuYWNjb3VudH1gLFxuICAgICAgICAgIHdlYnNpdGVJbmRleERvY3VtZW50OiAnaW5kZXguaHRtbCcsXG4gICAgICAgICAgd2Vic2l0ZUVycm9yRG9jdW1lbnQ6ICdpbmRleC5odG1sJyxcbiAgICAgICAgICBwdWJsaWNSZWFkQWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBibG9ja1B1YmxpY0FjY2VzczogczMuQmxvY2tQdWJsaWNBY2Nlc3MuQkxPQ0tfQUxMLFxuICAgICAgICAgIHJlbW92YWxQb2xpY3k6IGNkay5SZW1vdmFsUG9saWN5LlJFVEFJTixcbiAgICAgICAgICBhdXRvRGVsZXRlT2JqZWN0czogZmFsc2UsXG4gICAgICAgICAgZW5jcnlwdGlvbjogczMuQnVja2V0RW5jcnlwdGlvbi5TM19NQU5BR0VELFxuICAgICAgICB9KTtcblxuICAgIC8vIE9yaWdpbiBBY2Nlc3MgSWRlbnRpdHkgZm9yIENsb3VkRnJvbnRcbiAgICBjb25zdCBvYWkgPSBuZXcgY2xvdWRmcm9udC5PcmlnaW5BY2Nlc3NJZGVudGl0eSh0aGlzLCAnVHJlZmZPQUknLCB7XG4gICAgICBjb21tZW50OiAnT0FJIGZvciBUcmVmZiBmcm9udGVuZCcsXG4gICAgfSk7XG5cbiAgICAvLyBHcmFudCBDbG91ZEZyb250IHJlYWQgYWNjZXNzIHRvIHRoZSBmcm9udGVuZCBidWNrZXRcbiAgICAvLyBGb3IgbWFudWFsbHkgY3JlYXRlZCBidWNrZXRzLCB3ZSBuZWVkIHRvIGFkZCB0aGUgcG9saWN5IHN0YXRlbWVudCBkaXJlY3RseVxuICAgIGlmIChwcm9wcy5mcm9udGVuZEJ1Y2tldE5hbWUpIHtcbiAgICAgIC8vIEltcG9ydGVkIGJ1Y2tldCAtIGFkZCBwb2xpY3kgbWFudWFsbHlcbiAgICAgIGNvbnN0IGJ1Y2tldFBvbGljeSA9IG5ldyBzMy5DZm5CdWNrZXRQb2xpY3kodGhpcywgJ0Zyb250ZW5kQnVja2V0UG9saWN5Jywge1xuICAgICAgICBidWNrZXQ6IHByb3BzLmZyb250ZW5kQnVja2V0TmFtZSxcbiAgICAgICAgcG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgICBTdGF0ZW1lbnQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICBQcmluY2lwYWw6IHtcbiAgICAgICAgICAgICAgICBDYW5vbmljYWxVc2VyOiBvYWkuY2xvdWRGcm9udE9yaWdpbkFjY2Vzc0lkZW50aXR5UzNDYW5vbmljYWxVc2VySWQsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIEFjdGlvbjogJ3MzOkdldE9iamVjdCcsXG4gICAgICAgICAgICAgIFJlc291cmNlOiBgYXJuOmF3czpzMzo6OiR7cHJvcHMuZnJvbnRlbmRCdWNrZXROYW1lfS8qYCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZnJvbnRlbmRCdWNrZXQgaW5zdGFuY2VvZiBzMy5CdWNrZXQpIHtcbiAgICAgIC8vIENESy1jcmVhdGVkIGJ1Y2tldCAtIHVzZSBncmFudFJlYWQgaGVscGVyXG4gICAgICBmcm9udGVuZEJ1Y2tldC5ncmFudFJlYWQob2FpKTtcbiAgICB9XG5cbiAgICAvLyBDbG91ZEZyb250IERpc3RyaWJ1dGlvblxuICAgIGNvbnN0IGRpc3RyaWJ1dGlvbiA9IG5ldyBjbG91ZGZyb250LkRpc3RyaWJ1dGlvbih0aGlzLCAnVHJlZmZEaXN0cmlidXRpb24nLCB7XG4gICAgICBkZWZhdWx0QmVoYXZpb3I6IHtcbiAgICAgICAgb3JpZ2luOiBuZXcgb3JpZ2lucy5TM09yaWdpbihmcm9udGVuZEJ1Y2tldCwge1xuICAgICAgICAgIG9yaWdpbkFjY2Vzc0lkZW50aXR5OiBvYWksXG4gICAgICAgIH0pLFxuICAgICAgICB2aWV3ZXJQcm90b2NvbFBvbGljeTogY2xvdWRmcm9udC5WaWV3ZXJQcm90b2NvbFBvbGljeS5SRURJUkVDVF9UT19IVFRQUyxcbiAgICAgICAgY2FjaGVQb2xpY3k6IGNsb3VkZnJvbnQuQ2FjaGVQb2xpY3kuQ0FDSElOR19PUFRJTUlaRUQsXG4gICAgICB9LFxuICAgICAgYWRkaXRpb25hbEJlaGF2aW9yczoge1xuICAgICAgICAnL2FwaS8qJzoge1xuICAgICAgICAgIG9yaWdpbjogbmV3IG9yaWdpbnMuSHR0cE9yaWdpbihlYzJJbnN0YW5jZS5pbnN0YW5jZVB1YmxpY0Ruc05hbWUsIHtcbiAgICAgICAgICAgIHByb3RvY29sUG9saWN5OiBjbG91ZGZyb250Lk9yaWdpblByb3RvY29sUG9saWN5LkhUVFBfT05MWSxcbiAgICAgICAgICAgIGh0dHBQb3J0OiA4MCxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICB2aWV3ZXJQcm90b2NvbFBvbGljeTogY2xvdWRmcm9udC5WaWV3ZXJQcm90b2NvbFBvbGljeS5SRURJUkVDVF9UT19IVFRQUyxcbiAgICAgICAgICBjYWNoZVBvbGljeTogY2xvdWRmcm9udC5DYWNoZVBvbGljeS5DQUNISU5HX0RJU0FCTEVELFxuICAgICAgICAgIGFsbG93ZWRNZXRob2RzOiBjbG91ZGZyb250LkFsbG93ZWRNZXRob2RzLkFMTE9XX0FMTCxcbiAgICAgICAgICBvcmlnaW5SZXF1ZXN0UG9saWN5OiBjbG91ZGZyb250Lk9yaWdpblJlcXVlc3RQb2xpY3kuQUxMX1ZJRVdFUixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBkZWZhdWx0Um9vdE9iamVjdDogJ2luZGV4Lmh0bWwnLFxuICAgICAgZXJyb3JSZXNwb25zZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGh0dHBTdGF0dXM6IDQwMyxcbiAgICAgICAgICByZXNwb25zZUh0dHBTdGF0dXM6IDIwMCxcbiAgICAgICAgICByZXNwb25zZVBhZ2VQYXRoOiAnL2luZGV4Lmh0bWwnLFxuICAgICAgICAgIHR0bDogY2RrLkR1cmF0aW9uLm1pbnV0ZXMoNSksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBodHRwU3RhdHVzOiA0MDQsXG4gICAgICAgICAgcmVzcG9uc2VIdHRwU3RhdHVzOiAyMDAsXG4gICAgICAgICAgcmVzcG9uc2VQYWdlUGF0aDogJy9pbmRleC5odG1sJyxcbiAgICAgICAgICB0dGw6IGNkay5EdXJhdGlvbi5taW51dGVzKDUpLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHByaWNlQ2xhc3M6IGNsb3VkZnJvbnQuUHJpY2VDbGFzcy5QUklDRV9DTEFTU18xMDAsIC8vIENoZWFwZXN0IG9wdGlvblxuICAgIH0pO1xuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIE91dHB1dHNcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0VDMlB1YmxpY0lQJywge1xuICAgICAgdmFsdWU6IGVpcC5yZWYsXG4gICAgICBkZXNjcmlwdGlvbjogJ0VDMiBJbnN0YW5jZSBQdWJsaWMgSVAnLFxuICAgIH0pO1xuXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0VDMkluc3RhbmNlSWQnLCB7XG4gICAgICB2YWx1ZTogZWMySW5zdGFuY2UuaW5zdGFuY2VJZCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnRUMyIEluc3RhbmNlIElEJyxcbiAgICB9KTtcblxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdCYWNrZW5kVVJMJywge1xuICAgICAgdmFsdWU6IGBodHRwczovLyR7ZGlzdHJpYnV0aW9uLmRpc3RyaWJ1dGlvbkRvbWFpbk5hbWV9L2AsXG4gICAgICBkZXNjcmlwdGlvbjogJ0JhY2tlbmQgQVBJIFVSTCAodmlhIENsb3VkRnJvbnQpJyxcbiAgICB9KTtcblxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdCYWNrZW5kRGlyZWN0VVJMJywge1xuICAgICAgdmFsdWU6IGBodHRwOi8vJHtlaXAucmVmfS9gLFxuICAgICAgZGVzY3JpcHRpb246ICdCYWNrZW5kIERpcmVjdCBVUkwgKEhUVFAgb25seSAtIHVzZSBDbG91ZEZyb250IFVSTCBpbnN0ZWFkKScsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnRnJvbnRlbmRCdWNrZXQnLCB7XG4gICAgICB2YWx1ZTogZnJvbnRlbmRCdWNrZXQuYnVja2V0TmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiAnUzMgQnVja2V0IGZvciBGcm9udGVuZCcsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnQ2xvdWRGcm9udFVSTCcsIHtcbiAgICAgIHZhbHVlOiBgaHR0cHM6Ly8ke2Rpc3RyaWJ1dGlvbi5kaXN0cmlidXRpb25Eb21haW5OYW1lfWAsXG4gICAgICBkZXNjcmlwdGlvbjogJ0Nsb3VkRnJvbnQgRGlzdHJpYnV0aW9uIFVSTCcsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnQ2xvdWRGcm9udERpc3RyaWJ1dGlvbklkJywge1xuICAgICAgdmFsdWU6IGRpc3RyaWJ1dGlvbi5kaXN0cmlidXRpb25JZCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQ2xvdWRGcm9udCBEaXN0cmlidXRpb24gSUQnLFxuICAgIH0pO1xuXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ015U1FMQ29ubmVjdGlvblN0cmluZycsIHtcbiAgICAgIHZhbHVlOiBgU2VydmVyPSR7ZWlwLnJlZn07RGF0YWJhc2U9JHtwcm9wcy5teXNxbERhdGFiYXNlfTtVaWQ9JHtwcm9wcy5teXNxbFVzZXJ9O1B3ZD0ke3Byb3BzLm15c3FsUGFzc3dvcmR9O2AsXG4gICAgICBkZXNjcmlwdGlvbjogJ015U1FMIENvbm5lY3Rpb24gU3RyaW5nJyxcbiAgICB9KTtcblxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdTU0hDb21tYW5kJywge1xuICAgICAgdmFsdWU6IGBzc2ggLWkgeW91ci1rZXkucGVtIHVidW50dUAke2VpcC5yZWZ9YCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnU1NIIENvbW1hbmQgKHlvdSBuZWVkIHRvIGFkZCBhIGtleSBwYWlyKScsXG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==
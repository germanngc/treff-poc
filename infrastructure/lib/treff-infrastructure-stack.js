"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.TreffInfrastructureStack = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const ec2 = __importStar(require("aws-cdk-lib/aws-ec2"));
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const cloudfront = __importStar(require("aws-cdk-lib/aws-cloudfront"));
const origins = __importStar(require("aws-cdk-lib/aws-cloudfront-origins"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
class TreffInfrastructureStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        // ========================================
        // VPC and Networking
        // ========================================
        const vpc = new ec2.Vpc(this, 'TreffVPC', {
            maxAzs: 2,
            natGateways: 0, // Save costs - use public subnet only
            subnetConfiguration: [
                {
                    cidrMask: 24,
                    name: 'Public',
                    subnetType: ec2.SubnetType.PUBLIC,
                },
            ],
        });
        // Security Group for EC2
        const ec2SecurityGroup = new ec2.SecurityGroup(this, 'TreffEC2SecurityGroup', {
            vpc,
            description: 'Security group for Treff EC2 instance',
            allowAllOutbound: true,
        });
        // Allow HTTP/HTTPS from anywhere
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(80), 'Allow HTTP traffic');
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(443), 'Allow HTTPS traffic');
        // Allow SSH (optional - for debugging)
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(22), 'Allow SSH access');
        // Allow MySQL port (for external access if needed)
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(3306), 'Allow MySQL access (optional - can be removed for production)');
        // ========================================
        // EC2 Instance for Backend + MySQL
        // ========================================
        // IAM Role for EC2
        const ec2Role = new iam.Role(this, 'TreffEC2Role', {
            assumedBy: new iam.ServicePrincipal('ec2.amazonaws.com'),
            managedPolicies: [
                iam.ManagedPolicy.fromAwsManagedPolicyName('AmazonSSMManagedInstanceCore'),
                iam.ManagedPolicy.fromAwsManagedPolicyName('CloudWatchAgentServerPolicy'),
            ],
        });
        // User data script
        const userDataScript = ec2.UserData.forLinux();
        userDataScript.addCommands('#!/bin/bash', 'set -e', '', '# Update system', 'apt-get update -y', 'apt-get upgrade -y', '', '# Install dependencies', 'apt-get install -y wget curl git nginx mysql-server mysql-client unzip', '', '# ========================================', '# MySQL Setup', '# ========================================', 'systemctl start mysql', 'systemctl enable mysql', '', `# Set MySQL root password`, `mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '${props.mysqlRootPassword}';"`, `mysql -e "FLUSH PRIVILEGES;"`, '', `# Create database and user`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "CREATE DATABASE IF NOT EXISTS ${props.mysqlDatabase};"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "CREATE USER IF NOT EXISTS '${props.mysqlUser}'@'localhost' IDENTIFIED BY '${props.mysqlPassword}';"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "GRANT ALL PRIVILEGES ON ${props.mysqlDatabase}.* TO '${props.mysqlUser}'@'localhost';"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "FLUSH PRIVILEGES;"`, '', '# Configure MySQL to listen on all interfaces (optional)', `sed -i 's/bind-address.*/bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf`, 'systemctl restart mysql', '', '# ========================================', '# .NET 8 Runtime Installation', '# ========================================', 'wget https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh', 'chmod +x dotnet-install.sh', './dotnet-install.sh --channel 8.0 --runtime aspnetcore', './dotnet-install.sh --channel 8.0 --runtime dotnet', '', '# Add .NET to PATH', 'echo "export DOTNET_ROOT=$HOME/.dotnet" >> /root/.bashrc', 'echo "export PATH=$PATH:$DOTNET_ROOT:$DOTNET_ROOT/tools" >> /root/.bashrc', 'export DOTNET_ROOT=$HOME/.dotnet', 'export PATH=$PATH:$DOTNET_ROOT:$DOTNET_ROOT/tools', '', '# ========================================', '# Application Setup Directory', '# ========================================', 'mkdir -p /var/www/treff-backend', 'chown -R www-data:www-data /var/www/treff-backend', '', '# ========================================', '# Nginx Configuration', '# ========================================', 'cat > /etc/nginx/sites-available/treff <<EOF', 'server {', '    listen 80;', '    server_name _;', '', '    location / {', '        proxy_pass http://127.0.0.1:5000;', '        proxy_http_version 1.1;', '        proxy_set_header Upgrade \\$http_upgrade;', '        proxy_set_header Connection "upgrade";', '        proxy_set_header Host \\$host;', '        proxy_cache_bypass \\$http_upgrade;', '        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;', '        proxy_set_header X-Forwarded-Proto \\$scheme;', '    }', '', '    # SignalR WebSocket support', '    location /hubs/ {', '        proxy_pass http://127.0.0.1:5000;', '        proxy_http_version 1.1;', '        proxy_set_header Upgrade \\$http_upgrade;', '        proxy_set_header Connection "upgrade";', '        proxy_set_header Host \\$host;', '        proxy_cache_bypass \\$http_upgrade;', '        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;', '        proxy_set_header X-Forwarded-Proto \\$scheme;', '    }', '}', 'EOF', '', 'ln -sf /etc/nginx/sites-available/treff /etc/nginx/sites-enabled/', 'rm -f /etc/nginx/sites-enabled/default', 'nginx -t', 'systemctl restart nginx', 'systemctl enable nginx', '', '# ========================================', '# Create systemd service for .NET app', '# ========================================', 'cat > /etc/systemd/system/treff-backend.service <<EOF', '[Unit]', 'Description=Treff .NET Backend', 'After=network.target mysql.service', '', '[Service]', 'Type=notify', 'WorkingDirectory=/var/www/treff-backend', 'ExecStart=/root/.dotnet/dotnet /var/www/treff-backend/WebApi.dll', 'Restart=always', 'RestartSec=10', 'KillSignal=SIGINT', 'SyslogIdentifier=treff-backend', 'User=www-data', 'Environment=ASPNETCORE_ENVIRONMENT=Production', 'Environment=DOTNET_ROOT=/root/.dotnet', 'Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/root/.dotnet:/root/.dotnet/tools', ...(props.twilioAccountSid ? [`Environment=TwilioConfig__AccountSid=${props.twilioAccountSid}`] : []), ...(props.twilioAuthToken ? [`Environment=TwilioConfig__AuthToken=${props.twilioAuthToken}`] : []), ...(props.twilioPhone ? [`Environment=TwilioConfig__Phone=${props.twilioPhone}`] : []), '', '[Install]', 'WantedBy=multi-user.target', 'EOF', '', 'systemctl daemon-reload', '# Note: Service will fail until you deploy the application', '# systemctl enable treff-backend', '', '# ========================================', '# Create deployment script', '# ========================================', 'cat > /root/deploy-backend.sh <<EOF', '#!/bin/bash', 'echo "Stopping backend service..."', 'systemctl stop treff-backend', '', 'echo "Deploying new version..."', '# Your deployment commands here', '# Example: copy files, run migrations, etc.', '', 'echo "Starting backend service..."', 'systemctl start treff-backend', 'systemctl status treff-backend', 'EOF', '', 'chmod +x /root/deploy-backend.sh', '', '# ========================================', '# Install CloudWatch agent (optional)', '# ========================================', 'wget https://s3.amazonaws.com/amazoncloudwatch-agent/ubuntu/arm64/latest/amazon-cloudwatch-agent.deb', 'dpkg -i -E ./amazon-cloudwatch-agent.deb', '', 'echo "EC2 setup complete!"', 'echo "MySQL root password: ${props.mysqlRootPassword}"', 'echo "MySQL database: ${props.mysqlDatabase}"', 'echo "MySQL user: ${props.mysqlUser}"', 'echo "MySQL password: ${props.mysqlPassword}"', 'echo ""', 'echo "Next steps:"', 'echo "1. Deploy your .NET application to /var/www/treff-backend/"', 'echo "2. Update connection string in appsettings.Production.json"', 'echo "3. Run: systemctl enable treff-backend"', 'echo "4. Run: systemctl start treff-backend"');
        // EC2 Instance
        const ec2Instance = new ec2.Instance(this, 'TreffEC2Instance', {
            vpc,
            vpcSubnets: {
                subnetType: ec2.SubnetType.PUBLIC,
            },
            instanceType: new ec2.InstanceType(props.instanceType),
            machineImage: ec2.MachineImage.fromSsmParameter('/aws/service/canonical/ubuntu/server/22.04/stable/current/arm64/hvm/ebs-gp2/ami-id', {
                os: ec2.OperatingSystemType.LINUX,
            }),
            securityGroup: ec2SecurityGroup,
            role: ec2Role,
            userData: userDataScript,
            blockDevices: [
                {
                    deviceName: '/dev/sda1',
                    volume: ec2.BlockDeviceVolume.ebs(30, {
                        volumeType: ec2.EbsDeviceVolumeType.GP3,
                        deleteOnTermination: true,
                    }),
                },
            ],
        });
        // Elastic IP for EC2
        const eip = new ec2.CfnEIP(this, 'TreffEC2EIP', {
            instanceId: ec2Instance.instanceId,
        });
        // ========================================
        // S3 Bucket for Frontend (use existing or create new)
        // ========================================
        const frontendBucket = props.frontendBucketName
            ? s3.Bucket.fromBucketName(this, 'TreffFrontendBucket', props.frontendBucketName)
            : new s3.Bucket(this, 'TreffFrontendBucket', {
                bucketName: `treff-frontend-${this.account}`,
                websiteIndexDocument: 'index.html',
                websiteErrorDocument: 'index.html',
                publicReadAccess: false,
                blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
                removalPolicy: cdk.RemovalPolicy.RETAIN,
                autoDeleteObjects: false,
                encryption: s3.BucketEncryption.S3_MANAGED,
            });
        // Origin Access Identity for CloudFront
        const oai = new cloudfront.OriginAccessIdentity(this, 'TreffOAI', {
            comment: 'OAI for Treff frontend',
        });
        // Grant CloudFront read access to the frontend bucket
        // For manually created buckets, we need to add the policy statement directly
        if (props.frontendBucketName) {
            // Imported bucket - add policy manually
            const bucketPolicy = new s3.CfnBucketPolicy(this, 'FrontendBucketPolicy', {
                bucket: props.frontendBucketName,
                policyDocument: {
                    Statement: [
                        {
                            Effect: 'Allow',
                            Principal: {
                                CanonicalUser: oai.cloudFrontOriginAccessIdentityS3CanonicalUserId,
                            },
                            Action: 's3:GetObject',
                            Resource: `arn:aws:s3:::${props.frontendBucketName}/*`,
                        },
                    ],
                },
            });
        }
        else if (frontendBucket instanceof s3.Bucket) {
            // CDK-created bucket - use grantRead helper
            frontendBucket.grantRead(oai);
        }
        // CloudFront Distribution
        const distribution = new cloudfront.Distribution(this, 'TreffDistribution', {
            defaultBehavior: {
                origin: new origins.S3Origin(frontendBucket, {
                    originAccessIdentity: oai,
                }),
                viewerProtocolPolicy: cloudfront.ViewerProtocolPolicy.REDIRECT_TO_HTTPS,
                cachePolicy: cloudfront.CachePolicy.CACHING_OPTIMIZED,
            },
            additionalBehaviors: {
                '/api/*': {
                    origin: new origins.HttpOrigin(ec2Instance.instancePublicDnsName, {
                        protocolPolicy: cloudfront.OriginProtocolPolicy.HTTP_ONLY,
                        httpPort: 80,
                    }),
                    viewerProtocolPolicy: cloudfront.ViewerProtocolPolicy.REDIRECT_TO_HTTPS,
                    cachePolicy: cloudfront.CachePolicy.CACHING_DISABLED,
                    allowedMethods: cloudfront.AllowedMethods.ALLOW_ALL,
                    originRequestPolicy: cloudfront.OriginRequestPolicy.ALL_VIEWER,
                },
            },
            defaultRootObject: 'index.html',
            errorResponses: [
                {
                    httpStatus: 403,
                    responseHttpStatus: 200,
                    responsePagePath: '/index.html',
                    ttl: cdk.Duration.minutes(5),
                },
                {
                    httpStatus: 404,
                    responseHttpStatus: 200,
                    responsePagePath: '/index.html',
                    ttl: cdk.Duration.minutes(5),
                },
            ],
            priceClass: cloudfront.PriceClass.PRICE_CLASS_100, // Cheapest option
        });
        // ========================================
        // Outputs
        // ========================================
        new cdk.CfnOutput(this, 'EC2PublicIP', {
            value: eip.ref,
            description: 'EC2 Instance Public IP',
        });
        new cdk.CfnOutput(this, 'EC2InstanceId', {
            value: ec2Instance.instanceId,
            description: 'EC2 Instance ID',
        });
        new cdk.CfnOutput(this, 'BackendURL', {
            value: `https://${distribution.distributionDomainName}/`,
            description: 'Backend API URL (via CloudFront)',
        });
        new cdk.CfnOutput(this, 'BackendDirectURL', {
            value: `http://${eip.ref}/`,
            description: 'Backend Direct URL (HTTP only - use CloudFront URL instead)',
        });
        new cdk.CfnOutput(this, 'FrontendBucket', {
            value: frontendBucket.bucketName,
            description: 'S3 Bucket for Frontend',
        });
        new cdk.CfnOutput(this, 'CloudFrontURL', {
            value: `https://${distribution.distributionDomainName}`,
            description: 'CloudFront Distribution URL',
        });
        new cdk.CfnOutput(this, 'CloudFrontDistributionId', {
            value: distribution.distributionId,
            description: 'CloudFront Distribution ID',
        });
        new cdk.CfnOutput(this, 'MySQLConnectionString', {
            value: `Server=${eip.ref};Database=${props.mysqlDatabase};Uid=${props.mysqlUser};Pwd=${props.mysqlPassword};`,
            description: 'MySQL Connection String',
        });
        new cdk.CfnOutput(this, 'SSHCommand', {
            value: `ssh -i your-key.pem ubuntu@${eip.ref}`,
            description: 'SSH Command (you need to add a key pair)',
        });
    }
}
exports.TreffInfrastructureStack = TreffInfrastructureStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZmYtaW5mcmFzdHJ1Y3R1cmUtc3RhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0cmVmZi1pbmZyYXN0cnVjdHVyZS1zdGFjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBbUM7QUFDbkMseURBQTJDO0FBQzNDLHVEQUF5QztBQUN6Qyx1RUFBeUQ7QUFDekQsNEVBQThEO0FBQzlELHlEQUEyQztBQW9CM0MsTUFBYSx3QkFBeUIsU0FBUSxHQUFHLENBQUMsS0FBSztJQUNyRCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQW9DO1FBQzVFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRXhCLDJDQUEyQztRQUMzQyxxQkFBcUI7UUFDckIsMkNBQTJDO1FBQzNDLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFO1lBQ3hDLE1BQU0sRUFBRSxDQUFDO1lBQ1QsV0FBVyxFQUFFLENBQUMsRUFBRSxzQ0FBc0M7WUFDdEQsbUJBQW1CLEVBQUU7Z0JBQ25CO29CQUNFLFFBQVEsRUFBRSxFQUFFO29CQUNaLElBQUksRUFBRSxRQUFRO29CQUNkLFVBQVUsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU07aUJBQ2xDO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCx5QkFBeUI7UUFDekIsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLHVCQUF1QixFQUFFO1lBQzVFLEdBQUc7WUFDSCxXQUFXLEVBQUUsdUNBQXVDO1lBQ3BELGdCQUFnQixFQUFFLElBQUk7U0FDdkIsQ0FBQyxDQUFDO1FBRUgsaUNBQWlDO1FBQ2pDLGdCQUFnQixDQUFDLGNBQWMsQ0FDN0IsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFDbEIs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QVUsR0FBRyxDQUFDLEdBQUcsYUFBYSxLQUFLLENBQUMsYUFBYSxRQUFRLEtBQUssQ0FBQyxTQUFTLFFBQVEsS0FBSyxDQUFDLGFBQWEsR0FBRztZQUM3RyxXQUFXLEVBQUUseUJBQXlCO1NBQ3ZDLENBQUMsQ0FBQztRQUVILElBQUksR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFO1lBQ3BDLEtBQUssRUFBRSw4QkFBOEIsR0FBRyxDQUFDLEdBQUcsRUFBRTtZQUM5QyxXQUFXLEVBQUUsMENBQTBDO1NBQ3hELENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRjtBQXZZRCw0REF1WUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gJ2F3cy1jZGstbGliL2F3cy1lYzInO1xuaW1wb3J0ICogYXMgczMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXMzJztcbmltcG9ydCAqIGFzIGNsb3VkZnJvbnQgZnJvbSAnYXdzLWNkay1saWIvYXdzLWNsb3VkZnJvbnQnO1xuaW1wb3J0ICogYXMgb3JpZ2lucyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtY2xvdWRmcm9udC1vcmlnaW5zJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIHMzZGVwbG95IGZyb20gJ2F3cy1jZGstbGliL2F3cy1zMy1kZXBsb3ltZW50JztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcblxuZXhwb3J0IGludGVyZmFjZSBUcmVmZkluZnJhc3RydWN0dXJlU3RhY2tQcm9wcyBleHRlbmRzIGNkay5TdGFja1Byb3BzIHtcbiAgaW5zdGFuY2VUeXBlOiBzdHJpbmc7XG4gIG15c3FsUm9vdFBhc3N3b3JkOiBzdHJpbmc7XG4gIG15c3FsRGF0YWJhc2U6IHN0cmluZztcbiAgbXlzcWxVc2VyOiBzdHJpbmc7XG4gIG15c3FsUGFzc3dvcmQ6IHN0cmluZztcbiAgZG9tYWluTmFtZT86IHN0cmluZztcbiAgZnJvbnRlbmRCdWNrZXROYW1lPzogc3RyaW5nO1xuICBhc3NldHNCdWNrZXROYW1lPzogc3RyaW5nO1xuICB0d2lsaW9BY2NvdW50U2lkPzogc3RyaW5nO1xuICB0d2lsaW9BdXRoVG9rZW4/OiBzdHJpbmc7XG4gIHR3aWxpb1Bob25lPzogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgVHJlZmZJbmZyYXN0cnVjdHVyZVN0YWNrIGV4dGVuZHMgY2RrLlN0YWNrIHtcbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFRyZWZmSW5mcmFzdHJ1Y3R1cmVTdGFja1Byb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gVlBDIGFuZCBOZXR3b3JraW5nXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjKHRoaXMsICdUcmVmZlZQQycsIHtcbiAgICAgIG1heEF6czogMixcbiAgICAgIG5hdEdhdGV3YXlzOiAwLCAvLyBTYXZlIGNvc3RzIC0gdXNlIHB1YmxpYyBzdWJuZXQgb25seVxuICAgICAgc3VibmV0Q29uZmlndXJhdGlvbjogW1xuICAgICAgICB7XG4gICAgICAgICAgY2lkck1hc2s6IDI0LFxuICAgICAgICAgIG5hbWU6ICdQdWJsaWMnLFxuICAgICAgICAgIHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBVQkxJQyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICAvLyBTZWN1cml0eSBHcm91cCBmb3IgRUMyXG4gICAgY29uc3QgZWMyU2VjdXJpdHlHcm91cCA9IG5ldyBlYzIuU2VjdXJpdHlHcm91cCh0aGlzLCAnVHJlZmZFQzJTZWN1cml0eUdyb3VwJywge1xuICAgICAgdnBjLFxuICAgICAgZGVzY3JpcHRpb246ICdTZWN1cml0eSBncm91cCBmb3IgVHJlZmYgRUMyIGluc3RhbmNlJyxcbiAgICAgIGFsbG93QWxsT3V0Ym91bmQ6IHRydWUsXG4gICAgfSk7XG5cbiAgICAvLyBBbGxvdyBIVFRQL0hUVFBTIGZyb20gYW55d2hlcmVcbiAgICBlYzJTZWN1cml0eUdyb3VwLmFkZEluZ3Jlc3NSdWxlKFxuICAgICAgZWMyLlBlZXIuYW55SXB2NCgpLFxuICAgICAgZWMyLlBvcnQudGNwKDgwKSxcbiAgICAgICdBbGxvdyBIVFRQIHRyYWZmaWMnXG4gICAgKTtcbiAgICBlYzJTZWN1cml0eUdyb3VwLmFkZEluZ3Jlc3NSdWxlKFxuICAgICAgZWMyLlBlZXIuYW55SXB2NCgpLFxuICAgICAgZWMyLlBvcnQudGNwKDQ0MyksXG4gICAgICAnQWxsb3cgSFRUUFMgdHJhZmZpYydcbiAgICApO1xuXG4gICAgLy8gQWxsb3cgU1NIIChvcHRpb25hbCAtIGZvciBkZWJ1Z2dpbmcpXG4gICAgZWMyU2VjdXJpdHlHcm91cC5hZGRJbmdyZXNzUnVsZShcbiAgICAgIGVjMi5QZWVyLmFueUlwdjQoKSxcbiAgICAgIGVjMi5Qb3J0LnRjcCgyMiksXG4gICAgICAnQWxsb3cgU1NIIGFjY2VzcydcbiAgICApO1xuXG4gICAgLy8gQWxsb3cgTXlTUUwgcG9ydCAoZm9yIGV4dGVybmFsIGFjY2VzcyBpZiBuZWVkZWQpXG4gICAgZWMyU2VjdXJpdHlHcm91cC5hZGRJbmdyZXNzUnVsZShcbiAgICAgIGVjMi5QZWVyLmFueUlwdjQoKSxcbiAgICAgIGVjMi5Qb3J0LnRjcCgzMzA2KSxcbiAgICAgICdBbGxvdyBNeVNRTCBhY2Nlc3MgKG9wdGlvbmFsIC0gY2FuIGJlIHJlbW92ZWQgZm9yIHByb2R1Y3Rpb24pJ1xuICAgICk7XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gRUMyIEluc3RhbmNlIGZvciBCYWNrZW5kICsgTXlTUUxcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgXG4gICAgLy8gSUFNIFJvbGUgZm9yIEVDMlxuICAgIGNvbnN0IGVjMlJvbGUgPSBuZXcgaWFtLlJvbGUodGhpcywgJ1RyZWZmRUMyUm9sZScsIHtcbiAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdlYzIuYW1hem9uYXdzLmNvbScpLFxuICAgICAgbWFuYWdlZFBvbGljaWVzOiBbXG4gICAgICAgIGlhbS5NYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZSgnQW1hem9uU1NNTWFuYWdlZEluc3RhbmNlQ29yZScpLFxuICAgICAgICBpYW0uTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoJ0Nsb3VkV2F0Y2hBZ2VudFNlcnZlclBvbGljeScpLFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIC8vIFVzZXIgZGF0YSBzY3JpcHRcbiAgICBjb25zdCB1c2VyRGF0YVNjcmlwdCA9IGVjMi5Vc2VyRGF0YS5mb3JMaW51eCgpO1xuICAgIHVzZXJEYXRhU2NyaXB0LmFkZENvbW1hbmRzKFxuICAgICAgJyMhL2Jpbi9iYXNoJyxcbiAgICAgICdzZXQgLWUnLFxuICAgICAgJycsXG4gICAgICAnIyBVcGRhdGUgc3lzdGVtJyxcbiAgICAgICdhcHQtZ2V0IHVwZGF0ZSAteScsXG4gICAgICAnYXB0LWdldCB1cGdyYWRlIC15JyxcbiAgICAgICcnLFxuICAgICAgJyMgSW5zdGFsbCBkZXBlbmRlbmNpZXMnLFxuICAgICAgJ2FwdC1nZXQgaW5zdGFsbCAteSB3Z2V0IGN1cmwgZ2l0IG5naW54IG15c3FsLXNlcnZlciBteXNxbC1jbGllbnQgdW56aXAnLFxuICAgICAgJycsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICcjIE15U1FMIFNldHVwJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJ3N5c3RlbWN0bCBzdGFydCBteXNxbCcsXG4gICAgICAnc3lzdGVtY3RsIGVuYWJsZSBteXNxbCcsXG4gICAgICAnJyxcbiAgICAgIGAjIFNldCBNeVNRTCByb290IHBhc3N3b3JkYCxcbiAgICAgIGBteXNxbCAtZSBcIkFMVEVSIFVTRVIgJ3Jvb3QnQCdsb2NhbGhvc3QnIElERU5USUZJRUQgV0lUSCBteXNxbF9uYXRpdmVfcGFzc3dvcmQgQlkgJyR7cHJvcHMubXlzcWxSb290UGFzc3dvcmR9JztcImAsXG4gICAgICBgbXlzcWwgLWUgXCJGTFVTSCBQUklWSUxFR0VTO1wiYCxcbiAgICAgICcnLFxuICAgICAgYCMgQ3JlYXRlIGRhdGFiYXNlIGFuZCB1c2VyYCxcbiAgICAgIGBteXNxbCAtdXJvb3QgLXAnJHtwcm9wcy5teXNxbFJvb3RQYXNzd29yZH0nIC1lIFwiQ1JFQVRFIERBVEFCQVNFIElGIE5PVCBFWElTVFMgJHtwcm9wcy5teXNxbERhdGFiYXNlfTtcImAsXG4gICAgICBgbXlzcWwgLXVyb290IC1wJyR7cHJvcHMubXlzcWxSb290UGFzc3dvcmR9JyAtZSBcIkNSRUFURSBVU0VSIElGIE5PVCBFWElTVFMgJyR7cHJvcHMubXlzcWxVc2VyfSdAJ2xvY2FsaG9zdCcgSURFTlRJRklFRCBCWSAnJHtwcm9wcy5teXNxbFBhc3N3b3JkfSc7XCJgLFxuICAgICAgYG15c3FsIC11cm9vdCAtcCcke3Byb3BzLm15c3FsUm9vdFBhc3N3b3JkfScgLWUgXCJHUkFOVCBBTEwgUFJJVklMRUdFUyBPTiAke3Byb3BzLm15c3FsRGF0YWJhc2V9LiogVE8gJyR7cHJvcHMubXlzcWxVc2VyfSdAJ2xvY2FsaG9zdCc7XCJgLFxuICAgICAgYG15c3FsIC11cm9vdCAtcCcke3Byb3BzLm15c3FsUm9vdFBhc3N3b3JkfScgLWUgXCJGTFVTSCBQUklWSUxFR0VTO1wiYCxcbiAgICAgICcnLFxuICAgICAgJyMgQ29uZmlndXJlIE15U1FMIHRvIGxpc3RlbiBvbiBhbGwgaW50ZXJmYWNlcyAob3B0aW9uYWwpJyxcbiAgICAgIGBzZWQgLWkgJ3MvYmluZC1hZGRyZXNzLiovYmluZC1hZGRyZXNzID0gMC4wLjAuMC8nIC9ldGMvbXlzcWwvbXlzcWwuY29uZi5kL215c3FsZC5jbmZgLFxuICAgICAgJ3N5c3RlbWN0bCByZXN0YXJ0IG15c3FsJyxcbiAgICAgICcnLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnIyAuTkVUIDggUnVudGltZSBJbnN0YWxsYXRpb24nLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnd2dldCBodHRwczovL2RvdC5uZXQvdjEvZG90bmV0LWluc3RhbGwuc2ggLU8gZG90bmV0LWluc3RhbGwuc2gnLFxuICAgICAgJ2NobW9kICt4IGRvdG5ldC1pbnN0YWxsLnNoJyxcbiAgICAgICcuL2RvdG5ldC1pbnN0YWxsLnNoIC0tY2hhbm5lbCA4LjAgLS1ydW50aW1lIGFzcG5ldGNvcmUnLFxuICAgICAgJy4vZG90bmV0LWluc3RhbGwuc2ggLS1jaGFubmVsIDguMCAtLXJ1bnRpbWUgZG90bmV0JyxcbiAgICAgICcnLFxuICAgICAgJyMgQWRkIC5ORVQgdG8gUEFUSCcsXG4gICAgICAnZWNobyBcImV4cG9ydCBET1RORVRfUk9PVD0kSE9NRS8uZG90bmV0XCIgPj4gL3Jvb3QvLmJhc2hyYycsXG4gICAgICAnZWNobyBcImV4cG9ydCBQQVRIPSRQQVRIOiRET1RORVRfUk9PVDokRE9UTkVUX1JPT1QvdG9vbHNcIiA+PiAvcm9vdC8uYmFzaHJjJyxcbiAgICAgICdleHBvcnQgRE9UTkVUX1JPT1Q9JEhPTUUvLmRvdG5ldCcsXG4gICAgICAnZXhwb3J0IFBBVEg9JFBBVEg6JERPVE5FVF9ST09UOiRET1RORVRfUk9PVC90b29scycsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgQXBwbGljYXRpb24gU2V0dXAgRGlyZWN0b3J5JyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJ21rZGlyIC1wIC92YXIvd3d3L3RyZWZmLWJhY2tlbmQnLFxuICAgICAgJ2Nob3duIC1SIHd3dy1kYXRhOnd3dy1kYXRhIC92YXIvd3d3L3RyZWZmLWJhY2tlbmQnLFxuICAgICAgJycsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICcjIE5naW54IENvbmZpZ3VyYXRpb24nLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnY2F0ID4gL2V0Yy9uZ2lueC9zaXRlcy1hdmFpbGFibGUvdHJlZmYgPDxFT0YnLFxuICAgICAgJ3NlcnZlciB7JyxcbiAgICAgICcgICAgbGlzdGVuIDgwOycsXG4gICAgICAnICAgIHNlcnZlcl9uYW1lIF87JyxcbiAgICAgICcnLFxuICAgICAgJyAgICBsb2NhdGlvbiAvIHsnLFxuICAgICAgJyAgICAgICAgcHJveHlfcGFzcyBodHRwOi8vMTI3LjAuMC4xOjUwMDA7JyxcbiAgICAgICcgICAgICAgIHByb3h5X2h0dHBfdmVyc2lvbiAxLjE7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgVXBncmFkZSBcXFxcJGh0dHBfdXBncmFkZTsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBDb25uZWN0aW9uIFwidXBncmFkZVwiOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIEhvc3QgXFxcXCRob3N0OycsXG4gICAgICAnICAgICAgICBwcm94eV9jYWNoZV9ieXBhc3MgXFxcXCRodHRwX3VwZ3JhZGU7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgWC1Gb3J3YXJkZWQtRm9yIFxcXFwkcHJveHlfYWRkX3hfZm9yd2FyZGVkX2ZvcjsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Qcm90byBcXFxcJHNjaGVtZTsnLFxuICAgICAgJyAgICB9JyxcbiAgICAgICcnLFxuICAgICAgJyAgICAjIFNpZ25hbFIgV2ViU29ja2V0IHN1cHBvcnQnLFxuICAgICAgJyAgICBsb2NhdGlvbiAvaHVicy8geycsXG4gICAgICAnICAgICAgICBwcm94eV9wYXNzIGh0dHA6Ly8xMjcuMC4wLjE6NTAwMDsnLFxuICAgICAgJyAgICAgICAgcHJveHlfaHR0cF92ZXJzaW9uIDEuMTsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBVcGdyYWRlIFxcXFwkaHR0cF91cGdyYWRlOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIENvbm5lY3Rpb24gXCJ1cGdyYWRlXCI7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgSG9zdCBcXFxcJGhvc3Q7JyxcbiAgICAgICcgICAgICAgIHByb3h5X2NhY2hlX2J5cGFzcyBcXFxcJGh0dHBfdXBncmFkZTsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Gb3IgXFxcXCRwcm94eV9hZGRfeF9mb3J3YXJkZWRfZm9yOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLVByb3RvIFxcXFwkc2NoZW1lOycsXG4gICAgICAnICAgIH0nLFxuICAgICAgJ30nLFxuICAgICAgJ0VPRicsXG4gICAgICAnJyxcbiAgICAgICdsbiAtc2YgL2V0Yy9uZ2lueC9zaXRlcy1hdmFpbGFibGUvdHJlZmYgL2V0Yy9uZ2lueC9zaXRlcy1lbmFibGVkLycsXG4gICAgICAncm0gLWYgL2V0Yy9uZ2lueC9zaXRlcy1lbmFibGVkL2RlZmF1bHQnLFxuICAgICAgJ25naW54IC10JyxcbiAgICAgICdzeXN0ZW1jdGwgcmVzdGFydCBuZ2lueCcsXG4gICAgICAnc3lzdGVtY3RsIGVuYWJsZSBuZ2lueCcsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgQ3JlYXRlIHN5c3RlbWQgc2VydmljZSBmb3IgLk5FVCBhcHAnLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnY2F0ID4gL2V0Yy9zeXN0ZW1kL3N5c3RlbS90cmVmZi1iYWNrZW5kLnNlcnZpY2UgPDxFT0YnLFxuICAgICAgJ1tVbml0XScsXG4gICAgICAnRGVzY3JpcHRpb249VHJlZmYgLk5FVCBCYWNrZW5kJyxcbiAgICAgICdBZnRlcj1uZXR3b3JrLnRhcmdldCBteXNxbC5zZXJ2aWNlJyxcbiAgICAgICcnLFxuICAgICAgJ1tTZXJ2aWNlXScsXG4gICAgICAnVHlwZT1ub3RpZnknLFxuICAgICAgJ1dvcmtpbmdEaXJlY3Rvcnk9L3Zhci93d3cvdHJlZmYtYmFja2VuZCcsXG4gICAgICAnRXhlY1N0YXJ0PS9yb290Ly5kb3RuZXQvZG90bmV0IC92YXIvd3d3L3RyZWZmLWJhY2tlbmQvV2ViQXBpLmRsbCcsXG4gICAgICAnUmVzdGFydD1hbHdheXMnLFxuICAgICAgJ1Jlc3RhcnRTZWM9MTAnLFxuICAgICAgJ0tpbGxTaWduYWw9U0lHSU5UJyxcbiAgICAgICdTeXNsb2dJZGVudGlmaWVyPXRyZWZmLWJhY2tlbmQnLFxuICAgICAgJ1VzZXI9d3d3LWRhdGEnLFxuICAgICAgJ0Vudmlyb25tZW50PUFTUE5FVENPUkVfRU5WSVJPTk1FTlQ9UHJvZHVjdGlvbicsXG4gICAgICAnRW52aXJvbm1lbnQ9RE9UTkVUX1JPT1Q9L3Jvb3QvLmRvdG5ldCcsXG4gICAgICAnRW52aXJvbm1lbnQ9UEFUSD0vdXNyL2xvY2FsL3NiaW46L3Vzci9sb2NhbC9iaW46L3Vzci9zYmluOi91c3IvYmluOi9zYmluOi9iaW46L3Jvb3QvLmRvdG5ldDovcm9vdC8uZG90bmV0L3Rvb2xzJyxcbiAgICAgIC4uLihwcm9wcy50d2lsaW9BY2NvdW50U2lkID8gW2BFbnZpcm9ubWVudD1Ud2lsaW9Db25maWdfX0FjY291bnRTaWQ9JHtwcm9wcy50d2lsaW9BY2NvdW50U2lkfWBdIDogW10pLFxuICAgICAgLi4uKHByb3BzLnR3aWxpb0F1dGhUb2tlbiA/IFtgRW52aXJvbm1lbnQ9VHdpbGlvQ29uZmlnX19BdXRoVG9rZW49JHtwcm9wcy50d2lsaW9BdXRoVG9rZW59YF0gOiBbXSksXG4gICAgICAuLi4ocHJvcHMudHdpbGlvUGhvbmUgPyBbYEVudmlyb25tZW50PVR3aWxpb0NvbmZpZ19fUGhvbmU9JHtwcm9wcy50d2lsaW9QaG9uZX1gXSA6IFtdKSxcbiAgICAgICcnLFxuICAgICAgJ1tJbnN0YWxsXScsXG4gICAgICAnV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQnLFxuICAgICAgJ0VPRicsXG4gICAgICAnJyxcbiAgICAgICdzeXN0ZW1jdGwgZGFlbW9uLXJlbG9hZCcsXG4gICAgICAnIyBOb3RlOiBTZXJ2aWNlIHdpbGwgZmFpbCB1bnRpbCB5b3UgZGVwbG95IHRoZSBhcHBsaWNhdGlvbicsXG4gICAgICAnIyBzeXN0ZW1jdGwgZW5hYmxlIHRyZWZmLWJhY2tlbmQnLFxuICAgICAgJycsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICcjIENyZWF0ZSBkZXBsb3ltZW50IHNjcmlwdCcsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICdjYXQgPiAvcm9vdC9kZXBsb3ktYmFja2VuZC5zaCA8PEVPRicsXG4gICAgICAnIyEvYmluL2Jhc2gnLFxuICAgICAgJ2VjaG8gXCJTdG9wcGluZyBiYWNrZW5kIHNlcnZpY2UuLi5cIicsXG4gICAgICAnc3lzdGVtY3RsIHN0b3AgdHJlZmYtYmFja2VuZCcsXG4gICAgICAnJyxcbiAgICAgICdlY2hvIFwiRGVwbG95aW5nIG5ldyB2ZXJzaW9uLi4uXCInLFxuICAgICAgJyMgWW91ciBkZXBsb3ltZW50IGNvbW1hbmRzIGhlcmUnLFxuICAgICAgJyMgRXhhbXBsZTogY29weSBmaWxlcywgcnVuIG1pZ3JhdGlvbnMsIGV0Yy4nLFxuICAgICAgJycsXG4gICAgICAnZWNobyBcIlN0YXJ0aW5nIGJhY2tlbmQgc2VydmljZS4uLlwiJyxcbiAgICAgICdzeXN0ZW1jdGwgc3RhcnQgdHJlZmYtYmFja2VuZCcsXG4gICAgICAnc3lzdGVtY3RsIHN0YXR1cyB0cmVmZi1iYWNrZW5kJyxcbiAgICAgICdFT0YnLFxuICAgICAgJycsXG4gICAgICAnY2htb2QgK3ggL3Jvb3QvZGVwbG95LWJhY2tlbmQuc2gnLFxuICAgICAgJycsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICcjIEluc3RhbGwgQ2xvdWRXYXRjaCBhZ2VudCAob3B0aW9uYWwpJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJ3dnZXQgaHR0cHM6Ly9zMy5hbWF6b25hd3MuY29tL2FtYXpvbmNsb3Vkd2F0Y2gtYWdlbnQvdWJ1bnR1L2FybTY0L2xhdGVzdC9hbWF6b24tY2xvdWR3YXRjaC1hZ2VudC5kZWInLFxuICAgICAgJ2Rwa2cgLWkgLUUgLi9hbWF6b24tY2xvdWR3YXRjaC1hZ2VudC5kZWInLFxuICAgICAgJycsXG4gICAgICAnZWNobyBcIkVDMiBzZXR1cCBjb21wbGV0ZSFcIicsXG4gICAgICAnZWNobyBcIk15U1FMIHJvb3QgcGFzc3dvcmQ6ICR7cHJvcHMubXlzcWxSb290UGFzc3dvcmR9XCInLFxuICAgICAgJ2VjaG8gXCJNeVNRTCBkYXRhYmFzZTogJHtwcm9wcy5teXNxbERhdGFiYXNlfVwiJyxcbiAgICAgICdlY2hvIFwiTXlTUUwgdXNlcjogJHtwcm9wcy5teXNxbFVzZXJ9XCInLFxuICAgICAgJ2VjaG8gXCJNeVNRTCBwYXNzd29yZDogJHtwcm9wcy5teXNxbFBhc3N3b3JkfVwiJyxcbiAgICAgICdlY2hvIFwiXCInLFxuICAgICAgJ2VjaG8gXCJOZXh0IHN0ZXBzOlwiJyxcbiAgICAgICdlY2hvIFwiMS4gRGVwbG95IHlvdXIgLk5FVCBhcHBsaWNhdGlvbiB0byAvdmFyL3d3dy90cmVmZi1iYWNrZW5kL1wiJyxcbiAgICAgICdlY2hvIFwiMi4gVXBkYXRlIGNvbm5lY3Rpb24gc3RyaW5nIGluIGFwcHNldHRpbmdzLlByb2R1Y3Rpb24uanNvblwiJyxcbiAgICAgICdlY2hvIFwiMy4gUnVuOiBzeXN0ZW1jdGwgZW5hYmxlIHRyZWZmLWJhY2tlbmRcIicsXG4gICAgICAnZWNobyBcIjQuIFJ1bjogc3lzdGVtY3RsIHN0YXJ0IHRyZWZmLWJhY2tlbmRcIicsXG4gICAgKTtcblxuICAgIC8vIEVDMiBJbnN0YW5jZVxuICAgIGNvbnN0IGVjMkluc3RhbmNlID0gbmV3IGVjMi5JbnN0YW5jZSh0aGlzLCAnVHJlZmZFQzJJbnN0YW5jZScsIHtcbiAgICAgIHZwYyxcbiAgICAgIHZwY1N1Ym5ldHM6IHtcbiAgICAgICAgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFVCTElDLFxuICAgICAgfSxcbiAgICAgIGluc3RhbmNlVHlwZTogbmV3IGVjMi5JbnN0YW5jZVR5cGUocHJvcHMuaW5zdGFuY2VUeXBlKSxcbiAgICAgIG1hY2hpbmVJbWFnZTogZWMyLk1hY2hpbmVJbWFnZS5mcm9tU3NtUGFyYW1ldGVyKFxuICAgICAgICAnL2F3cy9zZXJ2aWNlL2Nhbm9uaWNhbC91YnVudHUvc2VydmVyLzIyLjA0L3N0YWJsZS9jdXJyZW50L2FybTY0L2h2bS9lYnMtZ3AyL2FtaS1pZCcsXG4gICAgICAgIHtcbiAgICAgICAgICBvczogZWMyLk9wZXJhdGluZ1N5c3RlbVR5cGUuTElOVVgsXG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICBzZWN1cml0eUdyb3VwOiBlYzJTZWN1cml0eUdyb3VwLFxuICAgICAgcm9sZTogZWMyUm9sZSxcbiAgICAgIHVzZXJEYXRhOiB1c2VyRGF0YVNjcmlwdCxcbiAgICAgIGJsb2NrRGV2aWNlczogW1xuICAgICAgICB7XG4gICAgICAgICAgZGV2aWNlTmFtZTogJy9kZXYvc2RhMScsXG4gICAgICAgICAgdm9sdW1lOiBlYzIuQmxvY2tEZXZpY2VWb2x1bWUuZWJzKDMwLCB7XG4gICAgICAgICAgICB2b2x1bWVUeXBlOiBlYzIuRWJzRGV2aWNlVm9sdW1lVHlwZS5HUDMsXG4gICAgICAgICAgICBkZWxldGVPblRlcm1pbmF0aW9uOiB0cnVlLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIC8vIEVsYXN0aWMgSVAgZm9yIEVDMlxuICAgIGNvbnN0IGVpcCA9IG5ldyBlYzIuQ2ZuRUlQKHRoaXMsICdUcmVmZkVDMkVJUCcsIHtcbiAgICAgIGluc3RhbmNlSWQ6IGVjMkluc3RhbmNlLmluc3RhbmNlSWQsXG4gICAgfSk7XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gUzMgQnVja2V0IGZvciBGcm9udGVuZCAodXNlIGV4aXN0aW5nIG9yIGNyZWF0ZSBuZXcpXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIGNvbnN0IGZyb250ZW5kQnVja2V0ID0gcHJvcHMuZnJvbnRlbmRCdWNrZXROYW1lXG4gICAgICA/IHMzLkJ1Y2tldC5mcm9tQnVja2V0TmFtZSh0aGlzLCAnVHJlZmZGcm9udGVuZEJ1Y2tldCcsIHByb3BzLmZyb250ZW5kQnVja2V0TmFtZSlcbiAgICAgIDogbmV3IHMzLkJ1Y2tldCh0aGlzLCAnVHJlZmZGcm9udGVuZEJ1Y2tldCcsIHtcbiAgICAgICAgICBidWNrZXROYW1lOiBgdHJlZmYtZnJvbnRlbmQtJHt0aGlzLmFjY291bnR9YCxcbiAgICAgICAgICB3ZWJzaXRlSW5kZXhEb2N1bWVudDogJ2luZGV4Lmh0bWwnLFxuICAgICAgICAgIHdlYnNpdGVFcnJvckRvY3VtZW50OiAnaW5kZXguaHRtbCcsXG4gICAgICAgICAgcHVibGljUmVhZEFjY2VzczogZmFsc2UsXG4gICAgICAgICAgYmxvY2tQdWJsaWNBY2Nlc3M6IHMzLkJsb2NrUHVibGljQWNjZXNzLkJMT0NLX0FMTCxcbiAgICAgICAgICByZW1vdmFsUG9saWN5OiBjZGsuUmVtb3ZhbFBvbGljeS5SRVRBSU4sXG4gICAgICAgICAgYXV0b0RlbGV0ZU9iamVjdHM6IGZhbHNlLFxuICAgICAgICAgIGVuY3J5cHRpb246IHMzLkJ1Y2tldEVuY3J5cHRpb24uUzNfTUFOQUdFRCxcbiAgICAgICAgfSk7XG5cbiAgICAvLyBPcmlnaW4gQWNjZXNzIElkZW50aXR5IGZvciBDbG91ZEZyb250XG4gICAgY29uc3Qgb2FpID0gbmV3IGNsb3VkZnJvbnQuT3JpZ2luQWNjZXNzSWRlbnRpdHkodGhpcywgJ1RyZWZmT0FJJywge1xuICAgICAgY29tbWVudDogJ09BSSBmb3IgVHJlZmYgZnJvbnRlbmQnLFxuICAgIH0pO1xuXG4gICAgLy8gR3JhbnQgQ2xvdWRGcm9udCByZWFkIGFjY2VzcyB0byB0aGUgZnJvbnRlbmQgYnVja2V0XG4gICAgLy8gRm9yIG1hbnVhbGx5IGNyZWF0ZWQgYnVja2V0cywgd2UgbmVlZCB0byBhZGQgdGhlIHBvbGljeSBzdGF0ZW1lbnQgZGlyZWN0bHlcbiAgICBpZiAocHJvcHMuZnJvbnRlbmRCdWNrZXROYW1lKSB7XG4gICAgICAvLyBJbXBvcnRlZCBidWNrZXQgLSBhZGQgcG9saWN5IG1hbnVhbGx5XG4gICAgICBjb25zdCBidWNrZXRQb2xpY3kgPSBuZXcgczMuQ2ZuQnVja2V0UG9saWN5KHRoaXMsICdGcm9udGVuZEJ1Y2tldFBvbGljeScsIHtcbiAgICAgICAgYnVja2V0OiBwcm9wcy5mcm9udGVuZEJ1Y2tldE5hbWUsXG4gICAgICAgIHBvbGljeURvY3VtZW50OiB7XG4gICAgICAgICAgU3RhdGVtZW50OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgICAgUHJpbmNpcGFsOiB7XG4gICAgICAgICAgICAgICAgQ2Fub25pY2FsVXNlcjogb2FpLmNsb3VkRnJvbnRPcmlnaW5BY2Nlc3NJZGVudGl0eVMzQ2Fub25pY2FsVXNlcklkLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBBY3Rpb246ICdzMzpHZXRPYmplY3QnLFxuICAgICAgICAgICAgICBSZXNvdXJjZTogYGFybjphd3M6czM6Ojoke3Byb3BzLmZyb250ZW5kQnVja2V0TmFtZX0vKmAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGZyb250ZW5kQnVja2V0IGluc3RhbmNlb2YgczMuQnVja2V0KSB7XG4gICAgICAvLyBDREstY3JlYXRlZCBidWNrZXQgLSB1c2UgZ3JhbnRSZWFkIGhlbHBlclxuICAgICAgZnJvbnRlbmRCdWNrZXQuZ3JhbnRSZWFkKG9haSk7XG4gICAgfVxuXG4gICAgLy8gQ2xvdWRGcm9udCBEaXN0cmlidXRpb25cbiAgICBjb25zdCBkaXN0cmlidXRpb24gPSBuZXcgY2xvdWRmcm9udC5EaXN0cmlidXRpb24odGhpcywgJ1RyZWZmRGlzdHJpYnV0aW9uJywge1xuICAgICAgZGVmYXVsdEJlaGF2aW9yOiB7XG4gICAgICAgIG9yaWdpbjogbmV3IG9yaWdpbnMuUzNPcmlnaW4oZnJvbnRlbmRCdWNrZXQsIHtcbiAgICAgICAgICBvcmlnaW5BY2Nlc3NJZGVudGl0eTogb2FpLFxuICAgICAgICB9KSxcbiAgICAgICAgdmlld2VyUHJvdG9jb2xQb2xpY3k6IGNsb3VkZnJvbnQuVmlld2VyUHJvdG9jb2xQb2xpY3kuUkVESVJFQ1RfVE9fSFRUUFMsXG4gICAgICAgIGNhY2hlUG9saWN5OiBjbG91ZGZyb250LkNhY2hlUG9saWN5LkNBQ0hJTkdfT1BUSU1JWkVELFxuICAgICAgfSxcbiAgICAgIGFkZGl0aW9uYWxCZWhhdmlvcnM6IHtcbiAgICAgICAgJy9hcGkvKic6IHtcbiAgICAgICAgICBvcmlnaW46IG5ldyBvcmlnaW5zLkh0dHBPcmlnaW4oZWMySW5zdGFuY2UuaW5zdGFuY2VQdWJsaWNEbnNOYW1lLCB7XG4gICAgICAgICAgICBwcm90b2NvbFBvbGljeTogY2xvdWRmcm9udC5PcmlnaW5Qcm90b2NvbFBvbGljeS5IVFRQX09OTFksXG4gICAgICAgICAgICBodHRwUG9ydDogODAsXG4gICAgICAgICAgfSksXG4gICAgICAgICAgdmlld2VyUHJvdG9jb2xQb2xpY3k6IGNsb3VkZnJvbnQuVmlld2VyUHJvdG9jb2xQb2xpY3kuUkVESVJFQ1RfVE9fSFRUUFMsXG4gICAgICAgICAgY2FjaGVQb2xpY3k6IGNsb3VkZnJvbnQuQ2FjaGVQb2xpY3kuQ0FDSElOR19ESVNBQkxFRCxcbiAgICAgICAgICBhbGxvd2VkTWV0aG9kczogY2xvdWRmcm9udC5BbGxvd2VkTWV0aG9kcy5BTExPV19BTEwsXG4gICAgICAgICAgb3JpZ2luUmVxdWVzdFBvbGljeTogY2xvdWRmcm9udC5PcmlnaW5SZXF1ZXN0UG9saWN5LkFMTF9WSUVXRVIsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgZGVmYXVsdFJvb3RPYmplY3Q6ICdpbmRleC5odG1sJyxcbiAgICAgIGVycm9yUmVzcG9uc2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBodHRwU3RhdHVzOiA0MDMsXG4gICAgICAgICAgcmVzcG9uc2VIdHRwU3RhdHVzOiAyMDAsXG4gICAgICAgICAgcmVzcG9uc2VQYWdlUGF0aDogJy9pbmRleC5odG1sJyxcbiAgICAgICAgICB0dGw6IGNkay5EdXJhdGlvbi5taW51dGVzKDUpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaHR0cFN0YXR1czogNDA0LFxuICAgICAgICAgIHJlc3BvbnNlSHR0cFN0YXR1czogMjAwLFxuICAgICAgICAgIHJlc3BvbnNlUGFnZVBhdGg6ICcvaW5kZXguaHRtbCcsXG4gICAgICAgICAgdHRsOiBjZGsuRHVyYXRpb24ubWludXRlcyg1KSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBwcmljZUNsYXNzOiBjbG91ZGZyb250LlByaWNlQ2xhc3MuUFJJQ0VfQ0xBU1NfMTAwLCAvLyBDaGVhcGVzdCBvcHRpb25cbiAgICB9KTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBPdXRwdXRzXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdFQzJQdWJsaWNJUCcsIHtcbiAgICAgIHZhbHVlOiBlaXAucmVmLFxuICAgICAgZGVzY3JpcHRpb246ICdFQzIgSW5zdGFuY2UgUHVibGljIElQJyxcbiAgICB9KTtcblxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdFQzJJbnN0YW5jZUlkJywge1xuICAgICAgdmFsdWU6IGVjMkluc3RhbmNlLmluc3RhbmNlSWQsXG4gICAgICBkZXNjcmlwdGlvbjogJ0VDMiBJbnN0YW5jZSBJRCcsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnQmFja2VuZFVSTCcsIHtcbiAgICAgIHZhbHVlOiBgaHR0cHM6Ly8ke2Rpc3RyaWJ1dGlvbi5kaXN0cmlidXRpb25Eb21haW5OYW1lfS9gLFxuICAgICAgZGVzY3JpcHRpb246ICdCYWNrZW5kIEFQSSBVUkwgKHZpYSBDbG91ZEZyb250KScsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnQmFja2VuZERpcmVjdFVSTCcsIHtcbiAgICAgIHZhbHVlOiBgaHR0cDovLyR7ZWlwLnJlZn0vYCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQmFja2VuZCBEaXJlY3QgVVJMIChIVFRQIG9ubHkgLSB1c2UgQ2xvdWRGcm9udCBVUkwgaW5zdGVhZCknLFxuICAgIH0pO1xuXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0Zyb250ZW5kQnVja2V0Jywge1xuICAgICAgdmFsdWU6IGZyb250ZW5kQnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogJ1MzIEJ1Y2tldCBmb3IgRnJvbnRlbmQnLFxuICAgIH0pO1xuXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0Nsb3VkRnJvbnRVUkwnLCB7XG4gICAgICB2YWx1ZTogYGh0dHBzOi8vJHtkaXN0cmlidXRpb24uZGlzdHJpYnV0aW9uRG9tYWluTmFtZX1gLFxuICAgICAgZGVzY3JpcHRpb246ICdDbG91ZEZyb250IERpc3RyaWJ1dGlvbiBVUkwnLFxuICAgIH0pO1xuXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0Nsb3VkRnJvbnREaXN0cmlidXRpb25JZCcsIHtcbiAgICAgIHZhbHVlOiBkaXN0cmlidXRpb24uZGlzdHJpYnV0aW9uSWQsXG4gICAgICBkZXNjcmlwdGlvbjogJ0Nsb3VkRnJvbnQgRGlzdHJpYnV0aW9uIElEJyxcbiAgICB9KTtcblxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdNeVNRTENvbm5lY3Rpb25TdHJpbmcnLCB7XG4gICAgICB2YWx1ZTogYFNlcnZlcj0ke2VpcC5yZWZ9O0RhdGFiYXNlPSR7cHJvcHMubXlzcWxEYXRhYmFzZX07VWlkPSR7cHJvcHMubXlzcWxVc2VyfTtQd2Q9JHtwcm9wcy5teXNxbFBhc3N3b3JkfTtgLFxuICAgICAgZGVzY3JpcHRpb246ICdNeVNRTCBDb25uZWN0aW9uIFN0cmluZycsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnU1NIQ29tbWFuZCcsIHtcbiAgICAgIHZhbHVlOiBgc3NoIC1pIHlvdXIta2V5LnBlbSB1YnVudHVAJHtlaXAucmVmfWAsXG4gICAgICBkZXNjcmlwdGlvbjogJ1NTSCBDb21tYW5kICh5b3UgbmVlZCB0byBhZGQgYSBrZXkgcGFpciknLFxuICAgIH0pO1xuICB9XG59XG4iXX0=
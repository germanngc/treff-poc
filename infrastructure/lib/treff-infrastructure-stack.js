"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.TreffInfrastructureStack = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const ec2 = __importStar(require("aws-cdk-lib/aws-ec2"));
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const cloudfront = __importStar(require("aws-cdk-lib/aws-cloudfront"));
const origins = __importStar(require("aws-cdk-lib/aws-cloudfront-origins"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
class TreffInfrastructureStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        // ========================================
        // VPC and Networking
        // ========================================
        const vpc = new ec2.Vpc(this, 'TreffVPC', {
            maxAzs: 2,
            natGateways: 0, // Save costs - use public subnet only
            subnetConfiguration: [
                {
                    cidrMask: 24,
                    name: 'Public',
                    subnetType: ec2.SubnetType.PUBLIC,
                },
            ],
        });
        // Security Group for EC2
        const ec2SecurityGroup = new ec2.SecurityGroup(this, 'TreffEC2SecurityGroup', {
            vpc,
            description: 'Security group for Treff EC2 instance',
            allowAllOutbound: true,
        });
        // Allow HTTP/HTTPS from anywhere
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(80), 'Allow HTTP traffic');
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(443), 'Allow HTTPS traffic');
        // Allow SSH (optional - for debugging)
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(22), 'Allow SSH access');
        // Allow MySQL port (for external access if needed)
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(3306), 'Allow MySQL access (optional - can be removed for production)');
        // ========================================
        // EC2 Instance for Backend + MySQL
        // ========================================
        // IAM Role for EC2
        const ec2Role = new iam.Role(this, 'TreffEC2Role', {
            assumedBy: new iam.ServicePrincipal('ec2.amazonaws.com'),
            managedPolicies: [
                iam.ManagedPolicy.fromAwsManagedPolicyName('AmazonSSMManagedInstanceCore'),
                iam.ManagedPolicy.fromAwsManagedPolicyName('CloudWatchAgentServerPolicy'),
            ],
        });
        // User data script
        const userDataScript = ec2.UserData.forLinux();
        userDataScript.addCommands('#!/bin/bash', 'set -e', '', '# Update system', 'apt-get update -y', 'apt-get upgrade -y', '', '# Install dependencies', 'apt-get install -y wget curl git nginx mysql-server mysql-client unzip', '', '# ========================================', '# MySQL Setup', '# ========================================', 'systemctl start mysql', 'systemctl enable mysql', '', `# Set MySQL root password`, `mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '${props.mysqlRootPassword}';"`, `mysql -e "FLUSH PRIVILEGES;"`, '', `# Create database and user`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "CREATE DATABASE IF NOT EXISTS ${props.mysqlDatabase};"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "CREATE USER IF NOT EXISTS '${props.mysqlUser}'@'localhost' IDENTIFIED BY '${props.mysqlPassword}';"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "GRANT ALL PRIVILEGES ON ${props.mysqlDatabase}.* TO '${props.mysqlUser}'@'localhost';"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "FLUSH PRIVILEGES;"`, '', '# Configure MySQL to listen on all interfaces (optional)', `sed -i 's/bind-address.*/bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf`, 'systemctl restart mysql', '', '# ========================================', '# .NET 8 Runtime Installation', '# ========================================', 'wget https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh', 'chmod +x dotnet-install.sh', './dotnet-install.sh --channel 8.0 --runtime aspnetcore', './dotnet-install.sh --channel 8.0 --runtime dotnet', '', '# Add .NET to PATH', 'echo "export DOTNET_ROOT=$HOME/.dotnet" >> /root/.bashrc', 'echo "export PATH=$PATH:$DOTNET_ROOT:$DOTNET_ROOT/tools" >> /root/.bashrc', 'export DOTNET_ROOT=$HOME/.dotnet', 'export PATH=$PATH:$DOTNET_ROOT:$DOTNET_ROOT/tools', '', '# ========================================', '# Application Setup Directory', '# ========================================', 'mkdir -p /var/www/treff-backend', 'chown -R www-data:www-data /var/www/treff-backend', '', '# ========================================', '# Nginx Configuration', '# ========================================', 'cat > /etc/nginx/sites-available/treff <<EOF', 'server {', '    listen 80;', '    server_name _;', '', '    location / {', '        proxy_pass http://127.0.0.1:5000;', '        proxy_http_version 1.1;', '        proxy_set_header Upgrade \\$http_upgrade;', '        proxy_set_header Connection "upgrade";', '        proxy_set_header Host \\$host;', '        proxy_cache_bypass \\$http_upgrade;', '        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;', '        proxy_set_header X-Forwarded-Proto \\$scheme;', '    }', '', '    # SignalR WebSocket support', '    location /hubs/ {', '        proxy_pass http://127.0.0.1:5000;', '        proxy_http_version 1.1;', '        proxy_set_header Upgrade \\$http_upgrade;', '        proxy_set_header Connection "upgrade";', '        proxy_set_header Host \\$host;', '        proxy_cache_bypass \\$http_upgrade;', '        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;', '        proxy_set_header X-Forwarded-Proto \\$scheme;', '    }', '}', 'EOF', '', 'ln -sf /etc/nginx/sites-available/treff /etc/nginx/sites-enabled/', 'rm -f /etc/nginx/sites-enabled/default', 'nginx -t', 'systemctl restart nginx', 'systemctl enable nginx', '', '# ========================================', '# Create systemd service for .NET app', '# ========================================', 'cat > /etc/systemd/system/treff-backend.service <<EOF', '[Unit]', 'Description=Treff .NET Backend', 'After=network.target mysql.service', '', '[Service]', 'Type=notify', 'WorkingDirectory=/var/www/treff-backend', 'ExecStart=/root/.dotnet/dotnet /var/www/treff-backend/WebApi.dll', 'Restart=always', 'RestartSec=10', 'KillSignal=SIGINT', 'SyslogIdentifier=treff-backend', 'User=www-data', 'Environment=ASPNETCORE_ENVIRONMENT=Production', 'Environment=DOTNET_ROOT=/root/.dotnet', 'Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/root/.dotnet:/root/.dotnet/tools', ...(props.twilioAccountSid ? [`Environment=TwilioConfig__AccountSid=${props.twilioAccountSid}`] : []), ...(props.twilioAuthToken ? [`Environment=TwilioConfig__AuthToken=${props.twilioAuthToken}`] : []), ...(props.twilioPhone ? [`Environment=TwilioConfig__Phone=${props.twilioPhone}`] : []), '', '[Install]', 'WantedBy=multi-user.target', 'EOF', '', 'systemctl daemon-reload', '# Note: Service will fail until you deploy the application', '# systemctl enable treff-backend', '', '# ========================================', '# Create deployment script', '# ========================================', 'cat > /root/deploy-backend.sh <<EOF', '#!/bin/bash', 'echo "Stopping backend service..."', 'systemctl stop treff-backend', '', 'echo "Deploying new version..."', '# Your deployment commands here', '# Example: copy files, run migrations, etc.', '', 'echo "Starting backend service..."', 'systemctl start treff-backend', 'systemctl status treff-backend', 'EOF', '', 'chmod +x /root/deploy-backend.sh', '', '# ========================================', '# Install CloudWatch agent (optional)', '# ========================================', 'wget https://s3.amazonaws.com/amazoncloudwatch-agent/ubuntu/arm64/latest/amazon-cloudwatch-agent.deb', 'dpkg -i -E ./amazon-cloudwatch-agent.deb', '', 'echo "EC2 setup complete!"', 'echo "MySQL root password: ${props.mysqlRootPassword}"', 'echo "MySQL database: ${props.mysqlDatabase}"', 'echo "MySQL user: ${props.mysqlUser}"', 'echo "MySQL password: ${props.mysqlPassword}"', 'echo ""', 'echo "Next steps:"', 'echo "1. Deploy your .NET application to /var/www/treff-backend/"', 'echo "2. Update connection string in appsettings.Production.json"', 'echo "3. Run: systemctl enable treff-backend"', 'echo "4. Run: systemctl start treff-backend"');
        // EC2 Instance
        const ec2Instance = new ec2.Instance(this, 'TreffEC2Instance', {
            vpc,
            vpcSubnets: {
                subnetType: ec2.SubnetType.PUBLIC,
            },
            instanceType: new ec2.InstanceType(props.instanceType),
            machineImage: ec2.MachineImage.fromSsmParameter('/aws/service/canonical/ubuntu/server/22.04/stable/current/arm64/hvm/ebs-gp2/ami-id', {
                os: ec2.OperatingSystemType.LINUX,
            }),
            securityGroup: ec2SecurityGroup,
            role: ec2Role,
            userData: userDataScript,
            blockDevices: [
                {
                    deviceName: '/dev/sda1',
                    volume: ec2.BlockDeviceVolume.ebs(30, {
                        volumeType: ec2.EbsDeviceVolumeType.GP3,
                        deleteOnTermination: true,
                    }),
                },
            ],
        });
        // Elastic IP for EC2
        const eip = new ec2.CfnEIP(this, 'TreffEC2EIP', {
            instanceId: ec2Instance.instanceId,
        });
        // ========================================
        // S3 Bucket for Frontend (use existing or create new)
        // ========================================
        const frontendBucket = props.frontendBucketName
            ? s3.Bucket.fromBucketName(this, 'TreffFrontendBucket', props.frontendBucketName)
            : new s3.Bucket(this, 'TreffFrontendBucket', {
                bucketName: `treff-frontend-${this.account}`,
                websiteIndexDocument: 'index.html',
                websiteErrorDocument: 'index.html',
                publicReadAccess: false,
                blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
                removalPolicy: cdk.RemovalPolicy.RETAIN,
                autoDeleteObjects: false,
                encryption: s3.BucketEncryption.S3_MANAGED,
            });
        // Origin Access Identity for CloudFront
        const oai = new cloudfront.OriginAccessIdentity(this, 'TreffOAI', {
            comment: 'OAI for Treff frontend',
        });
        // Grant read access only if we created the bucket (imported buckets can't be modified)
        if (!props.frontendBucketName && frontendBucket instanceof s3.Bucket) {
            frontendBucket.grantRead(oai);
        }
        // CloudFront Distribution
        const distribution = new cloudfront.Distribution(this, 'TreffDistribution', {
            defaultBehavior: {
                origin: new origins.S3Origin(frontendBucket, {
                    originAccessIdentity: oai,
                }),
                viewerProtocolPolicy: cloudfront.ViewerProtocolPolicy.REDIRECT_TO_HTTPS,
                cachePolicy: cloudfront.CachePolicy.CACHING_OPTIMIZED,
            },
            defaultRootObject: 'index.html',
            errorResponses: [
                {
                    httpStatus: 403,
                    responseHttpStatus: 200,
                    responsePagePath: '/index.html',
                    ttl: cdk.Duration.minutes(5),
                },
                {
                    httpStatus: 404,
                    responseHttpStatus: 200,
                    responsePagePath: '/index.html',
                    ttl: cdk.Duration.minutes(5),
                },
            ],
            priceClass: cloudfront.PriceClass.PRICE_CLASS_100, // Cheapest option
        });
        // ========================================
        // Outputs
        // ========================================
        new cdk.CfnOutput(this, 'EC2PublicIP', {
            value: eip.ref,
            description: 'EC2 Instance Public IP',
        });
        new cdk.CfnOutput(this, 'EC2InstanceId', {
            value: ec2Instance.instanceId,
            description: 'EC2 Instance ID',
        });
        new cdk.CfnOutput(this, 'BackendURL', {
            value: `http://${eip.ref}`,
            description: 'Backend API URL',
        });
        new cdk.CfnOutput(this, 'FrontendBucket', {
            value: frontendBucket.bucketName,
            description: 'S3 Bucket for Frontend',
        });
        new cdk.CfnOutput(this, 'CloudFrontURL', {
            value: `https://${distribution.distributionDomainName}`,
            description: 'CloudFront Distribution URL',
        });
        new cdk.CfnOutput(this, 'CloudFrontDistributionId', {
            value: distribution.distributionId,
            description: 'CloudFront Distribution ID',
        });
        new cdk.CfnOutput(this, 'MySQLConnectionString', {
            value: `Server=${eip.ref};Database=${props.mysqlDatabase};Uid=${props.mysqlUser};Pwd=${props.mysqlPassword};`,
            description: 'MySQL Connection String',
        });
        new cdk.CfnOutput(this, 'SSHCommand', {
            value: `ssh -i your-key.pem ubuntu@${eip.ref}`,
            description: 'SSH Command (you need to add a key pair)',
        });
    }
}
exports.TreffInfrastructureStack = TreffInfrastructureStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZmYtaW5mcmFzdHJ1Y3R1cmUtc3RhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0cmVmZi1pbmZyYXN0cnVjdHVyZS1zdGFjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBbUM7QUFDbkMseURBQTJDO0FBQzNDLHVEQUF5QztBQUN6Qyx1RUFBeUQ7QUFDekQsNEVBQThEO0FBQzlELHlEQUEyQztBQW9CM0MsTUFBYSx3QkFBeUIsU0FBUSxHQUFHLENBQUMsS0FBSztJQUNyRCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQW9DO1FBQzVFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRXhCLDJDQUEyQztRQUMzQyxxQkFBcUI7UUFDckIsMkNBQTJDO1FBQzNDLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFO1lBQ3hDLE1BQU0sRUFBRSxDQUFDO1lBQ1QsV0FBVyxFQUFFLENBQUMsRUFBRSxzQ0FBc0M7WUFDdEQsbUJBQW1CLEVBQUU7Z0JBQ25CO29CQUNFLFFBQVEsRUFBRSxFQUFFO29CQUNaLElBQUksRUFBRSxRQUFRO29CQUNkLFVBQVUsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU07aUJBQ2xDO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCx5QkFBeUI7UUFDekIsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLHVCQUF1QixFQUFFO1lBQzVFLEdBQUc7WUFDSCxXQUFXLEVBQUUsdUNBQXVDO1lBQ3BELGdCQUFnQixFQUFFLElBQUk7U0FDdkIsQ0FBQyxDQUFDO1FBRUgsaUNBQWlDO1FBQ2pDLGdCQUFnQixDQUFDLGNBQWMsQ0FDN0IsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFDbEIs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RUFBRTtZQUMvQyxLQUFLLEVBQUUsVUFBVSxHQUFHLENBQUMsR0FBRyxhQUFhLEtBQUssQ0FBQyxhQUFhLFFBQVEsS0FBSyxDQUFDLFNBQVMsUUFBUSxLQUFLLENBQUMsYUFBYSxHQUFHO1lBQzdHLFdBQVcsRUFBRSx5QkFBeUI7U0FDdkMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUU7WUFDcEMsS0FBSyxFQUFFLDhCQUE4QixHQUFHLENBQUMsR0FBRyxFQUFFO1lBQzlDLFdBQVcsRUFBRSwwQ0FBMEM7U0FDeEQsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGO0FBbldELDREQW1XQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBlYzIgZnJvbSAnYXdzLWNkay1saWIvYXdzLWVjMic7XG5pbXBvcnQgKiBhcyBzMyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtczMnO1xuaW1wb3J0ICogYXMgY2xvdWRmcm9udCBmcm9tICdhd3MtY2RrLWxpYi9hd3MtY2xvdWRmcm9udCc7XG5pbXBvcnQgKiBhcyBvcmlnaW5zIGZyb20gJ2F3cy1jZGstbGliL2F3cy1jbG91ZGZyb250LW9yaWdpbnMnO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0ICogYXMgczNkZXBsb3kgZnJvbSAnYXdzLWNkay1saWIvYXdzLXMzLWRlcGxveW1lbnQnO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRyZWZmSW5mcmFzdHJ1Y3R1cmVTdGFja1Byb3BzIGV4dGVuZHMgY2RrLlN0YWNrUHJvcHMge1xuICBpbnN0YW5jZVR5cGU6IHN0cmluZztcbiAgbXlzcWxSb290UGFzc3dvcmQ6IHN0cmluZztcbiAgbXlzcWxEYXRhYmFzZTogc3RyaW5nO1xuICBteXNxbFVzZXI6IHN0cmluZztcbiAgbXlzcWxQYXNzd29yZDogc3RyaW5nO1xuICBkb21haW5OYW1lPzogc3RyaW5nO1xuICBmcm9udGVuZEJ1Y2tldE5hbWU/OiBzdHJpbmc7XG4gIGFzc2V0c0J1Y2tldE5hbWU/OiBzdHJpbmc7XG4gIHR3aWxpb0FjY291bnRTaWQ/OiBzdHJpbmc7XG4gIHR3aWxpb0F1dGhUb2tlbj86IHN0cmluZztcbiAgdHdpbGlvUGhvbmU/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBUcmVmZkluZnJhc3RydWN0dXJlU3RhY2sgZXh0ZW5kcyBjZGsuU3RhY2sge1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogVHJlZmZJbmZyYXN0cnVjdHVyZVN0YWNrUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBWUEMgYW5kIE5ldHdvcmtpbmdcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgY29uc3QgdnBjID0gbmV3IGVjMi5WcGModGhpcywgJ1RyZWZmVlBDJywge1xuICAgICAgbWF4QXpzOiAyLFxuICAgICAgbmF0R2F0ZXdheXM6IDAsIC8vIFNhdmUgY29zdHMgLSB1c2UgcHVibGljIHN1Ym5ldCBvbmx5XG4gICAgICBzdWJuZXRDb25maWd1cmF0aW9uOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBjaWRyTWFzazogMjQsXG4gICAgICAgICAgbmFtZTogJ1B1YmxpYycsXG4gICAgICAgICAgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFVCTElDLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIC8vIFNlY3VyaXR5IEdyb3VwIGZvciBFQzJcbiAgICBjb25zdCBlYzJTZWN1cml0eUdyb3VwID0gbmV3IGVjMi5TZWN1cml0eUdyb3VwKHRoaXMsICdUcmVmZkVDMlNlY3VyaXR5R3JvdXAnLCB7XG4gICAgICB2cGMsXG4gICAgICBkZXNjcmlwdGlvbjogJ1NlY3VyaXR5IGdyb3VwIGZvciBUcmVmZiBFQzIgaW5zdGFuY2UnLFxuICAgICAgYWxsb3dBbGxPdXRib3VuZDogdHJ1ZSxcbiAgICB9KTtcblxuICAgIC8vIEFsbG93IEhUVFAvSFRUUFMgZnJvbSBhbnl3aGVyZVxuICAgIGVjMlNlY3VyaXR5R3JvdXAuYWRkSW5ncmVzc1J1bGUoXG4gICAgICBlYzIuUGVlci5hbnlJcHY0KCksXG4gICAgICBlYzIuUG9ydC50Y3AoODApLFxuICAgICAgJ0FsbG93IEhUVFAgdHJhZmZpYydcbiAgICApO1xuICAgIGVjMlNlY3VyaXR5R3JvdXAuYWRkSW5ncmVzc1J1bGUoXG4gICAgICBlYzIuUGVlci5hbnlJcHY0KCksXG4gICAgICBlYzIuUG9ydC50Y3AoNDQzKSxcbiAgICAgICdBbGxvdyBIVFRQUyB0cmFmZmljJ1xuICAgICk7XG5cbiAgICAvLyBBbGxvdyBTU0ggKG9wdGlvbmFsIC0gZm9yIGRlYnVnZ2luZylcbiAgICBlYzJTZWN1cml0eUdyb3VwLmFkZEluZ3Jlc3NSdWxlKFxuICAgICAgZWMyLlBlZXIuYW55SXB2NCgpLFxuICAgICAgZWMyLlBvcnQudGNwKDIyKSxcbiAgICAgICdBbGxvdyBTU0ggYWNjZXNzJ1xuICAgICk7XG5cbiAgICAvLyBBbGxvdyBNeVNRTCBwb3J0IChmb3IgZXh0ZXJuYWwgYWNjZXNzIGlmIG5lZWRlZClcbiAgICBlYzJTZWN1cml0eUdyb3VwLmFkZEluZ3Jlc3NSdWxlKFxuICAgICAgZWMyLlBlZXIuYW55SXB2NCgpLFxuICAgICAgZWMyLlBvcnQudGNwKDMzMDYpLFxuICAgICAgJ0FsbG93IE15U1FMIGFjY2VzcyAob3B0aW9uYWwgLSBjYW4gYmUgcmVtb3ZlZCBmb3IgcHJvZHVjdGlvbiknXG4gICAgKTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBFQzIgSW5zdGFuY2UgZm9yIEJhY2tlbmQgKyBNeVNRTFxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBcbiAgICAvLyBJQU0gUm9sZSBmb3IgRUMyXG4gICAgY29uc3QgZWMyUm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCAnVHJlZmZFQzJSb2xlJywge1xuICAgICAgYXNzdW1lZEJ5OiBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2VjMi5hbWF6b25hd3MuY29tJyksXG4gICAgICBtYW5hZ2VkUG9saWNpZXM6IFtcbiAgICAgICAgaWFtLk1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCdBbWF6b25TU01NYW5hZ2VkSW5zdGFuY2VDb3JlJyksXG4gICAgICAgIGlhbS5NYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZSgnQ2xvdWRXYXRjaEFnZW50U2VydmVyUG9saWN5JyksXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgLy8gVXNlciBkYXRhIHNjcmlwdFxuICAgIGNvbnN0IHVzZXJEYXRhU2NyaXB0ID0gZWMyLlVzZXJEYXRhLmZvckxpbnV4KCk7XG4gICAgdXNlckRhdGFTY3JpcHQuYWRkQ29tbWFuZHMoXG4gICAgICAnIyEvYmluL2Jhc2gnLFxuICAgICAgJ3NldCAtZScsXG4gICAgICAnJyxcbiAgICAgICcjIFVwZGF0ZSBzeXN0ZW0nLFxuICAgICAgJ2FwdC1nZXQgdXBkYXRlIC15JyxcbiAgICAgICdhcHQtZ2V0IHVwZ3JhZGUgLXknLFxuICAgICAgJycsXG4gICAgICAnIyBJbnN0YWxsIGRlcGVuZGVuY2llcycsXG4gICAgICAnYXB0LWdldCBpbnN0YWxsIC15IHdnZXQgY3VybCBnaXQgbmdpbnggbXlzcWwtc2VydmVyIG15c3FsLWNsaWVudCB1bnppcCcsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgTXlTUUwgU2V0dXAnLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnc3lzdGVtY3RsIHN0YXJ0IG15c3FsJyxcbiAgICAgICdzeXN0ZW1jdGwgZW5hYmxlIG15c3FsJyxcbiAgICAgICcnLFxuICAgICAgYCMgU2V0IE15U1FMIHJvb3QgcGFzc3dvcmRgLFxuICAgICAgYG15c3FsIC1lIFwiQUxURVIgVVNFUiAncm9vdCdAJ2xvY2FsaG9zdCcgSURFTlRJRklFRCBXSVRIIG15c3FsX25hdGl2ZV9wYXNzd29yZCBCWSAnJHtwcm9wcy5teXNxbFJvb3RQYXNzd29yZH0nO1wiYCxcbiAgICAgIGBteXNxbCAtZSBcIkZMVVNIIFBSSVZJTEVHRVM7XCJgLFxuICAgICAgJycsXG4gICAgICBgIyBDcmVhdGUgZGF0YWJhc2UgYW5kIHVzZXJgLFxuICAgICAgYG15c3FsIC11cm9vdCAtcCcke3Byb3BzLm15c3FsUm9vdFBhc3N3b3JkfScgLWUgXCJDUkVBVEUgREFUQUJBU0UgSUYgTk9UIEVYSVNUUyAke3Byb3BzLm15c3FsRGF0YWJhc2V9O1wiYCxcbiAgICAgIGBteXNxbCAtdXJvb3QgLXAnJHtwcm9wcy5teXNxbFJvb3RQYXNzd29yZH0nIC1lIFwiQ1JFQVRFIFVTRVIgSUYgTk9UIEVYSVNUUyAnJHtwcm9wcy5teXNxbFVzZXJ9J0AnbG9jYWxob3N0JyBJREVOVElGSUVEIEJZICcke3Byb3BzLm15c3FsUGFzc3dvcmR9JztcImAsXG4gICAgICBgbXlzcWwgLXVyb290IC1wJyR7cHJvcHMubXlzcWxSb290UGFzc3dvcmR9JyAtZSBcIkdSQU5UIEFMTCBQUklWSUxFR0VTIE9OICR7cHJvcHMubXlzcWxEYXRhYmFzZX0uKiBUTyAnJHtwcm9wcy5teXNxbFVzZXJ9J0AnbG9jYWxob3N0JztcImAsXG4gICAgICBgbXlzcWwgLXVyb290IC1wJyR7cHJvcHMubXlzcWxSb290UGFzc3dvcmR9JyAtZSBcIkZMVVNIIFBSSVZJTEVHRVM7XCJgLFxuICAgICAgJycsXG4gICAgICAnIyBDb25maWd1cmUgTXlTUUwgdG8gbGlzdGVuIG9uIGFsbCBpbnRlcmZhY2VzIChvcHRpb25hbCknLFxuICAgICAgYHNlZCAtaSAncy9iaW5kLWFkZHJlc3MuKi9iaW5kLWFkZHJlc3MgPSAwLjAuMC4wLycgL2V0Yy9teXNxbC9teXNxbC5jb25mLmQvbXlzcWxkLmNuZmAsXG4gICAgICAnc3lzdGVtY3RsIHJlc3RhcnQgbXlzcWwnLFxuICAgICAgJycsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICcjIC5ORVQgOCBSdW50aW1lIEluc3RhbGxhdGlvbicsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICd3Z2V0IGh0dHBzOi8vZG90Lm5ldC92MS9kb3RuZXQtaW5zdGFsbC5zaCAtTyBkb3RuZXQtaW5zdGFsbC5zaCcsXG4gICAgICAnY2htb2QgK3ggZG90bmV0LWluc3RhbGwuc2gnLFxuICAgICAgJy4vZG90bmV0LWluc3RhbGwuc2ggLS1jaGFubmVsIDguMCAtLXJ1bnRpbWUgYXNwbmV0Y29yZScsXG4gICAgICAnLi9kb3RuZXQtaW5zdGFsbC5zaCAtLWNoYW5uZWwgOC4wIC0tcnVudGltZSBkb3RuZXQnLFxuICAgICAgJycsXG4gICAgICAnIyBBZGQgLk5FVCB0byBQQVRIJyxcbiAgICAgICdlY2hvIFwiZXhwb3J0IERPVE5FVF9ST09UPSRIT01FLy5kb3RuZXRcIiA+PiAvcm9vdC8uYmFzaHJjJyxcbiAgICAgICdlY2hvIFwiZXhwb3J0IFBBVEg9JFBBVEg6JERPVE5FVF9ST09UOiRET1RORVRfUk9PVC90b29sc1wiID4+IC9yb290Ly5iYXNocmMnLFxuICAgICAgJ2V4cG9ydCBET1RORVRfUk9PVD0kSE9NRS8uZG90bmV0JyxcbiAgICAgICdleHBvcnQgUEFUSD0kUEFUSDokRE9UTkVUX1JPT1Q6JERPVE5FVF9ST09UL3Rvb2xzJyxcbiAgICAgICcnLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnIyBBcHBsaWNhdGlvbiBTZXR1cCBEaXJlY3RvcnknLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnbWtkaXIgLXAgL3Zhci93d3cvdHJlZmYtYmFja2VuZCcsXG4gICAgICAnY2hvd24gLVIgd3d3LWRhdGE6d3d3LWRhdGEgL3Zhci93d3cvdHJlZmYtYmFja2VuZCcsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgTmdpbnggQ29uZmlndXJhdGlvbicsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICdjYXQgPiAvZXRjL25naW54L3NpdGVzLWF2YWlsYWJsZS90cmVmZiA8PEVPRicsXG4gICAgICAnc2VydmVyIHsnLFxuICAgICAgJyAgICBsaXN0ZW4gODA7JyxcbiAgICAgICcgICAgc2VydmVyX25hbWUgXzsnLFxuICAgICAgJycsXG4gICAgICAnICAgIGxvY2F0aW9uIC8geycsXG4gICAgICAnICAgICAgICBwcm94eV9wYXNzIGh0dHA6Ly8xMjcuMC4wLjE6NTAwMDsnLFxuICAgICAgJyAgICAgICAgcHJveHlfaHR0cF92ZXJzaW9uIDEuMTsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBVcGdyYWRlIFxcXFwkaHR0cF91cGdyYWRlOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIENvbm5lY3Rpb24gXCJ1cGdyYWRlXCI7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgSG9zdCBcXFxcJGhvc3Q7JyxcbiAgICAgICcgICAgICAgIHByb3h5X2NhY2hlX2J5cGFzcyBcXFxcJGh0dHBfdXBncmFkZTsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Gb3IgXFxcXCRwcm94eV9hZGRfeF9mb3J3YXJkZWRfZm9yOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLVByb3RvIFxcXFwkc2NoZW1lOycsXG4gICAgICAnICAgIH0nLFxuICAgICAgJycsXG4gICAgICAnICAgICMgU2lnbmFsUiBXZWJTb2NrZXQgc3VwcG9ydCcsXG4gICAgICAnICAgIGxvY2F0aW9uIC9odWJzLyB7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3Bhc3MgaHR0cDovLzEyNy4wLjAuMTo1MDAwOycsXG4gICAgICAnICAgICAgICBwcm94eV9odHRwX3ZlcnNpb24gMS4xOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFVwZ3JhZGUgXFxcXCRodHRwX3VwZ3JhZGU7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgQ29ubmVjdGlvbiBcInVwZ3JhZGVcIjsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBIb3N0IFxcXFwkaG9zdDsnLFxuICAgICAgJyAgICAgICAgcHJveHlfY2FjaGVfYnlwYXNzIFxcXFwkaHR0cF91cGdyYWRlOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLUZvciBcXFxcJHByb3h5X2FkZF94X2ZvcndhcmRlZF9mb3I7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgWC1Gb3J3YXJkZWQtUHJvdG8gXFxcXCRzY2hlbWU7JyxcbiAgICAgICcgICAgfScsXG4gICAgICAnfScsXG4gICAgICAnRU9GJyxcbiAgICAgICcnLFxuICAgICAgJ2xuIC1zZiAvZXRjL25naW54L3NpdGVzLWF2YWlsYWJsZS90cmVmZiAvZXRjL25naW54L3NpdGVzLWVuYWJsZWQvJyxcbiAgICAgICdybSAtZiAvZXRjL25naW54L3NpdGVzLWVuYWJsZWQvZGVmYXVsdCcsXG4gICAgICAnbmdpbnggLXQnLFxuICAgICAgJ3N5c3RlbWN0bCByZXN0YXJ0IG5naW54JyxcbiAgICAgICdzeXN0ZW1jdGwgZW5hYmxlIG5naW54JyxcbiAgICAgICcnLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnIyBDcmVhdGUgc3lzdGVtZCBzZXJ2aWNlIGZvciAuTkVUIGFwcCcsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICdjYXQgPiAvZXRjL3N5c3RlbWQvc3lzdGVtL3RyZWZmLWJhY2tlbmQuc2VydmljZSA8PEVPRicsXG4gICAgICAnW1VuaXRdJyxcbiAgICAgICdEZXNjcmlwdGlvbj1UcmVmZiAuTkVUIEJhY2tlbmQnLFxuICAgICAgJ0FmdGVyPW5ldHdvcmsudGFyZ2V0IG15c3FsLnNlcnZpY2UnLFxuICAgICAgJycsXG4gICAgICAnW1NlcnZpY2VdJyxcbiAgICAgICdUeXBlPW5vdGlmeScsXG4gICAgICAnV29ya2luZ0RpcmVjdG9yeT0vdmFyL3d3dy90cmVmZi1iYWNrZW5kJyxcbiAgICAgICdFeGVjU3RhcnQ9L3Jvb3QvLmRvdG5ldC9kb3RuZXQgL3Zhci93d3cvdHJlZmYtYmFja2VuZC9XZWJBcGkuZGxsJyxcbiAgICAgICdSZXN0YXJ0PWFsd2F5cycsXG4gICAgICAnUmVzdGFydFNlYz0xMCcsXG4gICAgICAnS2lsbFNpZ25hbD1TSUdJTlQnLFxuICAgICAgJ1N5c2xvZ0lkZW50aWZpZXI9dHJlZmYtYmFja2VuZCcsXG4gICAgICAnVXNlcj13d3ctZGF0YScsXG4gICAgICAnRW52aXJvbm1lbnQ9QVNQTkVUQ09SRV9FTlZJUk9OTUVOVD1Qcm9kdWN0aW9uJyxcbiAgICAgICdFbnZpcm9ubWVudD1ET1RORVRfUk9PVD0vcm9vdC8uZG90bmV0JyxcbiAgICAgICdFbnZpcm9ubWVudD1QQVRIPS91c3IvbG9jYWwvc2JpbjovdXNyL2xvY2FsL2JpbjovdXNyL3NiaW46L3Vzci9iaW46L3NiaW46L2Jpbjovcm9vdC8uZG90bmV0Oi9yb290Ly5kb3RuZXQvdG9vbHMnLFxuICAgICAgLi4uKHByb3BzLnR3aWxpb0FjY291bnRTaWQgPyBbYEVudmlyb25tZW50PVR3aWxpb0NvbmZpZ19fQWNjb3VudFNpZD0ke3Byb3BzLnR3aWxpb0FjY291bnRTaWR9YF0gOiBbXSksXG4gICAgICAuLi4ocHJvcHMudHdpbGlvQXV0aFRva2VuID8gW2BFbnZpcm9ubWVudD1Ud2lsaW9Db25maWdfX0F1dGhUb2tlbj0ke3Byb3BzLnR3aWxpb0F1dGhUb2tlbn1gXSA6IFtdKSxcbiAgICAgIC4uLihwcm9wcy50d2lsaW9QaG9uZSA/IFtgRW52aXJvbm1lbnQ9VHdpbGlvQ29uZmlnX19QaG9uZT0ke3Byb3BzLnR3aWxpb1Bob25lfWBdIDogW10pLFxuICAgICAgJycsXG4gICAgICAnW0luc3RhbGxdJyxcbiAgICAgICdXYW50ZWRCeT1tdWx0aS11c2VyLnRhcmdldCcsXG4gICAgICAnRU9GJyxcbiAgICAgICcnLFxuICAgICAgJ3N5c3RlbWN0bCBkYWVtb24tcmVsb2FkJyxcbiAgICAgICcjIE5vdGU6IFNlcnZpY2Ugd2lsbCBmYWlsIHVudGlsIHlvdSBkZXBsb3kgdGhlIGFwcGxpY2F0aW9uJyxcbiAgICAgICcjIHN5c3RlbWN0bCBlbmFibGUgdHJlZmYtYmFja2VuZCcsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgQ3JlYXRlIGRlcGxveW1lbnQgc2NyaXB0JyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJ2NhdCA+IC9yb290L2RlcGxveS1iYWNrZW5kLnNoIDw8RU9GJyxcbiAgICAgICcjIS9iaW4vYmFzaCcsXG4gICAgICAnZWNobyBcIlN0b3BwaW5nIGJhY2tlbmQgc2VydmljZS4uLlwiJyxcbiAgICAgICdzeXN0ZW1jdGwgc3RvcCB0cmVmZi1iYWNrZW5kJyxcbiAgICAgICcnLFxuICAgICAgJ2VjaG8gXCJEZXBsb3lpbmcgbmV3IHZlcnNpb24uLi5cIicsXG4gICAgICAnIyBZb3VyIGRlcGxveW1lbnQgY29tbWFuZHMgaGVyZScsXG4gICAgICAnIyBFeGFtcGxlOiBjb3B5IGZpbGVzLCBydW4gbWlncmF0aW9ucywgZXRjLicsXG4gICAgICAnJyxcbiAgICAgICdlY2hvIFwiU3RhcnRpbmcgYmFja2VuZCBzZXJ2aWNlLi4uXCInLFxuICAgICAgJ3N5c3RlbWN0bCBzdGFydCB0cmVmZi1iYWNrZW5kJyxcbiAgICAgICdzeXN0ZW1jdGwgc3RhdHVzIHRyZWZmLWJhY2tlbmQnLFxuICAgICAgJ0VPRicsXG4gICAgICAnJyxcbiAgICAgICdjaG1vZCAreCAvcm9vdC9kZXBsb3ktYmFja2VuZC5zaCcsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgSW5zdGFsbCBDbG91ZFdhdGNoIGFnZW50IChvcHRpb25hbCknLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnd2dldCBodHRwczovL3MzLmFtYXpvbmF3cy5jb20vYW1hem9uY2xvdWR3YXRjaC1hZ2VudC91YnVudHUvYXJtNjQvbGF0ZXN0L2FtYXpvbi1jbG91ZHdhdGNoLWFnZW50LmRlYicsXG4gICAgICAnZHBrZyAtaSAtRSAuL2FtYXpvbi1jbG91ZHdhdGNoLWFnZW50LmRlYicsXG4gICAgICAnJyxcbiAgICAgICdlY2hvIFwiRUMyIHNldHVwIGNvbXBsZXRlIVwiJyxcbiAgICAgICdlY2hvIFwiTXlTUUwgcm9vdCBwYXNzd29yZDogJHtwcm9wcy5teXNxbFJvb3RQYXNzd29yZH1cIicsXG4gICAgICAnZWNobyBcIk15U1FMIGRhdGFiYXNlOiAke3Byb3BzLm15c3FsRGF0YWJhc2V9XCInLFxuICAgICAgJ2VjaG8gXCJNeVNRTCB1c2VyOiAke3Byb3BzLm15c3FsVXNlcn1cIicsXG4gICAgICAnZWNobyBcIk15U1FMIHBhc3N3b3JkOiAke3Byb3BzLm15c3FsUGFzc3dvcmR9XCInLFxuICAgICAgJ2VjaG8gXCJcIicsXG4gICAgICAnZWNobyBcIk5leHQgc3RlcHM6XCInLFxuICAgICAgJ2VjaG8gXCIxLiBEZXBsb3kgeW91ciAuTkVUIGFwcGxpY2F0aW9uIHRvIC92YXIvd3d3L3RyZWZmLWJhY2tlbmQvXCInLFxuICAgICAgJ2VjaG8gXCIyLiBVcGRhdGUgY29ubmVjdGlvbiBzdHJpbmcgaW4gYXBwc2V0dGluZ3MuUHJvZHVjdGlvbi5qc29uXCInLFxuICAgICAgJ2VjaG8gXCIzLiBSdW46IHN5c3RlbWN0bCBlbmFibGUgdHJlZmYtYmFja2VuZFwiJyxcbiAgICAgICdlY2hvIFwiNC4gUnVuOiBzeXN0ZW1jdGwgc3RhcnQgdHJlZmYtYmFja2VuZFwiJyxcbiAgICApO1xuXG4gICAgLy8gRUMyIEluc3RhbmNlXG4gICAgY29uc3QgZWMySW5zdGFuY2UgPSBuZXcgZWMyLkluc3RhbmNlKHRoaXMsICdUcmVmZkVDMkluc3RhbmNlJywge1xuICAgICAgdnBjLFxuICAgICAgdnBjU3VibmV0czoge1xuICAgICAgICBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QVUJMSUMsXG4gICAgICB9LFxuICAgICAgaW5zdGFuY2VUeXBlOiBuZXcgZWMyLkluc3RhbmNlVHlwZShwcm9wcy5pbnN0YW5jZVR5cGUpLFxuICAgICAgbWFjaGluZUltYWdlOiBlYzIuTWFjaGluZUltYWdlLmZyb21Tc21QYXJhbWV0ZXIoXG4gICAgICAgICcvYXdzL3NlcnZpY2UvY2Fub25pY2FsL3VidW50dS9zZXJ2ZXIvMjIuMDQvc3RhYmxlL2N1cnJlbnQvYXJtNjQvaHZtL2Vicy1ncDIvYW1pLWlkJyxcbiAgICAgICAge1xuICAgICAgICAgIG9zOiBlYzIuT3BlcmF0aW5nU3lzdGVtVHlwZS5MSU5VWCxcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHNlY3VyaXR5R3JvdXA6IGVjMlNlY3VyaXR5R3JvdXAsXG4gICAgICByb2xlOiBlYzJSb2xlLFxuICAgICAgdXNlckRhdGE6IHVzZXJEYXRhU2NyaXB0LFxuICAgICAgYmxvY2tEZXZpY2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBkZXZpY2VOYW1lOiAnL2Rldi9zZGExJyxcbiAgICAgICAgICB2b2x1bWU6IGVjMi5CbG9ja0RldmljZVZvbHVtZS5lYnMoMzAsIHtcbiAgICAgICAgICAgIHZvbHVtZVR5cGU6IGVjMi5FYnNEZXZpY2VWb2x1bWVUeXBlLkdQMyxcbiAgICAgICAgICAgIGRlbGV0ZU9uVGVybWluYXRpb246IHRydWUsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgLy8gRWxhc3RpYyBJUCBmb3IgRUMyXG4gICAgY29uc3QgZWlwID0gbmV3IGVjMi5DZm5FSVAodGhpcywgJ1RyZWZmRUMyRUlQJywge1xuICAgICAgaW5zdGFuY2VJZDogZWMySW5zdGFuY2UuaW5zdGFuY2VJZCxcbiAgICB9KTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBTMyBCdWNrZXQgZm9yIEZyb250ZW5kICh1c2UgZXhpc3Rpbmcgb3IgY3JlYXRlIG5ldylcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgY29uc3QgZnJvbnRlbmRCdWNrZXQgPSBwcm9wcy5mcm9udGVuZEJ1Y2tldE5hbWVcbiAgICAgID8gczMuQnVja2V0LmZyb21CdWNrZXROYW1lKHRoaXMsICdUcmVmZkZyb250ZW5kQnVja2V0JywgcHJvcHMuZnJvbnRlbmRCdWNrZXROYW1lKVxuICAgICAgOiBuZXcgczMuQnVja2V0KHRoaXMsICdUcmVmZkZyb250ZW5kQnVja2V0Jywge1xuICAgICAgICAgIGJ1Y2tldE5hbWU6IGB0cmVmZi1mcm9udGVuZC0ke3RoaXMuYWNjb3VudH1gLFxuICAgICAgICAgIHdlYnNpdGVJbmRleERvY3VtZW50OiAnaW5kZXguaHRtbCcsXG4gICAgICAgICAgd2Vic2l0ZUVycm9yRG9jdW1lbnQ6ICdpbmRleC5odG1sJyxcbiAgICAgICAgICBwdWJsaWNSZWFkQWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBibG9ja1B1YmxpY0FjY2VzczogczMuQmxvY2tQdWJsaWNBY2Nlc3MuQkxPQ0tfQUxMLFxuICAgICAgICAgIHJlbW92YWxQb2xpY3k6IGNkay5SZW1vdmFsUG9saWN5LlJFVEFJTixcbiAgICAgICAgICBhdXRvRGVsZXRlT2JqZWN0czogZmFsc2UsXG4gICAgICAgICAgZW5jcnlwdGlvbjogczMuQnVja2V0RW5jcnlwdGlvbi5TM19NQU5BR0VELFxuICAgICAgICB9KTtcblxuICAgIC8vIE9yaWdpbiBBY2Nlc3MgSWRlbnRpdHkgZm9yIENsb3VkRnJvbnRcbiAgICBjb25zdCBvYWkgPSBuZXcgY2xvdWRmcm9udC5PcmlnaW5BY2Nlc3NJZGVudGl0eSh0aGlzLCAnVHJlZmZPQUknLCB7XG4gICAgICBjb21tZW50OiAnT0FJIGZvciBUcmVmZiBmcm9udGVuZCcsXG4gICAgfSk7XG5cbiAgICAvLyBHcmFudCByZWFkIGFjY2VzcyBvbmx5IGlmIHdlIGNyZWF0ZWQgdGhlIGJ1Y2tldCAoaW1wb3J0ZWQgYnVja2V0cyBjYW4ndCBiZSBtb2RpZmllZClcbiAgICBpZiAoIXByb3BzLmZyb250ZW5kQnVja2V0TmFtZSAmJiBmcm9udGVuZEJ1Y2tldCBpbnN0YW5jZW9mIHMzLkJ1Y2tldCkge1xuICAgICAgZnJvbnRlbmRCdWNrZXQuZ3JhbnRSZWFkKG9haSk7XG4gICAgfVxuXG4gICAgLy8gQ2xvdWRGcm9udCBEaXN0cmlidXRpb25cbiAgICBjb25zdCBkaXN0cmlidXRpb24gPSBuZXcgY2xvdWRmcm9udC5EaXN0cmlidXRpb24odGhpcywgJ1RyZWZmRGlzdHJpYnV0aW9uJywge1xuICAgICAgZGVmYXVsdEJlaGF2aW9yOiB7XG4gICAgICAgIG9yaWdpbjogbmV3IG9yaWdpbnMuUzNPcmlnaW4oZnJvbnRlbmRCdWNrZXQsIHtcbiAgICAgICAgICBvcmlnaW5BY2Nlc3NJZGVudGl0eTogb2FpLFxuICAgICAgICB9KSxcbiAgICAgICAgdmlld2VyUHJvdG9jb2xQb2xpY3k6IGNsb3VkZnJvbnQuVmlld2VyUHJvdG9jb2xQb2xpY3kuUkVESVJFQ1RfVE9fSFRUUFMsXG4gICAgICAgIGNhY2hlUG9saWN5OiBjbG91ZGZyb250LkNhY2hlUG9saWN5LkNBQ0hJTkdfT1BUSU1JWkVELFxuICAgICAgfSxcbiAgICAgIGRlZmF1bHRSb290T2JqZWN0OiAnaW5kZXguaHRtbCcsXG4gICAgICBlcnJvclJlc3BvbnNlczogW1xuICAgICAgICB7XG4gICAgICAgICAgaHR0cFN0YXR1czogNDAzLFxuICAgICAgICAgIHJlc3BvbnNlSHR0cFN0YXR1czogMjAwLFxuICAgICAgICAgIHJlc3BvbnNlUGFnZVBhdGg6ICcvaW5kZXguaHRtbCcsXG4gICAgICAgICAgdHRsOiBjZGsuRHVyYXRpb24ubWludXRlcyg1KSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGh0dHBTdGF0dXM6IDQwNCxcbiAgICAgICAgICByZXNwb25zZUh0dHBTdGF0dXM6IDIwMCxcbiAgICAgICAgICByZXNwb25zZVBhZ2VQYXRoOiAnL2luZGV4Lmh0bWwnLFxuICAgICAgICAgIHR0bDogY2RrLkR1cmF0aW9uLm1pbnV0ZXMoNSksXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgcHJpY2VDbGFzczogY2xvdWRmcm9udC5QcmljZUNsYXNzLlBSSUNFX0NMQVNTXzEwMCwgLy8gQ2hlYXBlc3Qgb3B0aW9uXG4gICAgfSk7XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gT3V0cHV0c1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnRUMyUHVibGljSVAnLCB7XG4gICAgICB2YWx1ZTogZWlwLnJlZixcbiAgICAgIGRlc2NyaXB0aW9uOiAnRUMyIEluc3RhbmNlIFB1YmxpYyBJUCcsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnRUMySW5zdGFuY2VJZCcsIHtcbiAgICAgIHZhbHVlOiBlYzJJbnN0YW5jZS5pbnN0YW5jZUlkLFxuICAgICAgZGVzY3JpcHRpb246ICdFQzIgSW5zdGFuY2UgSUQnLFxuICAgIH0pO1xuXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0JhY2tlbmRVUkwnLCB7XG4gICAgICB2YWx1ZTogYGh0dHA6Ly8ke2VpcC5yZWZ9YCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQmFja2VuZCBBUEkgVVJMJyxcbiAgICB9KTtcblxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdGcm9udGVuZEJ1Y2tldCcsIHtcbiAgICAgIHZhbHVlOiBmcm9udGVuZEJ1Y2tldC5idWNrZXROYW1lLFxuICAgICAgZGVzY3JpcHRpb246ICdTMyBCdWNrZXQgZm9yIEZyb250ZW5kJyxcbiAgICB9KTtcblxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdDbG91ZEZyb250VVJMJywge1xuICAgICAgdmFsdWU6IGBodHRwczovLyR7ZGlzdHJpYnV0aW9uLmRpc3RyaWJ1dGlvbkRvbWFpbk5hbWV9YCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQ2xvdWRGcm9udCBEaXN0cmlidXRpb24gVVJMJyxcbiAgICB9KTtcblxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdDbG91ZEZyb250RGlzdHJpYnV0aW9uSWQnLCB7XG4gICAgICB2YWx1ZTogZGlzdHJpYnV0aW9uLmRpc3RyaWJ1dGlvbklkLFxuICAgICAgZGVzY3JpcHRpb246ICdDbG91ZEZyb250IERpc3RyaWJ1dGlvbiBJRCcsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnTXlTUUxDb25uZWN0aW9uU3RyaW5nJywge1xuICAgICAgdmFsdWU6IGBTZXJ2ZXI9JHtlaXAucmVmfTtEYXRhYmFzZT0ke3Byb3BzLm15c3FsRGF0YWJhc2V9O1VpZD0ke3Byb3BzLm15c3FsVXNlcn07UHdkPSR7cHJvcHMubXlzcWxQYXNzd29yZH07YCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnTXlTUUwgQ29ubmVjdGlvbiBTdHJpbmcnLFxuICAgIH0pO1xuXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ1NTSENvbW1hbmQnLCB7XG4gICAgICB2YWx1ZTogYHNzaCAtaSB5b3VyLWtleS5wZW0gdWJ1bnR1QCR7ZWlwLnJlZn1gLFxuICAgICAgZGVzY3JpcHRpb246ICdTU0ggQ29tbWFuZCAoeW91IG5lZWQgdG8gYWRkIGEga2V5IHBhaXIpJyxcbiAgICB9KTtcbiAgfVxufVxuIl19
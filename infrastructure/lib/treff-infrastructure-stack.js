"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.TreffInfrastructureStack = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const ec2 = __importStar(require("aws-cdk-lib/aws-ec2"));
const s3 = __importStar(require("aws-cdk-lib/aws-s3"));
const cloudfront = __importStar(require("aws-cdk-lib/aws-cloudfront"));
const origins = __importStar(require("aws-cdk-lib/aws-cloudfront-origins"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
class TreffInfrastructureStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        // ========================================
        // VPC and Networking
        // ========================================
        const vpc = new ec2.Vpc(this, 'TreffVPC', {
            maxAzs: 2,
            natGateways: 0, // Save costs - use public subnet only
            subnetConfiguration: [
                {
                    cidrMask: 24,
                    name: 'Public',
                    subnetType: ec2.SubnetType.PUBLIC,
                },
            ],
        });
        // Security Group for EC2
        const ec2SecurityGroup = new ec2.SecurityGroup(this, 'TreffEC2SecurityGroup', {
            vpc,
            description: 'Security group for Treff EC2 instance',
            allowAllOutbound: true,
        });
        // Allow HTTP/HTTPS from anywhere
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(80), 'Allow HTTP traffic');
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(443), 'Allow HTTPS traffic');
        // Allow SSH (optional - for debugging)
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(22), 'Allow SSH access');
        // Allow MySQL port (for external access if needed)
        ec2SecurityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(3306), 'Allow MySQL access (optional - can be removed for production)');
        // ========================================
        // EC2 Instance for Backend + MySQL
        // ========================================
        // IAM Role for EC2
        const ec2Role = new iam.Role(this, 'TreffEC2Role', {
            assumedBy: new iam.ServicePrincipal('ec2.amazonaws.com'),
            managedPolicies: [
                iam.ManagedPolicy.fromAwsManagedPolicyName('AmazonSSMManagedInstanceCore'),
                iam.ManagedPolicy.fromAwsManagedPolicyName('CloudWatchAgentServerPolicy'),
            ],
        });
        // Grant S3 access for deployments (if deployment bucket exists)
        if (props.assetsBucketName) {
            const deploymentBucket = s3.Bucket.fromBucketName(this, 'DeploymentBucket', 'treff-deployments-prod');
            deploymentBucket.grantRead(ec2Role);
        }
        // User data script
        const userDataScript = ec2.UserData.forLinux();
        userDataScript.addCommands('#!/bin/bash', 'set -e', '', '# Update system', 'apt-get update -y', 'apt-get upgrade -y', '', '# Install dependencies', 'apt-get install -y wget curl git nginx mysql-server mysql-client unzip awscli', '', '# ========================================', '# MySQL Setup', '# ========================================', 'systemctl start mysql', 'systemctl enable mysql', '', `# Set MySQL root password`, `mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '${props.mysqlRootPassword}';"`, `mysql -e "FLUSH PRIVILEGES;"`, '', `# Create database and user`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "CREATE DATABASE IF NOT EXISTS ${props.mysqlDatabase};"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "CREATE USER IF NOT EXISTS '${props.mysqlUser}'@'localhost' IDENTIFIED BY '${props.mysqlPassword}';"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "GRANT ALL PRIVILEGES ON ${props.mysqlDatabase}.* TO '${props.mysqlUser}'@'localhost';"`, `mysql -uroot -p'${props.mysqlRootPassword}' -e "FLUSH PRIVILEGES;"`, '', '# Configure MySQL to listen on all interfaces (optional)', `sed -i 's/bind-address.*/bind-address = 0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf`, 'systemctl restart mysql', '', '# ========================================', '# .NET 8 Runtime Installation', '# ========================================', 'wget https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh', 'chmod +x dotnet-install.sh', './dotnet-install.sh --channel 8.0 --runtime aspnetcore', './dotnet-install.sh --channel 8.0 --runtime dotnet', '', '# Add .NET to PATH', 'echo "export DOTNET_ROOT=$HOME/.dotnet" >> /root/.bashrc', 'echo "export PATH=$PATH:$DOTNET_ROOT:$DOTNET_ROOT/tools" >> /root/.bashrc', 'export DOTNET_ROOT=$HOME/.dotnet', 'export PATH=$PATH:$DOTNET_ROOT:$DOTNET_ROOT/tools', '', '# ========================================', '# Application Setup Directory', '# ========================================', 'mkdir -p /var/www/treff-backend', 'chown -R www-data:www-data /var/www/treff-backend', '', '# ========================================', '# Nginx Configuration', '# ========================================', 'cat > /etc/nginx/sites-available/treff <<EOF', 'server {', '    listen 80;', '    server_name _;', '', '    location / {', '        proxy_pass http://127.0.0.1:5000;', '        proxy_http_version 1.1;', '        proxy_set_header Upgrade \\$http_upgrade;', '        proxy_set_header Connection "upgrade";', '        proxy_set_header Host \\$host;', '        proxy_cache_bypass \\$http_upgrade;', '        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;', '        proxy_set_header X-Forwarded-Proto \\$scheme;', '    }', '', '    # SignalR WebSocket support', '    location /hubs/ {', '        proxy_pass http://127.0.0.1:5000;', '        proxy_http_version 1.1;', '        proxy_set_header Upgrade \\$http_upgrade;', '        proxy_set_header Connection "upgrade";', '        proxy_set_header Host \\$host;', '        proxy_cache_bypass \\$http_upgrade;', '        proxy_set_header X-Forwarded-For \\$proxy_add_x_forwarded_for;', '        proxy_set_header X-Forwarded-Proto \\$scheme;', '    }', '}', 'EOF', '', 'ln -sf /etc/nginx/sites-available/treff /etc/nginx/sites-enabled/', 'rm -f /etc/nginx/sites-enabled/default', 'nginx -t', 'systemctl restart nginx', 'systemctl enable nginx', '', '# ========================================', '# Create systemd service for .NET app', '# ========================================', 'cat > /etc/systemd/system/treff-backend.service <<EOF', '[Unit]', 'Description=Treff .NET Backend', 'After=network.target mysql.service', '', '[Service]', 'Type=notify', 'WorkingDirectory=/var/www/treff-backend', 'ExecStart=/root/.dotnet/dotnet /var/www/treff-backend/WebApi.dll', 'Restart=always', 'RestartSec=10', 'KillSignal=SIGINT', 'SyslogIdentifier=treff-backend', 'User=www-data', 'Environment=ASPNETCORE_ENVIRONMENT=Production', 'Environment=DOTNET_ROOT=/root/.dotnet', 'Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/root/.dotnet:/root/.dotnet/tools', ...(props.twilioAccountSid ? [`Environment=TwilioConfig__AccountSid=${props.twilioAccountSid}`] : []), ...(props.twilioAuthToken ? [`Environment=TwilioConfig__AuthToken=${props.twilioAuthToken}`] : []), ...(props.twilioPhone ? [`Environment=TwilioConfig__Phone=${props.twilioPhone}`] : []), '', '[Install]', 'WantedBy=multi-user.target', 'EOF', '', 'systemctl daemon-reload', '# Note: Service will fail until you deploy the application', '# systemctl enable treff-backend', '', '# ========================================', '# Create deployment script', '# ========================================', 'cat > /root/deploy-backend.sh <<EOF', '#!/bin/bash', 'echo "Stopping backend service..."', 'systemctl stop treff-backend', '', 'echo "Deploying new version..."', '# Your deployment commands here', '# Example: copy files, run migrations, etc.', '', 'echo "Starting backend service..."', 'systemctl start treff-backend', 'systemctl status treff-backend', 'EOF', '', 'chmod +x /root/deploy-backend.sh', '', '# ========================================', '# Install CloudWatch agent (optional)', '# ========================================', 'wget https://s3.amazonaws.com/amazoncloudwatch-agent/ubuntu/arm64/latest/amazon-cloudwatch-agent.deb', 'dpkg -i -E ./amazon-cloudwatch-agent.deb', '', 'echo "EC2 setup complete!"', 'echo "MySQL root password: ${props.mysqlRootPassword}"', 'echo "MySQL database: ${props.mysqlDatabase}"', 'echo "MySQL user: ${props.mysqlUser}"', 'echo "MySQL password: ${props.mysqlPassword}"', 'echo ""', 'echo "Next steps:"', 'echo "1. Deploy your .NET application to /var/www/treff-backend/"', 'echo "2. Update connection string in appsettings.Production.json"', 'echo "3. Run: systemctl enable treff-backend"', 'echo "4. Run: systemctl start treff-backend"');
        // EC2 Instance
        const ec2Instance = new ec2.Instance(this, 'TreffEC2Instance', {
            vpc,
            vpcSubnets: {
                subnetType: ec2.SubnetType.PUBLIC,
            },
            instanceType: new ec2.InstanceType(props.instanceType),
            machineImage: ec2.MachineImage.fromSsmParameter('/aws/service/canonical/ubuntu/server/22.04/stable/current/arm64/hvm/ebs-gp2/ami-id', {
                os: ec2.OperatingSystemType.LINUX,
            }),
            securityGroup: ec2SecurityGroup,
            role: ec2Role,
            userData: userDataScript,
            blockDevices: [
                {
                    deviceName: '/dev/sda1',
                    volume: ec2.BlockDeviceVolume.ebs(30, {
                        volumeType: ec2.EbsDeviceVolumeType.GP3,
                        deleteOnTermination: true,
                    }),
                },
            ],
        });
        // Elastic IP for EC2
        const eip = new ec2.CfnEIP(this, 'TreffEC2EIP', {
            instanceId: ec2Instance.instanceId,
        });
        // ========================================
        // S3 Bucket for Frontend (use existing or create new)
        // ========================================
        const frontendBucket = props.frontendBucketName
            ? s3.Bucket.fromBucketName(this, 'TreffFrontendBucket', props.frontendBucketName)
            : new s3.Bucket(this, 'TreffFrontendBucket', {
                bucketName: `treff-frontend-${this.account}`,
                websiteIndexDocument: 'index.html',
                websiteErrorDocument: 'index.html',
                publicReadAccess: false,
                blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
                removalPolicy: cdk.RemovalPolicy.RETAIN,
                autoDeleteObjects: false,
                encryption: s3.BucketEncryption.S3_MANAGED,
            });
        // Origin Access Identity for CloudFront
        const oai = new cloudfront.OriginAccessIdentity(this, 'TreffOAI', {
            comment: 'OAI for Treff frontend',
        });
        // Grant CloudFront read access to the frontend bucket
        // For manually created buckets, we need to add the policy statement directly
        if (props.frontendBucketName) {
            // Imported bucket - add policy manually
            const bucketPolicy = new s3.CfnBucketPolicy(this, 'FrontendBucketPolicy', {
                bucket: props.frontendBucketName,
                policyDocument: {
                    Statement: [
                        {
                            Effect: 'Allow',
                            Principal: {
                                CanonicalUser: oai.cloudFrontOriginAccessIdentityS3CanonicalUserId,
                            },
                            Action: 's3:GetObject',
                            Resource: `arn:aws:s3:::${props.frontendBucketName}/*`,
                        },
                    ],
                },
            });
        }
        else if (frontendBucket instanceof s3.Bucket) {
            // CDK-created bucket - use grantRead helper
            frontendBucket.grantRead(oai);
        }
        // CloudFront Distribution
        const distribution = new cloudfront.Distribution(this, 'TreffDistribution', {
            defaultBehavior: {
                origin: new origins.S3Origin(frontendBucket, {
                    originAccessIdentity: oai,
                }),
                viewerProtocolPolicy: cloudfront.ViewerProtocolPolicy.REDIRECT_TO_HTTPS,
                cachePolicy: cloudfront.CachePolicy.CACHING_OPTIMIZED,
            },
            additionalBehaviors: {
                '/api/*': {
                    origin: new origins.HttpOrigin(ec2Instance.instancePublicDnsName, {
                        protocolPolicy: cloudfront.OriginProtocolPolicy.HTTP_ONLY,
                        httpPort: 80,
                    }),
                    viewerProtocolPolicy: cloudfront.ViewerProtocolPolicy.REDIRECT_TO_HTTPS,
                    cachePolicy: cloudfront.CachePolicy.CACHING_DISABLED,
                    allowedMethods: cloudfront.AllowedMethods.ALLOW_ALL,
                    originRequestPolicy: cloudfront.OriginRequestPolicy.ALL_VIEWER,
                },
            },
            defaultRootObject: 'index.html',
            errorResponses: [
                {
                    httpStatus: 403,
                    responseHttpStatus: 200,
                    responsePagePath: '/index.html',
                    ttl: cdk.Duration.minutes(5),
                },
                {
                    httpStatus: 404,
                    responseHttpStatus: 200,
                    responsePagePath: '/index.html',
                    ttl: cdk.Duration.minutes(5),
                },
            ],
            priceClass: cloudfront.PriceClass.PRICE_CLASS_100, // Cheapest option
        });
        // ========================================
        // Outputs
        // ========================================
        new cdk.CfnOutput(this, 'EC2PublicIP', {
            value: eip.ref,
            description: 'EC2 Instance Public IP',
        });
        new cdk.CfnOutput(this, 'EC2InstanceId', {
            value: ec2Instance.instanceId,
            description: 'EC2 Instance ID',
        });
        new cdk.CfnOutput(this, 'BackendURL', {
            value: `https://${distribution.distributionDomainName}/`,
            description: 'Backend API URL (via CloudFront)',
        });
        new cdk.CfnOutput(this, 'BackendDirectURL', {
            value: `http://${eip.ref}/`,
            description: 'Backend Direct URL (HTTP only - use CloudFront URL instead)',
        });
        new cdk.CfnOutput(this, 'FrontendBucket', {
            value: frontendBucket.bucketName,
            description: 'S3 Bucket for Frontend',
        });
        new cdk.CfnOutput(this, 'CloudFrontURL', {
            value: `https://${distribution.distributionDomainName}`,
            description: 'CloudFront Distribution URL',
        });
        new cdk.CfnOutput(this, 'CloudFrontDistributionId', {
            value: distribution.distributionId,
            description: 'CloudFront Distribution ID',
        });
        new cdk.CfnOutput(this, 'MySQLConnectionString', {
            value: `Server=${eip.ref};Database=${props.mysqlDatabase};Uid=${props.mysqlUser};Pwd=${props.mysqlPassword};`,
            description: 'MySQL Connection String',
        });
        new cdk.CfnOutput(this, 'SSHCommand', {
            value: `ssh -i your-key.pem ubuntu@${eip.ref}`,
            description: 'SSH Command (you need to add a key pair)',
        });
    }
}
exports.TreffInfrastructureStack = TreffInfrastructureStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZmYtaW5mcmFzdHJ1Y3R1cmUtc3RhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0cmVmZi1pbmZyYXN0cnVjdHVyZS1zdGFjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBbUM7QUFDbkMseURBQTJDO0FBQzNDLHVEQUF5QztBQUN6Qyx1RUFBeUQ7QUFDekQsNEVBQThEO0FBQzlELHlEQUEyQztBQW9CM0MsTUFBYSx3QkFBeUIsU0FBUSxHQUFHLENBQUMsS0FBSztJQUNyRCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQW9DO1FBQzVFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRXhCLDJDQUEyQztRQUMzQyxxQkFBcUI7UUFDckIsMkNBQTJDO1FBQzNDLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFO1lBQ3hDLE1BQU0sRUFBRSxDQUFDO1lBQ1QsV0FBVyxFQUFFLENBQUMsRUFBRSxzQ0FBc0M7WUFDdEQsbUJBQW1CLEVBQUU7Z0JBQ25CO29CQUNFLFFBQVEsRUFBRSxFQUFFO29CQUNaLElBQUksRUFBRSxRQUFRO29CQUNkLFVBQVUsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLE1BQU07aUJBQ2xDO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCx5QkFBeUI7UUFDekIsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLHVCQUF1QixFQUFFO1lBQzVFLEdBQUc7WUFDSCxXQUFXLEVBQUUsdUNBQXVDO1lBQ3BELGdCQUFnQixFQUFFLElBQUk7U0FDdkIsQ0FBQyxDQUFDO1FBRUgsaUNBQWlDO1FBQ2pDLGdCQUFnQixDQUFDLGNBQWMsQ0FDN0IsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFDbEIs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QUFDO1FBRUgsSUFBSSxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSwwQkFBMEIsRUFBRTtZQUNsRCxLQUFLLEVBQUUsWUFBWSxDQUFDLGNBQWM7WUFDbEMsV0FBVyxFQUFFLDRCQUE0QjtTQUMxQyxDQUFDLENBQUM7UUFFSCxJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLHVCQUF1QixFQUFFO1lBQy9DLEtBQUssRUFBRSxVQUFVLEdBQUcsQ0FBQyxHQUFHLGFBQWEsS0FBSyxDQUFDLGFBQWEsUUFBUSxLQUFLLENBQUMsU0FBUyxRQUFRLEtBQUssQ0FBQyxhQUFhLEdBQUc7WUFDN0csV0FBVyxFQUFFLHlCQUF5QjtTQUN2QyxDQUFDLENBQUM7UUFFSCxJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRTtZQUNwQyxLQUFLLEVBQUUsOEJBQThCLEdBQUcsQ0FBQyxHQUFHLEVBQUU7WUFDOUMsV0FBVyxFQUFFLDBDQUEwQztTQUN4RCxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUE3WUQsNERBNllDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGVjMiBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZWMyJztcbmltcG9ydCAqIGFzIHMzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zMyc7XG5pbXBvcnQgKiBhcyBjbG91ZGZyb250IGZyb20gJ2F3cy1jZGstbGliL2F3cy1jbG91ZGZyb250JztcbmltcG9ydCAqIGFzIG9yaWdpbnMgZnJvbSAnYXdzLWNkay1saWIvYXdzLWNsb3VkZnJvbnQtb3JpZ2lucyc7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBzM2RlcGxveSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtczMtZGVwbG95bWVudCc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJlZmZJbmZyYXN0cnVjdHVyZVN0YWNrUHJvcHMgZXh0ZW5kcyBjZGsuU3RhY2tQcm9wcyB7XG4gIGluc3RhbmNlVHlwZTogc3RyaW5nO1xuICBteXNxbFJvb3RQYXNzd29yZDogc3RyaW5nO1xuICBteXNxbERhdGFiYXNlOiBzdHJpbmc7XG4gIG15c3FsVXNlcjogc3RyaW5nO1xuICBteXNxbFBhc3N3b3JkOiBzdHJpbmc7XG4gIGRvbWFpbk5hbWU/OiBzdHJpbmc7XG4gIGZyb250ZW5kQnVja2V0TmFtZT86IHN0cmluZztcbiAgYXNzZXRzQnVja2V0TmFtZT86IHN0cmluZztcbiAgdHdpbGlvQWNjb3VudFNpZD86IHN0cmluZztcbiAgdHdpbGlvQXV0aFRva2VuPzogc3RyaW5nO1xuICB0d2lsaW9QaG9uZT86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIFRyZWZmSW5mcmFzdHJ1Y3R1cmVTdGFjayBleHRlbmRzIGNkay5TdGFjayB7XG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBUcmVmZkluZnJhc3RydWN0dXJlU3RhY2tQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIFZQQyBhbmQgTmV0d29ya2luZ1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyh0aGlzLCAnVHJlZmZWUEMnLCB7XG4gICAgICBtYXhBenM6IDIsXG4gICAgICBuYXRHYXRld2F5czogMCwgLy8gU2F2ZSBjb3N0cyAtIHVzZSBwdWJsaWMgc3VibmV0IG9ubHlcbiAgICAgIHN1Ym5ldENvbmZpZ3VyYXRpb246IFtcbiAgICAgICAge1xuICAgICAgICAgIGNpZHJNYXNrOiAyNCxcbiAgICAgICAgICBuYW1lOiAnUHVibGljJyxcbiAgICAgICAgICBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QVUJMSUMsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgLy8gU2VjdXJpdHkgR3JvdXAgZm9yIEVDMlxuICAgIGNvbnN0IGVjMlNlY3VyaXR5R3JvdXAgPSBuZXcgZWMyLlNlY3VyaXR5R3JvdXAodGhpcywgJ1RyZWZmRUMyU2VjdXJpdHlHcm91cCcsIHtcbiAgICAgIHZwYyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnU2VjdXJpdHkgZ3JvdXAgZm9yIFRyZWZmIEVDMiBpbnN0YW5jZScsXG4gICAgICBhbGxvd0FsbE91dGJvdW5kOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgLy8gQWxsb3cgSFRUUC9IVFRQUyBmcm9tIGFueXdoZXJlXG4gICAgZWMyU2VjdXJpdHlHcm91cC5hZGRJbmdyZXNzUnVsZShcbiAgICAgIGVjMi5QZWVyLmFueUlwdjQoKSxcbiAgICAgIGVjMi5Qb3J0LnRjcCg4MCksXG4gICAgICAnQWxsb3cgSFRUUCB0cmFmZmljJ1xuICAgICk7XG4gICAgZWMyU2VjdXJpdHlHcm91cC5hZGRJbmdyZXNzUnVsZShcbiAgICAgIGVjMi5QZWVyLmFueUlwdjQoKSxcbiAgICAgIGVjMi5Qb3J0LnRjcCg0NDMpLFxuICAgICAgJ0FsbG93IEhUVFBTIHRyYWZmaWMnXG4gICAgKTtcblxuICAgIC8vIEFsbG93IFNTSCAob3B0aW9uYWwgLSBmb3IgZGVidWdnaW5nKVxuICAgIGVjMlNlY3VyaXR5R3JvdXAuYWRkSW5ncmVzc1J1bGUoXG4gICAgICBlYzIuUGVlci5hbnlJcHY0KCksXG4gICAgICBlYzIuUG9ydC50Y3AoMjIpLFxuICAgICAgJ0FsbG93IFNTSCBhY2Nlc3MnXG4gICAgKTtcblxuICAgIC8vIEFsbG93IE15U1FMIHBvcnQgKGZvciBleHRlcm5hbCBhY2Nlc3MgaWYgbmVlZGVkKVxuICAgIGVjMlNlY3VyaXR5R3JvdXAuYWRkSW5ncmVzc1J1bGUoXG4gICAgICBlYzIuUGVlci5hbnlJcHY0KCksXG4gICAgICBlYzIuUG9ydC50Y3AoMzMwNiksXG4gICAgICAnQWxsb3cgTXlTUUwgYWNjZXNzIChvcHRpb25hbCAtIGNhbiBiZSByZW1vdmVkIGZvciBwcm9kdWN0aW9uKSdcbiAgICApO1xuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIEVDMiBJbnN0YW5jZSBmb3IgQmFja2VuZCArIE15U1FMXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIFxuICAgIC8vIElBTSBSb2xlIGZvciBFQzJcbiAgICBjb25zdCBlYzJSb2xlID0gbmV3IGlhbS5Sb2xlKHRoaXMsICdUcmVmZkVDMlJvbGUnLCB7XG4gICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnZWMyLmFtYXpvbmF3cy5jb20nKSxcbiAgICAgIG1hbmFnZWRQb2xpY2llczogW1xuICAgICAgICBpYW0uTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoJ0FtYXpvblNTTU1hbmFnZWRJbnN0YW5jZUNvcmUnKSxcbiAgICAgICAgaWFtLk1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCdDbG91ZFdhdGNoQWdlbnRTZXJ2ZXJQb2xpY3knKSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICAvLyBHcmFudCBTMyBhY2Nlc3MgZm9yIGRlcGxveW1lbnRzIChpZiBkZXBsb3ltZW50IGJ1Y2tldCBleGlzdHMpXG4gICAgaWYgKHByb3BzLmFzc2V0c0J1Y2tldE5hbWUpIHtcbiAgICAgIGNvbnN0IGRlcGxveW1lbnRCdWNrZXQgPSBzMy5CdWNrZXQuZnJvbUJ1Y2tldE5hbWUodGhpcywgJ0RlcGxveW1lbnRCdWNrZXQnLCAndHJlZmYtZGVwbG95bWVudHMtcHJvZCcpO1xuICAgICAgZGVwbG95bWVudEJ1Y2tldC5ncmFudFJlYWQoZWMyUm9sZSk7XG4gICAgfVxuXG4gICAgLy8gVXNlciBkYXRhIHNjcmlwdFxuICAgIGNvbnN0IHVzZXJEYXRhU2NyaXB0ID0gZWMyLlVzZXJEYXRhLmZvckxpbnV4KCk7XG4gICAgdXNlckRhdGFTY3JpcHQuYWRkQ29tbWFuZHMoXG4gICAgICAnIyEvYmluL2Jhc2gnLFxuICAgICAgJ3NldCAtZScsXG4gICAgICAnJyxcbiAgICAgICcjIFVwZGF0ZSBzeXN0ZW0nLFxuICAgICAgJ2FwdC1nZXQgdXBkYXRlIC15JyxcbiAgICAgICdhcHQtZ2V0IHVwZ3JhZGUgLXknLFxuICAgICAgJycsXG4gICAgICAnIyBJbnN0YWxsIGRlcGVuZGVuY2llcycsXG4gICAgICAnYXB0LWdldCBpbnN0YWxsIC15IHdnZXQgY3VybCBnaXQgbmdpbnggbXlzcWwtc2VydmVyIG15c3FsLWNsaWVudCB1bnppcCBhd3NjbGknLFxuICAgICAgJycsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICcjIE15U1FMIFNldHVwJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJ3N5c3RlbWN0bCBzdGFydCBteXNxbCcsXG4gICAgICAnc3lzdGVtY3RsIGVuYWJsZSBteXNxbCcsXG4gICAgICAnJyxcbiAgICAgIGAjIFNldCBNeVNRTCByb290IHBhc3N3b3JkYCxcbiAgICAgIGBteXNxbCAtZSBcIkFMVEVSIFVTRVIgJ3Jvb3QnQCdsb2NhbGhvc3QnIElERU5USUZJRUQgV0lUSCBteXNxbF9uYXRpdmVfcGFzc3dvcmQgQlkgJyR7cHJvcHMubXlzcWxSb290UGFzc3dvcmR9JztcImAsXG4gICAgICBgbXlzcWwgLWUgXCJGTFVTSCBQUklWSUxFR0VTO1wiYCxcbiAgICAgICcnLFxuICAgICAgYCMgQ3JlYXRlIGRhdGFiYXNlIGFuZCB1c2VyYCxcbiAgICAgIGBteXNxbCAtdXJvb3QgLXAnJHtwcm9wcy5teXNxbFJvb3RQYXNzd29yZH0nIC1lIFwiQ1JFQVRFIERBVEFCQVNFIElGIE5PVCBFWElTVFMgJHtwcm9wcy5teXNxbERhdGFiYXNlfTtcImAsXG4gICAgICBgbXlzcWwgLXVyb290IC1wJyR7cHJvcHMubXlzcWxSb290UGFzc3dvcmR9JyAtZSBcIkNSRUFURSBVU0VSIElGIE5PVCBFWElTVFMgJyR7cHJvcHMubXlzcWxVc2VyfSdAJ2xvY2FsaG9zdCcgSURFTlRJRklFRCBCWSAnJHtwcm9wcy5teXNxbFBhc3N3b3JkfSc7XCJgLFxuICAgICAgYG15c3FsIC11cm9vdCAtcCcke3Byb3BzLm15c3FsUm9vdFBhc3N3b3JkfScgLWUgXCJHUkFOVCBBTEwgUFJJVklMRUdFUyBPTiAke3Byb3BzLm15c3FsRGF0YWJhc2V9LiogVE8gJyR7cHJvcHMubXlzcWxVc2VyfSdAJ2xvY2FsaG9zdCc7XCJgLFxuICAgICAgYG15c3FsIC11cm9vdCAtcCcke3Byb3BzLm15c3FsUm9vdFBhc3N3b3JkfScgLWUgXCJGTFVTSCBQUklWSUxFR0VTO1wiYCxcbiAgICAgICcnLFxuICAgICAgJyMgQ29uZmlndXJlIE15U1FMIHRvIGxpc3RlbiBvbiBhbGwgaW50ZXJmYWNlcyAob3B0aW9uYWwpJyxcbiAgICAgIGBzZWQgLWkgJ3MvYmluZC1hZGRyZXNzLiovYmluZC1hZGRyZXNzID0gMC4wLjAuMC8nIC9ldGMvbXlzcWwvbXlzcWwuY29uZi5kL215c3FsZC5jbmZgLFxuICAgICAgJ3N5c3RlbWN0bCByZXN0YXJ0IG15c3FsJyxcbiAgICAgICcnLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnIyAuTkVUIDggUnVudGltZSBJbnN0YWxsYXRpb24nLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnd2dldCBodHRwczovL2RvdC5uZXQvdjEvZG90bmV0LWluc3RhbGwuc2ggLU8gZG90bmV0LWluc3RhbGwuc2gnLFxuICAgICAgJ2NobW9kICt4IGRvdG5ldC1pbnN0YWxsLnNoJyxcbiAgICAgICcuL2RvdG5ldC1pbnN0YWxsLnNoIC0tY2hhbm5lbCA4LjAgLS1ydW50aW1lIGFzcG5ldGNvcmUnLFxuICAgICAgJy4vZG90bmV0LWluc3RhbGwuc2ggLS1jaGFubmVsIDguMCAtLXJ1bnRpbWUgZG90bmV0JyxcbiAgICAgICcnLFxuICAgICAgJyMgQWRkIC5ORVQgdG8gUEFUSCcsXG4gICAgICAnZWNobyBcImV4cG9ydCBET1RORVRfUk9PVD0kSE9NRS8uZG90bmV0XCIgPj4gL3Jvb3QvLmJhc2hyYycsXG4gICAgICAnZWNobyBcImV4cG9ydCBQQVRIPSRQQVRIOiRET1RORVRfUk9PVDokRE9UTkVUX1JPT1QvdG9vbHNcIiA+PiAvcm9vdC8uYmFzaHJjJyxcbiAgICAgICdleHBvcnQgRE9UTkVUX1JPT1Q9JEhPTUUvLmRvdG5ldCcsXG4gICAgICAnZXhwb3J0IFBBVEg9JFBBVEg6JERPVE5FVF9ST09UOiRET1RORVRfUk9PVC90b29scycsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgQXBwbGljYXRpb24gU2V0dXAgRGlyZWN0b3J5JyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJ21rZGlyIC1wIC92YXIvd3d3L3RyZWZmLWJhY2tlbmQnLFxuICAgICAgJ2Nob3duIC1SIHd3dy1kYXRhOnd3dy1kYXRhIC92YXIvd3d3L3RyZWZmLWJhY2tlbmQnLFxuICAgICAgJycsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICcjIE5naW54IENvbmZpZ3VyYXRpb24nLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnY2F0ID4gL2V0Yy9uZ2lueC9zaXRlcy1hdmFpbGFibGUvdHJlZmYgPDxFT0YnLFxuICAgICAgJ3NlcnZlciB7JyxcbiAgICAgICcgICAgbGlzdGVuIDgwOycsXG4gICAgICAnICAgIHNlcnZlcl9uYW1lIF87JyxcbiAgICAgICcnLFxuICAgICAgJyAgICBsb2NhdGlvbiAvIHsnLFxuICAgICAgJyAgICAgICAgcHJveHlfcGFzcyBodHRwOi8vMTI3LjAuMC4xOjUwMDA7JyxcbiAgICAgICcgICAgICAgIHByb3h5X2h0dHBfdmVyc2lvbiAxLjE7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgVXBncmFkZSBcXFxcJGh0dHBfdXBncmFkZTsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBDb25uZWN0aW9uIFwidXBncmFkZVwiOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIEhvc3QgXFxcXCRob3N0OycsXG4gICAgICAnICAgICAgICBwcm94eV9jYWNoZV9ieXBhc3MgXFxcXCRodHRwX3VwZ3JhZGU7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgWC1Gb3J3YXJkZWQtRm9yIFxcXFwkcHJveHlfYWRkX3hfZm9yd2FyZGVkX2ZvcjsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Qcm90byBcXFxcJHNjaGVtZTsnLFxuICAgICAgJyAgICB9JyxcbiAgICAgICcnLFxuICAgICAgJyAgICAjIFNpZ25hbFIgV2ViU29ja2V0IHN1cHBvcnQnLFxuICAgICAgJyAgICBsb2NhdGlvbiAvaHVicy8geycsXG4gICAgICAnICAgICAgICBwcm94eV9wYXNzIGh0dHA6Ly8xMjcuMC4wLjE6NTAwMDsnLFxuICAgICAgJyAgICAgICAgcHJveHlfaHR0cF92ZXJzaW9uIDEuMTsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBVcGdyYWRlIFxcXFwkaHR0cF91cGdyYWRlOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIENvbm5lY3Rpb24gXCJ1cGdyYWRlXCI7JyxcbiAgICAgICcgICAgICAgIHByb3h5X3NldF9oZWFkZXIgSG9zdCBcXFxcJGhvc3Q7JyxcbiAgICAgICcgICAgICAgIHByb3h5X2NhY2hlX2J5cGFzcyBcXFxcJGh0dHBfdXBncmFkZTsnLFxuICAgICAgJyAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Gb3IgXFxcXCRwcm94eV9hZGRfeF9mb3J3YXJkZWRfZm9yOycsXG4gICAgICAnICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLVByb3RvIFxcXFwkc2NoZW1lOycsXG4gICAgICAnICAgIH0nLFxuICAgICAgJ30nLFxuICAgICAgJ0VPRicsXG4gICAgICAnJyxcbiAgICAgICdsbiAtc2YgL2V0Yy9uZ2lueC9zaXRlcy1hdmFpbGFibGUvdHJlZmYgL2V0Yy9uZ2lueC9zaXRlcy1lbmFibGVkLycsXG4gICAgICAncm0gLWYgL2V0Yy9uZ2lueC9zaXRlcy1lbmFibGVkL2RlZmF1bHQnLFxuICAgICAgJ25naW54IC10JyxcbiAgICAgICdzeXN0ZW1jdGwgcmVzdGFydCBuZ2lueCcsXG4gICAgICAnc3lzdGVtY3RsIGVuYWJsZSBuZ2lueCcsXG4gICAgICAnJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJyMgQ3JlYXRlIHN5c3RlbWQgc2VydmljZSBmb3IgLk5FVCBhcHAnLFxuICAgICAgJyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsXG4gICAgICAnY2F0ID4gL2V0Yy9zeXN0ZW1kL3N5c3RlbS90cmVmZi1iYWNrZW5kLnNlcnZpY2UgPDxFT0YnLFxuICAgICAgJ1tVbml0XScsXG4gICAgICAnRGVzY3JpcHRpb249VHJlZmYgLk5FVCBCYWNrZW5kJyxcbiAgICAgICdBZnRlcj1uZXR3b3JrLnRhcmdldCBteXNxbC5zZXJ2aWNlJyxcbiAgICAgICcnLFxuICAgICAgJ1tTZXJ2aWNlXScsXG4gICAgICAnVHlwZT1ub3RpZnknLFxuICAgICAgJ1dvcmtpbmdEaXJlY3Rvcnk9L3Zhci93d3cvdHJlZmYtYmFja2VuZCcsXG4gICAgICAnRXhlY1N0YXJ0PS9yb290Ly5kb3RuZXQvZG90bmV0IC92YXIvd3d3L3RyZWZmLWJhY2tlbmQvV2ViQXBpLmRsbCcsXG4gICAgICAnUmVzdGFydD1hbHdheXMnLFxuICAgICAgJ1Jlc3RhcnRTZWM9MTAnLFxuICAgICAgJ0tpbGxTaWduYWw9U0lHSU5UJyxcbiAgICAgICdTeXNsb2dJZGVudGlmaWVyPXRyZWZmLWJhY2tlbmQnLFxuICAgICAgJ1VzZXI9d3d3LWRhdGEnLFxuICAgICAgJ0Vudmlyb25tZW50PUFTUE5FVENPUkVfRU5WSVJPTk1FTlQ9UHJvZHVjdGlvbicsXG4gICAgICAnRW52aXJvbm1lbnQ9RE9UTkVUX1JPT1Q9L3Jvb3QvLmRvdG5ldCcsXG4gICAgICAnRW52aXJvbm1lbnQ9UEFUSD0vdXNyL2xvY2FsL3NiaW46L3Vzci9sb2NhbC9iaW46L3Vzci9zYmluOi91c3IvYmluOi9zYmluOi9iaW46L3Jvb3QvLmRvdG5ldDovcm9vdC8uZG90bmV0L3Rvb2xzJyxcbiAgICAgIC4uLihwcm9wcy50d2lsaW9BY2NvdW50U2lkID8gW2BFbnZpcm9ubWVudD1Ud2lsaW9Db25maWdfX0FjY291bnRTaWQ9JHtwcm9wcy50d2lsaW9BY2NvdW50U2lkfWBdIDogW10pLFxuICAgICAgLi4uKHByb3BzLnR3aWxpb0F1dGhUb2tlbiA/IFtgRW52aXJvbm1lbnQ9VHdpbGlvQ29uZmlnX19BdXRoVG9rZW49JHtwcm9wcy50d2lsaW9BdXRoVG9rZW59YF0gOiBbXSksXG4gICAgICAuLi4ocHJvcHMudHdpbGlvUGhvbmUgPyBbYEVudmlyb25tZW50PVR3aWxpb0NvbmZpZ19fUGhvbmU9JHtwcm9wcy50d2lsaW9QaG9uZX1gXSA6IFtdKSxcbiAgICAgICcnLFxuICAgICAgJ1tJbnN0YWxsXScsXG4gICAgICAnV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQnLFxuICAgICAgJ0VPRicsXG4gICAgICAnJyxcbiAgICAgICdzeXN0ZW1jdGwgZGFlbW9uLXJlbG9hZCcsXG4gICAgICAnIyBOb3RlOiBTZXJ2aWNlIHdpbGwgZmFpbCB1bnRpbCB5b3UgZGVwbG95IHRoZSBhcHBsaWNhdGlvbicsXG4gICAgICAnIyBzeXN0ZW1jdGwgZW5hYmxlIHRyZWZmLWJhY2tlbmQnLFxuICAgICAgJycsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICcjIENyZWF0ZSBkZXBsb3ltZW50IHNjcmlwdCcsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICdjYXQgPiAvcm9vdC9kZXBsb3ktYmFja2VuZC5zaCA8PEVPRicsXG4gICAgICAnIyEvYmluL2Jhc2gnLFxuICAgICAgJ2VjaG8gXCJTdG9wcGluZyBiYWNrZW5kIHNlcnZpY2UuLi5cIicsXG4gICAgICAnc3lzdGVtY3RsIHN0b3AgdHJlZmYtYmFja2VuZCcsXG4gICAgICAnJyxcbiAgICAgICdlY2hvIFwiRGVwbG95aW5nIG5ldyB2ZXJzaW9uLi4uXCInLFxuICAgICAgJyMgWW91ciBkZXBsb3ltZW50IGNvbW1hbmRzIGhlcmUnLFxuICAgICAgJyMgRXhhbXBsZTogY29weSBmaWxlcywgcnVuIG1pZ3JhdGlvbnMsIGV0Yy4nLFxuICAgICAgJycsXG4gICAgICAnZWNobyBcIlN0YXJ0aW5nIGJhY2tlbmQgc2VydmljZS4uLlwiJyxcbiAgICAgICdzeXN0ZW1jdGwgc3RhcnQgdHJlZmYtYmFja2VuZCcsXG4gICAgICAnc3lzdGVtY3RsIHN0YXR1cyB0cmVmZi1iYWNrZW5kJyxcbiAgICAgICdFT0YnLFxuICAgICAgJycsXG4gICAgICAnY2htb2QgK3ggL3Jvb3QvZGVwbG95LWJhY2tlbmQuc2gnLFxuICAgICAgJycsXG4gICAgICAnIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JyxcbiAgICAgICcjIEluc3RhbGwgQ2xvdWRXYXRjaCBhZ2VudCAob3B0aW9uYWwpJyxcbiAgICAgICcjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLFxuICAgICAgJ3dnZXQgaHR0cHM6Ly9zMy5hbWF6b25hd3MuY29tL2FtYXpvbmNsb3Vkd2F0Y2gtYWdlbnQvdWJ1bnR1L2FybTY0L2xhdGVzdC9hbWF6b24tY2xvdWR3YXRjaC1hZ2VudC5kZWInLFxuICAgICAgJ2Rwa2cgLWkgLUUgLi9hbWF6b24tY2xvdWR3YXRjaC1hZ2VudC5kZWInLFxuICAgICAgJycsXG4gICAgICAnZWNobyBcIkVDMiBzZXR1cCBjb21wbGV0ZSFcIicsXG4gICAgICAnZWNobyBcIk15U1FMIHJvb3QgcGFzc3dvcmQ6ICR7cHJvcHMubXlzcWxSb290UGFzc3dvcmR9XCInLFxuICAgICAgJ2VjaG8gXCJNeVNRTCBkYXRhYmFzZTogJHtwcm9wcy5teXNxbERhdGFiYXNlfVwiJyxcbiAgICAgICdlY2hvIFwiTXlTUUwgdXNlcjogJHtwcm9wcy5teXNxbFVzZXJ9XCInLFxuICAgICAgJ2VjaG8gXCJNeVNRTCBwYXNzd29yZDogJHtwcm9wcy5teXNxbFBhc3N3b3JkfVwiJyxcbiAgICAgICdlY2hvIFwiXCInLFxuICAgICAgJ2VjaG8gXCJOZXh0IHN0ZXBzOlwiJyxcbiAgICAgICdlY2hvIFwiMS4gRGVwbG95IHlvdXIgLk5FVCBhcHBsaWNhdGlvbiB0byAvdmFyL3d3dy90cmVmZi1iYWNrZW5kL1wiJyxcbiAgICAgICdlY2hvIFwiMi4gVXBkYXRlIGNvbm5lY3Rpb24gc3RyaW5nIGluIGFwcHNldHRpbmdzLlByb2R1Y3Rpb24uanNvblwiJyxcbiAgICAgICdlY2hvIFwiMy4gUnVuOiBzeXN0ZW1jdGwgZW5hYmxlIHRyZWZmLWJhY2tlbmRcIicsXG4gICAgICAnZWNobyBcIjQuIFJ1bjogc3lzdGVtY3RsIHN0YXJ0IHRyZWZmLWJhY2tlbmRcIicsXG4gICAgKTtcblxuICAgIC8vIEVDMiBJbnN0YW5jZVxuICAgIGNvbnN0IGVjMkluc3RhbmNlID0gbmV3IGVjMi5JbnN0YW5jZSh0aGlzLCAnVHJlZmZFQzJJbnN0YW5jZScsIHtcbiAgICAgIHZwYyxcbiAgICAgIHZwY1N1Ym5ldHM6IHtcbiAgICAgICAgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFVCTElDLFxuICAgICAgfSxcbiAgICAgIGluc3RhbmNlVHlwZTogbmV3IGVjMi5JbnN0YW5jZVR5cGUocHJvcHMuaW5zdGFuY2VUeXBlKSxcbiAgICAgIG1hY2hpbmVJbWFnZTogZWMyLk1hY2hpbmVJbWFnZS5mcm9tU3NtUGFyYW1ldGVyKFxuICAgICAgICAnL2F3cy9zZXJ2aWNlL2Nhbm9uaWNhbC91YnVudHUvc2VydmVyLzIyLjA0L3N0YWJsZS9jdXJyZW50L2FybTY0L2h2bS9lYnMtZ3AyL2FtaS1pZCcsXG4gICAgICAgIHtcbiAgICAgICAgICBvczogZWMyLk9wZXJhdGluZ1N5c3RlbVR5cGUuTElOVVgsXG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICBzZWN1cml0eUdyb3VwOiBlYzJTZWN1cml0eUdyb3VwLFxuICAgICAgcm9sZTogZWMyUm9sZSxcbiAgICAgIHVzZXJEYXRhOiB1c2VyRGF0YVNjcmlwdCxcbiAgICAgIGJsb2NrRGV2aWNlczogW1xuICAgICAgICB7XG4gICAgICAgICAgZGV2aWNlTmFtZTogJy9kZXYvc2RhMScsXG4gICAgICAgICAgdm9sdW1lOiBlYzIuQmxvY2tEZXZpY2VWb2x1bWUuZWJzKDMwLCB7XG4gICAgICAgICAgICB2b2x1bWVUeXBlOiBlYzIuRWJzRGV2aWNlVm9sdW1lVHlwZS5HUDMsXG4gICAgICAgICAgICBkZWxldGVPblRlcm1pbmF0aW9uOiB0cnVlLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIC8vIEVsYXN0aWMgSVAgZm9yIEVDMlxuICAgIGNvbnN0IGVpcCA9IG5ldyBlYzIuQ2ZuRUlQKHRoaXMsICdUcmVmZkVDMkVJUCcsIHtcbiAgICAgIGluc3RhbmNlSWQ6IGVjMkluc3RhbmNlLmluc3RhbmNlSWQsXG4gICAgfSk7XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gUzMgQnVja2V0IGZvciBGcm9udGVuZCAodXNlIGV4aXN0aW5nIG9yIGNyZWF0ZSBuZXcpXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIGNvbnN0IGZyb250ZW5kQnVja2V0ID0gcHJvcHMuZnJvbnRlbmRCdWNrZXROYW1lXG4gICAgICA/IHMzLkJ1Y2tldC5mcm9tQnVja2V0TmFtZSh0aGlzLCAnVHJlZmZGcm9udGVuZEJ1Y2tldCcsIHByb3BzLmZyb250ZW5kQnVja2V0TmFtZSlcbiAgICAgIDogbmV3IHMzLkJ1Y2tldCh0aGlzLCAnVHJlZmZGcm9udGVuZEJ1Y2tldCcsIHtcbiAgICAgICAgICBidWNrZXROYW1lOiBgdHJlZmYtZnJvbnRlbmQtJHt0aGlzLmFjY291bnR9YCxcbiAgICAgICAgICB3ZWJzaXRlSW5kZXhEb2N1bWVudDogJ2luZGV4Lmh0bWwnLFxuICAgICAgICAgIHdlYnNpdGVFcnJvckRvY3VtZW50OiAnaW5kZXguaHRtbCcsXG4gICAgICAgICAgcHVibGljUmVhZEFjY2VzczogZmFsc2UsXG4gICAgICAgICAgYmxvY2tQdWJsaWNBY2Nlc3M6IHMzLkJsb2NrUHVibGljQWNjZXNzLkJMT0NLX0FMTCxcbiAgICAgICAgICByZW1vdmFsUG9saWN5OiBjZGsuUmVtb3ZhbFBvbGljeS5SRVRBSU4sXG4gICAgICAgICAgYXV0b0RlbGV0ZU9iamVjdHM6IGZhbHNlLFxuICAgICAgICAgIGVuY3J5cHRpb246IHMzLkJ1Y2tldEVuY3J5cHRpb24uUzNfTUFOQUdFRCxcbiAgICAgICAgfSk7XG5cbiAgICAvLyBPcmlnaW4gQWNjZXNzIElkZW50aXR5IGZvciBDbG91ZEZyb250XG4gICAgY29uc3Qgb2FpID0gbmV3IGNsb3VkZnJvbnQuT3JpZ2luQWNjZXNzSWRlbnRpdHkodGhpcywgJ1RyZWZmT0FJJywge1xuICAgICAgY29tbWVudDogJ09BSSBmb3IgVHJlZmYgZnJvbnRlbmQnLFxuICAgIH0pO1xuXG4gICAgLy8gR3JhbnQgQ2xvdWRGcm9udCByZWFkIGFjY2VzcyB0byB0aGUgZnJvbnRlbmQgYnVja2V0XG4gICAgLy8gRm9yIG1hbnVhbGx5IGNyZWF0ZWQgYnVja2V0cywgd2UgbmVlZCB0byBhZGQgdGhlIHBvbGljeSBzdGF0ZW1lbnQgZGlyZWN0bHlcbiAgICBpZiAocHJvcHMuZnJvbnRlbmRCdWNrZXROYW1lKSB7XG4gICAgICAvLyBJbXBvcnRlZCBidWNrZXQgLSBhZGQgcG9saWN5IG1hbnVhbGx5XG4gICAgICBjb25zdCBidWNrZXRQb2xpY3kgPSBuZXcgczMuQ2ZuQnVja2V0UG9saWN5KHRoaXMsICdGcm9udGVuZEJ1Y2tldFBvbGljeScsIHtcbiAgICAgICAgYnVja2V0OiBwcm9wcy5mcm9udGVuZEJ1Y2tldE5hbWUsXG4gICAgICAgIHBvbGljeURvY3VtZW50OiB7XG4gICAgICAgICAgU3RhdGVtZW50OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgICAgUHJpbmNpcGFsOiB7XG4gICAgICAgICAgICAgICAgQ2Fub25pY2FsVXNlcjogb2FpLmNsb3VkRnJvbnRPcmlnaW5BY2Nlc3NJZGVudGl0eVMzQ2Fub25pY2FsVXNlcklkLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBBY3Rpb246ICdzMzpHZXRPYmplY3QnLFxuICAgICAgICAgICAgICBSZXNvdXJjZTogYGFybjphd3M6czM6Ojoke3Byb3BzLmZyb250ZW5kQnVja2V0TmFtZX0vKmAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGZyb250ZW5kQnVja2V0IGluc3RhbmNlb2YgczMuQnVja2V0KSB7XG4gICAgICAvLyBDREstY3JlYXRlZCBidWNrZXQgLSB1c2UgZ3JhbnRSZWFkIGhlbHBlclxuICAgICAgZnJvbnRlbmRCdWNrZXQuZ3JhbnRSZWFkKG9haSk7XG4gICAgfVxuXG4gICAgLy8gQ2xvdWRGcm9udCBEaXN0cmlidXRpb25cbiAgICBjb25zdCBkaXN0cmlidXRpb24gPSBuZXcgY2xvdWRmcm9udC5EaXN0cmlidXRpb24odGhpcywgJ1RyZWZmRGlzdHJpYnV0aW9uJywge1xuICAgICAgZGVmYXVsdEJlaGF2aW9yOiB7XG4gICAgICAgIG9yaWdpbjogbmV3IG9yaWdpbnMuUzNPcmlnaW4oZnJvbnRlbmRCdWNrZXQsIHtcbiAgICAgICAgICBvcmlnaW5BY2Nlc3NJZGVudGl0eTogb2FpLFxuICAgICAgICB9KSxcbiAgICAgICAgdmlld2VyUHJvdG9jb2xQb2xpY3k6IGNsb3VkZnJvbnQuVmlld2VyUHJvdG9jb2xQb2xpY3kuUkVESVJFQ1RfVE9fSFRUUFMsXG4gICAgICAgIGNhY2hlUG9saWN5OiBjbG91ZGZyb250LkNhY2hlUG9saWN5LkNBQ0hJTkdfT1BUSU1JWkVELFxuICAgICAgfSxcbiAgICAgIGFkZGl0aW9uYWxCZWhhdmlvcnM6IHtcbiAgICAgICAgJy9hcGkvKic6IHtcbiAgICAgICAgICBvcmlnaW46IG5ldyBvcmlnaW5zLkh0dHBPcmlnaW4oZWMySW5zdGFuY2UuaW5zdGFuY2VQdWJsaWNEbnNOYW1lLCB7XG4gICAgICAgICAgICBwcm90b2NvbFBvbGljeTogY2xvdWRmcm9udC5PcmlnaW5Qcm90b2NvbFBvbGljeS5IVFRQX09OTFksXG4gICAgICAgICAgICBodHRwUG9ydDogODAsXG4gICAgICAgICAgfSksXG4gICAgICAgICAgdmlld2VyUHJvdG9jb2xQb2xpY3k6IGNsb3VkZnJvbnQuVmlld2VyUHJvdG9jb2xQb2xpY3kuUkVESVJFQ1RfVE9fSFRUUFMsXG4gICAgICAgICAgY2FjaGVQb2xpY3k6IGNsb3VkZnJvbnQuQ2FjaGVQb2xpY3kuQ0FDSElOR19ESVNBQkxFRCxcbiAgICAgICAgICBhbGxvd2VkTWV0aG9kczogY2xvdWRmcm9udC5BbGxvd2VkTWV0aG9kcy5BTExPV19BTEwsXG4gICAgICAgICAgb3JpZ2luUmVxdWVzdFBvbGljeTogY2xvdWRmcm9udC5PcmlnaW5SZXF1ZXN0UG9saWN5LkFMTF9WSUVXRVIsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgZGVmYXVsdFJvb3RPYmplY3Q6ICdpbmRleC5odG1sJyxcbiAgICAgIGVycm9yUmVzcG9uc2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBodHRwU3RhdHVzOiA0MDMsXG4gICAgICAgICAgcmVzcG9uc2VIdHRwU3RhdHVzOiAyMDAsXG4gICAgICAgICAgcmVzcG9uc2VQYWdlUGF0aDogJy9pbmRleC5odG1sJyxcbiAgICAgICAgICB0dGw6IGNkay5EdXJhdGlvbi5taW51dGVzKDUpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaHR0cFN0YXR1czogNDA0LFxuICAgICAgICAgIHJlc3BvbnNlSHR0cFN0YXR1czogMjAwLFxuICAgICAgICAgIHJlc3BvbnNlUGFnZVBhdGg6ICcvaW5kZXguaHRtbCcsXG4gICAgICAgICAgdHRsOiBjZGsuRHVyYXRpb24ubWludXRlcyg1KSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBwcmljZUNsYXNzOiBjbG91ZGZyb250LlByaWNlQ2xhc3MuUFJJQ0VfQ0xBU1NfMTAwLCAvLyBDaGVhcGVzdCBvcHRpb25cbiAgICB9KTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBPdXRwdXRzXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdFQzJQdWJsaWNJUCcsIHtcbiAgICAgIHZhbHVlOiBlaXAucmVmLFxuICAgICAgZGVzY3JpcHRpb246ICdFQzIgSW5zdGFuY2UgUHVibGljIElQJyxcbiAgICB9KTtcblxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdFQzJJbnN0YW5jZUlkJywge1xuICAgICAgdmFsdWU6IGVjMkluc3RhbmNlLmluc3RhbmNlSWQsXG4gICAgICBkZXNjcmlwdGlvbjogJ0VDMiBJbnN0YW5jZSBJRCcsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnQmFja2VuZFVSTCcsIHtcbiAgICAgIHZhbHVlOiBgaHR0cHM6Ly8ke2Rpc3RyaWJ1dGlvbi5kaXN0cmlidXRpb25Eb21haW5OYW1lfS9gLFxuICAgICAgZGVzY3JpcHRpb246ICdCYWNrZW5kIEFQSSBVUkwgKHZpYSBDbG91ZEZyb250KScsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnQmFja2VuZERpcmVjdFVSTCcsIHtcbiAgICAgIHZhbHVlOiBgaHR0cDovLyR7ZWlwLnJlZn0vYCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQmFja2VuZCBEaXJlY3QgVVJMIChIVFRQIG9ubHkgLSB1c2UgQ2xvdWRGcm9udCBVUkwgaW5zdGVhZCknLFxuICAgIH0pO1xuXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0Zyb250ZW5kQnVja2V0Jywge1xuICAgICAgdmFsdWU6IGZyb250ZW5kQnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogJ1MzIEJ1Y2tldCBmb3IgRnJvbnRlbmQnLFxuICAgIH0pO1xuXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0Nsb3VkRnJvbnRVUkwnLCB7XG4gICAgICB2YWx1ZTogYGh0dHBzOi8vJHtkaXN0cmlidXRpb24uZGlzdHJpYnV0aW9uRG9tYWluTmFtZX1gLFxuICAgICAgZGVzY3JpcHRpb246ICdDbG91ZEZyb250IERpc3RyaWJ1dGlvbiBVUkwnLFxuICAgIH0pO1xuXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0Nsb3VkRnJvbnREaXN0cmlidXRpb25JZCcsIHtcbiAgICAgIHZhbHVlOiBkaXN0cmlidXRpb24uZGlzdHJpYnV0aW9uSWQsXG4gICAgICBkZXNjcmlwdGlvbjogJ0Nsb3VkRnJvbnQgRGlzdHJpYnV0aW9uIElEJyxcbiAgICB9KTtcblxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdNeVNRTENvbm5lY3Rpb25TdHJpbmcnLCB7XG4gICAgICB2YWx1ZTogYFNlcnZlcj0ke2VpcC5yZWZ9O0RhdGFiYXNlPSR7cHJvcHMubXlzcWxEYXRhYmFzZX07VWlkPSR7cHJvcHMubXlzcWxVc2VyfTtQd2Q9JHtwcm9wcy5teXNxbFBhc3N3b3JkfTtgLFxuICAgICAgZGVzY3JpcHRpb246ICdNeVNRTCBDb25uZWN0aW9uIFN0cmluZycsXG4gICAgfSk7XG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnU1NIQ29tbWFuZCcsIHtcbiAgICAgIHZhbHVlOiBgc3NoIC1pIHlvdXIta2V5LnBlbSB1YnVudHVAJHtlaXAucmVmfWAsXG4gICAgICBkZXNjcmlwdGlvbjogJ1NTSCBDb21tYW5kICh5b3UgbmVlZCB0byBhZGQgYSBrZXkgcGFpciknLFxuICAgIH0pO1xuICB9XG59XG4iXX0=